<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Working with schemas - remoteStorage.js</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script language=JavaScript src="../javascript/main.js"></script><script language=JavaScript src="../javascript/prettify.js"></script><script language=JavaScript src="../javascript/searchdata.js"></script></head><body class="ContentPage" onLoad="NDOnLoad();prettyPrint();"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.51 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CFile"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="Working_with_schemas"></a>Working with schemas</h1><div class=CBody><p>remoteStorage.js is designed to primarily deal with JSON data.&nbsp; It automatically (de-)serializes it whenever data has the Content-Type &ldquo;application/json&rdquo;, offers specific methods to store (<a href="../files/lib/baseClient-js.html#BaseClient.getObject" class=LFunction id=link1 onMouseOver="ShowTip(event, 'tt1', 'link1')" onMouseOut="HideTip('tt1')">BaseClient.getObject</a>) and retrieve (<a href="../files/lib/baseClient-js.html#BaseClient.storeObject" class=LFunction id=link2 onMouseOver="ShowTip(event, 'tt2', 'link2')" onMouseOut="HideTip('tt2')">BaseClient.storeObject</a>) JSON objects.</p><p>In addition to the basic format handling, remoteStorage.js can also <b>validate</b> JSON data against a <b>schema</b>.&nbsp; The <b>schema format</b> used is JSON-Schema, which is described at <a href="http://json-schema.org" class=LURL target=_top>json-schema.org</a>.</p><p>This tutorial aims to lead you through the process of declaring and using typed JSON data.</p><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SMain"><td class=SEntry><a href="#Working_with_schemas" >Working with schemas</a></td><td class=SDescription>remoteStorage.js is designed to primarily deal with JSON data. </td></tr><tr class="SSection"><td class=SEntry><a href="#Declaring_a_type" >Declaring a type</a></td><td class=SDescription><b>Declaring</b> a type means creating a <b>type alias</b> that is associated with a <b>type URI</b> and a <b>schema</b>. </td></tr><tr class="SSection"><td class=SEntry><a href="#Storing_typed_objects" >Storing typed objects</a></td><td class=SDescription>When storing objects you always need to specify a type (-alias). </td></tr><tr class="SSection"><td class=SEntry><a href="#Preparing_and_validating_typed_objects" >Preparing and validating typed objects</a></td><td class=SDescription>In order to validate an object, it first needs to be assigned the &ldquo;@type&rdquo; property. </td></tr><tr class="SSection"><td class=SEntry><a href="#Automatic_ID_handling_and_saveObject" >Automatic ID handling and saveObject</a></td><td class=SDescription>Another benefit you can gain from declaring a schema is automatic ID handling.</td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CSection"><div class=CTopic><h2 class=CTitle><a name="Declaring_a_type"></a>Declaring a type</h2><div class=CBody><p><b>Declaring</b> a type means creating a <b>type alias</b> that is associated with a <b>type URI</b> and a <b>schema</b>.&nbsp; Each type being declared is only valid within the current module.</p><ul><li>The <b>alias</b> is a String, that is used to refer to the type later on.&nbsp; It has to be unique within each module.&nbsp; An example would be &ldquo;drink&rdquo;.</li><li>The <b>URI</b> is also a String, used to uniquely identify a type.&nbsp; It is common to point this URI to a public copy of the schema.&nbsp; When the URI is ommitted, remoteStorage.js generates one based on the current module name and the alias.&nbsp; The URI is also stored in the typed object itself as an attribute called &ldquo;@type&rdquo;.</li><li>The <b>schema</b> is a JSON object containing a JSON schema, as described in the <a href="http://tools.ietf.org/html/draft-zyp-json-schema" class=LURL target=_top>specification</a></li></ul><h4 class=CHeading>This is a complete example of how to declare a type called &ldquo;event&rdquo;</h4><blockquote><pre class="prettyprint">client.declareType('event', 'http://json-schema.org/calendar', {
    &quot;description&quot;: &quot;A representation of an event&quot;,
    &quot;type&quot;: &quot;object&quot;,
    &quot;properties&quot;: {
        &quot;dtstart&quot;: {
            &quot;format&quot;: &quot;date-time&quot;,
            &quot;type&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;Event starting time&quot;,
            &quot;required&quot;: true
        },
        &quot;dtend&quot;: {
            &quot;format&quot;: &quot;date-time&quot;,
            &quot;type&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;Event ending time&quot;
        },
        &quot;summary&quot;: { &quot;type&quot;: &quot;string&quot;, &quot;required&quot;: true },
        &quot;location&quot;: { &quot;type&quot;: &quot;string&quot; },
        &quot;url&quot;: { &quot;type&quot;: &quot;string&quot;, &quot;format&quot;: &quot;uri&quot; },
        &quot;duration&quot;: {
            &quot;format&quot;: &quot;time&quot;,
            &quot;type&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;Event duration&quot;
        },
        &quot;rdate&quot;: {
            &quot;format&quot;: &quot;date-time&quot;,
            &quot;type&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;Recurrence date&quot;
        },
        &quot;rrule&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;Recurrence rule&quot;
        },
        &quot;category&quot;: { &quot;type&quot;: &quot;string&quot; },
        &quot;description&quot;: { &quot;type&quot;: &quot;string&quot; },
        &quot;geo&quot;: { &quot;$ref&quot;: &quot;http: //json-schema.org/geo&quot; }
    }
});</pre></blockquote></div></div></div>

<div class="CSection"><div class=CTopic><h2 class=CTitle><a name="Storing_typed_objects"></a>Storing typed objects</h2><div class=CBody><p>When storing objects you always need to specify a type (-alias).&nbsp; This is even true when you have not declared any types.&nbsp; In that case storeObject will print a warning and proceed.</p><p>When a type has been declared under the alias given to storeObject, the given object will be validated before being stored.&nbsp; If validation fails, the object will <b>not</b> have been saved and storeObject will return an array of validation errors.</p><h4 class=CHeading>Example</h4><blockquote><pre class="prettyprint">var event = { &quot;location&quot;: &quot;Berlin&quot;, &quot;id&quot;: baseClient.uuid() };
var errors = client.storeObject('event', event.id, event);
console.log(errors);
// [{ &quot;property&quot;:&quot;dtstart&quot;, &quot;message&quot;:&quot;is missing and is required&quot; },
//  { &quot;property&quot;:&quot;summary&quot;, &quot;message&quot;:&quot;is missing and is required&quot; }]</pre></blockquote><p>These errors can then be used to display a message to the user.</p></div></div></div>

<div class="CSection"><div class=CTopic><h2 class=CTitle><a name="Preparing_and_validating_typed_objects"></a>Preparing and validating typed objects</h2><div class=CBody><p>In order to validate an object, it first needs to be assigned the &ldquo;@type&rdquo; property.&nbsp; This is usually done by storeObject, based on the given type alias.&nbsp; If you want to validate an object before saving it, you need to pull in that @type property first.&nbsp; You could either do this manually, or remoteStorage.js can do that job for you, via <a href="../files/lib/baseClient-js.html#BaseClient.buildObject" class=LFunction id=link3 onMouseOver="ShowTip(event, 'tt3', 'link3')" onMouseOut="HideTip('tt3')">BaseClient.buildObject</a>:</p><blockquote><pre class="prettyprint">var event = client.buildObject('event');
console.log(event);
// { &quot;@type&quot;:&quot;http://json-schema.org/calendar&quot; }</pre></blockquote><h4 class=CHeading>Now you have a typed object, which can be passed to validateObject</h4><blockquote><pre class="prettyprint">var errors = client.validateObject(event);
console.log(errors);
// [{ &quot;property&quot;:&quot;dtstart&quot;, &quot;message&quot;:&quot;is missing and is required&quot; },
//  { &quot;property&quot;:&quot;summary&quot;, &quot;message&quot;:&quot;is missing and is required&quot; }]</pre></blockquote></div></div></div>

<div class="CSection"><div class=CTopic><h2 class=CTitle><a name="Automatic_ID_handling_and_saveObject"></a>Automatic ID handling and saveObject</h2><div class=CBody><p>Another benefit you can gain from declaring a schema is automatic ID handling.</p><p>To use it, you need to add another property to your schema</p><blockquote><pre class="prettyprint">client.declareType('event', 'http://json-schema.org/calendar', {
  // (...)
  &quot;properties&quot;: {
    &quot;id&quot;: {
      &quot;description&quot;: &quot;Unique identifier for this event&quot;,
      &quot;type&quot;: &quot;string&quot;,
      &quot;format&quot;: &quot;id&quot; // this tells remoteStorage.js to use the attribute as an ID.
    }
    // (...)
  }
});</pre></blockquote><p>Now <a href="../files/lib/baseClient-js.html#BaseClient.buildObject" class=LFunction id=link4 onMouseOver="ShowTip(event, 'tt3', 'link4')" onMouseOut="HideTip('tt3')">BaseClient.buildObject</a> will generate an ID for you, if needed</p><blockquote><pre class="prettyprint">var event = client.buildObject('event');
console.log(event);
// { &quot;@type&quot;:&quot;http://json-schema.org/calendar&quot;,
//   &quot;id&quot;: &quot;uuid:24599E26-F5F8-4698-88C2-1EDB319B9960&quot; }</pre></blockquote><p>If you already specified an ID yourself, it won&rsquo;t overwrite it</p><blockquote><pre class="prettyprint">var event = client.buildObject('event', { &quot;id&quot;: &quot;my-own-id&quot; });
console.log(event);
// { &quot;@type&quot;:&quot;http://json-schema.org/calendar&quot;,
//   &quot;id&quot;: &quot;my-own-id&quot; }</pre></blockquote><h4 class=CHeading>Using saveObject with typed objects</h4><p>When your app works with typed objects that have an ID attribute, you can use <a href="../files/lib/baseClient-js.html#BaseClient.saveObject" class=LFunction id=link5 onMouseOver="ShowTip(event, 'tt4', 'link5')" onMouseOut="HideTip('tt4')">BaseClient.saveObject</a> instead of <a href="../files/lib/baseClient-js.html#BaseClient.storeObject" class=LFunction id=link6 onMouseOver="ShowTip(event, 'tt2', 'link6')" onMouseOut="HideTip('tt2')">BaseClient.storeObject</a> to save them.</p><p>saveObject needs only one parameter, the object</p><blockquote><pre class="prettyprint">var event = client.buildObject('event');
event.dtstart = new Date();
event.summary = &quot;Something happening&quot;;

var errors = client.saveObject(event);
console.log(errors);
// null

// verify it was saved (just for demonstration, you don't need to do that):
var reloadedEvent = client.getObject(event.id);
console.log(reloadedEvent);
// { &quot;@type&quot;: &quot;http://json-schema.org/calendar&quot;,
//   &quot;id&quot;: &quot;uuid:DA115EF9-42F6-4A73-8AFB-F5DC773F5AA3&quot;,
//   &quot;dtstart&quot;: &quot;2012-11-01T18:07:37.373Z&quot;,
//   &quot;summary&quot;: &quot;Something happening&quot; }</pre></blockquote></div></div></div>

</div><!--Content-->


<div id=Footer>remoteStorage.js is developed by some people. It's open source (MIT license) and meant for YOU! Don't mess with people's data, dude.&nbsp; &middot;&nbsp; <a href="http://www.naturaldocs.org">Generated by Natural Docs</a></div><!--Footer-->


<div id=Menu><div class=MTitle>remoteStorage.js</div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">Intro</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MFile><a href="overview-txt.html">Overview</a></div></div><div class=MEntry><div class=MFile><a href="download-txt.html">Get remoteStorage.js</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent2')">Guides</a><div class=MGroupContent id=MGroupContent2><div class=MEntry><div class=MFile><a href="howto-include-txt.html">Adding remoteStorage to your app</a></div></div><div class=MEntry><div class=MFile><a href="howto-contribute-txt.html">Howto contribute</a></div></div><div class=MEntry><div class=MFile id=MSelected>Working with schemas</div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent7')">API</a><div class=MGroupContent id=MGroupContent7><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent3')">Public API</a><div class=MGroupContent id=MGroupContent3><div class=MEntry><div class=MFile><a href="../files/remoteStorage-js.html">remoteStorage</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/baseClient-js.html">BaseClient</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent4')">Modules</a><div class=MGroupContent id=MGroupContent4><div class=MEntry><div class=MFile><a href="../files/modules/contacts-js.html">contacts</a></div></div><div class=MEntry><div class=MFile><a href="../files/modules/tasks-js.html">tasks</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent5')">Internals</a><div class=MGroupContent id=MGroupContent5><div class=MEntry><div class=MFile><a href="../files/lib/wireClient-js.html">wireClient</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/getputdelete-js.html">getputdelete</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/store-js.html">store</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/sync-js.html">sync</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/util-js.html">util</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/webfinger-js.html">webfinger</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/platform-js.html">platform</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/nodeConnect-js.html">nodeConnect</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/hardcoded-js.html">hardcoded</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/widget-js.html">widget</a></div></div><div class=MEntry><div class=MFile><a href="../files/lib/foreignClient-js.html">ForeignClient</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent6')">Docs Index</a><div class=MGroupContent id=MGroupContent6><div class=MEntry><div class=MIndex><a href="../index/General.html">Everything</a></div></div></div></div></div></div></div></div><script type="text/javascript"><!--
var searchPanel = new SearchPanel("searchPanel", "HTML", "../search");
--></script><div id=MSearchPanel class=MSearchPanelInactive><input type=text id=MSearchField value=Search onFocus="searchPanel.OnSearchFieldFocus(true)" onBlur="searchPanel.OnSearchFieldFocus(false)" onKeyUp="searchPanel.OnSearchFieldChange()"><select id=MSearchType onFocus="searchPanel.OnSearchTypeFocus(true)" onBlur="searchPanel.OnSearchTypeFocus(false)" onChange="searchPanel.OnSearchTypeChange()"><option  id=MSearchEverything selected value="General">Everything</option></select></div><script language=JavaScript><!--
HideAllBut([2, 7, 1], 8);// --></script></div><!--Menu-->



<!--START_ND_TOOLTIPS-->
<div class=CToolTip id="tt1"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>getObject: function(</td><td class="PParameter  prettyprint " nowrap>path,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>callback,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>context</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Get a JSON object from given path.</div></div><div class=CToolTip id="tt2"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>storeObject: function(</td><td class="PParameter  prettyprint " nowrap>type,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>path,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>obj,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>callback,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>context</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Store object at given path. </div></div><div class=CToolTip id="tt3"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>buildObject: function(</td><td class="PParameter  prettyprint " nowrap>alias,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>attributes</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Build an object of the designated type.</div></div><div class=CToolTip id="tt4"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>saveObject: function(</td><td class="PParameter  prettyprint " nowrap>object,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>callback,</td></tr><tr><td></td><td class="PParameter  prettyprint " nowrap>context</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Save a typed JSON object. </div></div><!--END_ND_TOOLTIPS-->




<div id=MSearchResultsWindow><iframe src="" frameborder=0 name=MSearchResults id=MSearchResults></iframe><a href="javascript:searchPanel.CloseResultsWindow()" id=MSearchResultsWindowClose>Close</a></div>


<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>