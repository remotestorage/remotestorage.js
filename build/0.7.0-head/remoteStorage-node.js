/* remoteStorage.js 0.7.0-head remoteStoragejs.com, MIT-licensed */

/**
 * almond 0.1.4 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

//         remoteStorage.contacts.list().map(function(c) {

/**
 * JSONSchema Validator - Validates JavaScript objects using JSON Schemas
 *	(http://www.json.com/json-schema-proposal/)
 *
 * Copyright (c) 2007 Kris Zyp SitePen (www.sitepen.com)
 * Licensed under the MIT (MIT-LICENSE.txt) license.
To use the validator call the validate function with an instance object and an optional schema object.
If a schema is provided, it will be used to validate. If the instance object refers to a schema (self-validating),
that schema will be used to validate and the schema parameter is not necessary (if both exist,
both validations will occur).
The validate method will return an array of validation errors. If there are no errors, then an
empty list will be returned. A validation error will have two properties:
"property" which indicates which property had the error
"message" which indicates what the error was
 */

(function(){var e,t,n;(function(r){function c(e,t){var n,r,i,s,o,u,f,l,c,h,p=t&&t.split("/"),d=a.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."&&t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],f=l)}!s&&u&&(s=u,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function h(e,t){return function(){return s.apply(r,l.call(arguments,0).concat([e,t]))}}function p(e){return function(t){return c(t,e)}}function d(e){return function(t){o[e]=t}}function v(e){if(u.hasOwnProperty(e)){var t=u[e];delete u[e],f[e]=!0,i.apply(r,t)}if(!o.hasOwnProperty(e))throw new Error("No "+e);return o[e]}function m(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=c(e.slice(0,i),t),e=e.slice(i+1),r=v(n),r&&r.normalize?e=r.normalize(e,p(t)):e=c(e,t)):e=c(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function g(e){return function(){return a&&a.config&&a.config[e]||{}}}var i,s,o={},u={},a={},f={},l=[].slice;i=function(e,t,n,i){var s,a,l,c,p,y=[],b;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(p=0;p<t.length;p+=1){c=m(t[p],i),a=c.f;if(a==="require")y[p]=h(e);else if(a==="exports")y[p]=o[e]={},b=!0;else if(a==="module")s=y[p]={id:e,uri:"",exports:o[e],config:g(e)};else if(o.hasOwnProperty(a)||u.hasOwnProperty(a))y[p]=v(a);else if(c.p)c.p.load(c.n,h(i,!0),d(a),{}),y[p]=o[a];else if(!f[a])throw new Error(e+" missing "+a)}l=n.apply(o[e],y);if(e)if(s&&s.exports!==r&&s.exports!==o[e])o[e]=s.exports;else if(l!==r||!b)o[e]=l}else e&&(o[e]=n)},e=t=s=function(e,t,n,o,u){return typeof e=="string"?v(m(e,t).f):(e.splice||(a=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=o,o=u),o?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},15),s)},s.config=function(e){return a=e,s},n=function(e,t,n){t.splice||(n=t,t=[]),u[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("../build/lib/almond",function(){}),n("lib/assets",[],function(){return{remoteStorageIcon:"data:image/png;base64,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",remoteStorageCube:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAR2SURBVFiFtddfqGVVHQfwz2/vfZ28c2WgP6hMoYkUV4qIYnSKmaQYwaaJ3oLeUnpJmDCmUhCaIhhKGelhelCqN9+ECKdAxR6kgnJASBN9KTGwP2oKTtyZs8/+9bDXPufcfe51xju6YLHX2fu3ft/v+q7fWb/fisy0o3brez6qmt4Luvo7frvx/E7cxNsmcCj2WGnuEb6JaXlbSz8zaX/ksXzj3SHwg6j8aeU28jjeh8TZ8nU3Aq8Sx+2b/ML3s3vnCHxp5YB0Hz6OTkgpMax2jxBSoMJfhGMemTx5aQQOxzWsnCC/gm6hZ+mvFMv36xUYCJQev2Jyt9P54tsj8OVYNW2+izuxIkzlAoGUQuLlMuNqKcQCgVBJNSa4X93+xK/zfxcmcLj5GtUJ8ipMC/i0gA/PQYF/lFkfHClQFxJ1IVET/6S72+n2oa0JHL7s0+RPsR9tAZuOxuNtGKS9xpL8A7BmNP4j8S2nzz+lGJaWDxB7RyCbV54DkZiSrbAhbJBt/25LtUbEY2+P1bdmQY1V8mr8DruET5Z9n4NHTOmmZK9A2ihzp3RdL3tVy+z16OeG0ElncI48yGzeogIzQgexByelp2fMZ+CDAtFK56XzxFwBXSE6C9incbL4PDha9BKBPrjCddJRVT5DHsMLczkLUGhFbPR9iJNYjJUXyGOqfEY6KlxnHrybVjwm0JVDJmV8FZ8TeZysZdyBK9FKXb/6mdTZ+4uXRXcKUxnHpavKdqV58G5JYJFdLvT3yuok3ROiuY3JZ3Rxu7CH7lxvHlPpNVX+nJU/yMk9VJ8nm5GvMc42W6Bwnhl2KRyQ7cOyaqy1R0ScEvFq6aestUdk1cj2YeEA3RwwtwbfSoHtxxmJXeS3nV25RR0/9KnJL8GZyz7i7MoD5MfQ9LZ5YZ+WY+AiW16vc8if/av8PkRevxNPiwTiLceRISPIM3iUOGxa/wfUbiTvxy3ETb3tRfi0HAMx+xgLY1XIeAUPYoO4S+YNqupyVXW5zBuIu/pvHuxtq5j5DLHkfxsFxoaBlN1vVKbEN2TQ5wdYLc8++YibhZvJx3VZizgy8rVEYhwDfUKZFxd/Jf8m4gsydtENJ17TZ8lcLbOGrFfJrKmOiDxHPk58GJ8oPqu3UmDOLr2B5/AhYt08K9Z9AMdAsCeQml6BnKdiriC+iP/iKWkdH7gQgSRfQoi4SWoLcMqsRaUcZiX1xu4yrZmpp6p721lavlLYK/PfeIm4djsCE7xZDNqSVocV9evNJCKIjq6TuTbbAlWvQGZfiCwWJqkqqb7pMUwG0IV/QXwdz1ouKjZXOP021EQjqt2i2k00/Tv1Evj8OfRnC1aPeokl2e/LrM/aYUk2Pgc43T6knqzjBCZytqqhpGpK0DXCmrC26d1Qgs3BJzihnqyPwbdWYJMaFyzLnyuW6yMFLrEsH7ftLyZ/LxbX7vRisrwFW7VHJk/a1+4njuL1udx5Rd9nW/A6cdS+dv/FgHPpl9PhorH67l9Ox62/nv8YdPX3dno9/z+G+TGrzjgPKwAAAABJRU5ErkJggg==",widgetCss:"#remotestorage-state { position:fixed; top:5px; right:5px; height:32px; width:275px; font:normal 16px/100% sans-serif; z-index:99999; background:rgba(0,0,0,.3); padding:5px; border-radius:7px; box-shadow:0 1px rgba(255,255,255,.05), inset 0 1px rgba(0,0,0,.05); transition:width 500ms, background 500ms; }\n#remotestorage-state.connected, #remotestorage-state.busy, #remotestorage-state.offline { width:32px; background:none; box-shadow:none; }\n.remotestorage-button { margin:0; padding:.3em; font-size:14px; height:26px !important; background:#ddd; color:#333; border:1px solid #ccc; border-radius:3px; box-shadow:0 1px 1px #fff inset; }\n#remotestorage-register-button { position:absolute; left:25px; top:8px; max-height:16px; text-decoration:none; font-weight:normal; cursor:pointer; }\n#remotestorage-connect-button { position:absolute; right:8px; top:8px; padding:0 0 0 17px; width:90px; cursor:pointer; text-align:left; border-radius:0 3px 3px 0; font-weight:normal; }\n#remotestorage-connect-button:hover, #remotestorage-connect-button:focus, .remotestorage-button:hover, .remotestorage-button:focus { background:#eee; color:#000; text-decoration:none; }\n#remotestorage-useraddress { position:absolute; left:25px; top:8px; margin:0; padding:0 17px 0 3px; height:25px; width:142px; background:#eee; color:#333; border:0; border-radius:3px 0 0 3px; box-shadow:0 1px #fff, inset 0 1px #999; font-weight:normal; font-size:14px;}\n#remotestorage-useraddress:hover, #remotestorage-useraddress:focus { background:#fff; color:#000; }\n#remotestorage-cube { position:absolute; right:84px; -webkit-transition:right 500ms; -moz-transition:right 500ms; transition:right 500ms; z-index:99997; }\n#remotestorage-questionmark { position:absolute; left:0; padding:9px 8px; color:#fff; text-decoration:none; z-index:99999; font-weight:normal; }\n.infotext { position:absolute; left:0; top:0; width:255px; height:32px; padding:6px 5px 4px 25px; font-size:10px; background:black; color:white; border-radius:7px; opacity:.85; text-decoration:none; white-space:nowrap; z-index:99998; }\n#remotestorage-questiomark:hover { color:#fff; }\n#remotestorage-questionmark:hover+#remotestorage-infotext { display:inline; }\n#remotestorage-state.busy #remotestorage-cube, #remotestoreage-state.authing #remotestorage-cube, #remotestorage-state.connecting #remotestorage-cube {   -webkit-animation-name:remotestorage-loading; -webkit-animation-duration:2s; -webkit-animation-iteration-count:infinite; -webkit-animation-timing-function:linear;\n   -moz-animation-name:remotestorage-loading; -moz-animation-duration:2s; -moz-animation-iteration-count:infinite; -moz-animation-timing-function:linear;\n   -o-animation-name:remotestorage-loading; -o-animation-duration:2s; -o-animation-iteration-count:infinite; -o-animation-timing-function:linear;\n   -ms-animation-name:remotestorage-loading; -ms-animation-duration:2s; -ms-animation-iteration-count:infinite; -ms-animation-timing-function:linear; }\n   @-webkit-keyframes remotestorage-loading { from{-webkit-transform:rotate(0deg)} to{-webkit-transform:rotate(360deg)} }\n   @-moz-keyframes remotestorage-loading { from{-moz-transform:rotate(0deg)} to{-moz-transform:rotate(360deg)} }\n   @-o-keyframes remotestorage-loading { from{-o-transform:rotate(0deg)} to{-o-transform:rotate(360deg)} }\n   @-ms-keyframes remotestorage-loading { from{-ms-transform:rotate(0deg)} to{ -ms-transform:rotate(360deg)} }\n#remotestorage-connect-button, #remotestorage-questionmark, #remotestorage-register-button, #remotestorage-cube, #remotestorage-useraddress, #remotestorage-infotext, #remotestorage-devsonly, #remotestorage-bubble { display:none }\n#remotestorage-state.anonymous #remotestorage-cube, #remotestorage-state.anonymous #remotestorage-connect-button, #remotestorage-state.anonymous #remotestorage-register-button, #remotestorage-state.anonymous #remotestorage-questionmark { display: block }\n#remotestorage-state.connecting #remotestorage-cube, #remotestorage-state.connecting #remotestorage-connect-button, #remotestorage-state.connecting #remotestorage-useraddress, #remotestorage-state.connecting #remotestorage-questionmark { display: block }\n#remotestorage-state.interrupted #remotestorage-cube, #remotestorage-state.interrupted #remotestorage-connect-button, #remotestorage-state.interrupted #remotestorage-register-button, #remotestorage-state.interrupted #remotestorage-questionmark { display: block }\n#remotestorage-state.failed #remotestorage-cube, #remotestorage-state.failed #remotestorage-connect-button, #remotestorage-state.failed #remotestorage-register-button, #remotestorage-state.failed #remotestorage-questionmark { display: block }\n#remotestorage-state.authing #remotestorage-cube, #remotestorage-state.authing #remotestorage-connect-button, #remotestorage-state.authing #remotestorage-useraddress, #remotestorage-state.authing #remotestorage-questionmark { display: block }\n#remotestorage-state.typing #remotestorage-cube, #remotestorage-state.typing #remotestorage-connect-button, #remotestorage-state.typing #remotestorage-useraddress, #remotestorage-state.typing #remotestorage-questionmark { display: block }\n#remotestorage-state.connected #remotestorage-cube, #remotestorage-state.busy #remotestorage-cube, #remotestorage-state.offline #remotestorage-cube { right:0; opacity:.5; cursor:pointer; display: block }\n#remotestorage-state.devsonly #remotestorage-devsonly { display: block }\n#remotestorage-bubble { position:absolute; right:6px; top:9px; padding:5px 28px 2px 6px; height:17px; white-space:nowrap; font-size:10px; background:#000; color:#fff; border-radius:5px; opacity:.5; text-decoration:none; z-index:99996; }\n#remotestorage-state.connected #remotestorage-bubble, #remotestorage-state.busy #remotestorage-bubble, #remotestorage-state.offline #remotestorage-bubble { cursor:pointer; }\n#remotestorage-bubble strong { font-weight:bold; }\n#remotestorage-state.connected #remotestorage-cube:hover, #remotestorage-state.busy #remotestorage-cube:hover, #remotestorage-state.offline #remotestorage-cube:hover { opacity:1; }\n#remotestorage-state.connected #remotestorage-bubble:hover, #remotestorage-state.busy #remotestorage-bubble:hover, #remotestorage-state.offline #remotestorage-bubble:hover { display:inline; }\n#remotestorage-state.connected #remotestorage-cube:hover+#remotestorage-bubble, #remotestorage-state.busy #remotestorage-cube:hover+#remotestorage-bubble, #remotestorage-state.offline #remotestorage-cube:hover+#remotestorage-bubble { display:inline; }\n"}}),n("lib/util",[],function(){var e={},t={},n=["base","sync","webfinger","getputdelete","platform","baseClient","widget","store","foreignClient"],r=null,i={toArray:function(e){return Array.prototype.slice.call(e)},isDir:function(e){return e.substr(-1)=="/"},pathParts:function(e){var t=["/"],n;while(n=e.match(/^(.*?)([^\/]+\/?)$/))t.unshift(n[2]),e=n[1];return t},extend:function(e,t){for(var n in t)e[n]=t[n];return e},containingDir:function(e){var t=e.replace(/[^\/]+\/?$/,"");return t==e?null:t},baseName:function(e){var t=e.split("/");return i.isDir(e)?t[t.length-2]+"/":t[t.length-1]},bindAll:function(e){for(var t in e)typeof e[t]=="function"&&(e[t]=this.bind(e[t],e));return e},curry:function(e){var t=Array.prototype.slice.call(arguments,1);return function(){var n=Array.prototype.slice.call(arguments);for(var r=t.length-1;r>=0;r--)n.unshift(t[r]);return e.apply(this,n)}},bind:function(e,t){return t?function(){return e.apply(t,arguments)}:e},deprecate:function(e,t){console.trace(),console.log("WARNING: "+e+" is deprecated, use "+t+" instead")},highestAccess:function(e,t){return e=="rw"||t=="rw"?"rw":e=="r"||t=="r"?"r":null},getEventEmitter:function(){return this.bindAll({_handlers:function(){var e=Array.prototype.slice.call(arguments),t={};return e.forEach(function(e){t[e]=[]}),t}.apply(null,arguments),emit:function(e){var t=Array.prototype.slice.call(arguments,1);if(!this._handlers[e])throw"Unknown event: "+e;this._handlers[e].forEach(function(e){e&&e.apply(null,t)})},once:function(e,t){var n=this._handlers[e].length;if(typeof t!="function")throw"Expected function as handler, got: "+typeof t;this.on(e,function(){delete this._handlers[e][n],t.apply(this,arguments)}.bind(this))},on:function(e,t){if(!this._handlers[e])throw"Unknown event: "+e;if(typeof t!="function")throw"Expected function as handler, got: "+typeof t;this._handlers[e].push(t)}})},getLogger:function(n){return e[n]||(e[n]={info:function(){this.log("info",i.toArray(arguments))},debug:function(){this.log("debug",i.toArray(arguments),"debug")},error:function(){this.log("error",i.toArray(arguments),"error")},log:function(e,i,s){if(r)return r(n,e,i);if(t[n])return;s||(s="log"),i.unshift("["+n.toUpperCase()+"] -- "+e+" "),(console[s]||console.log).apply(console,i)}}),e[n]},setLogFunction:function(e){r=e},silenceLogger:function(){var e=i.toArray(arguments);for(var n=0;n<e.length;n++)t[e[n]]=!0},unsilenceLogger:function(){var e=i.toArray(arguments);for(var n=0;n<e.length;n++)delete t[e[n]]},silenceAllLoggers:function(){this.silenceLogger.apply(this,n)},unsilenceAllLoggers:function(){this.unsilenceLogger.apply(this,n)},grepLocalStorage:function(e,t){for(var n=0;n<localStorage.length;n++){var r=localStorage.key(n);e.test(r)&&t(r)}}};return i}),n("lib/platform",["./util"],function(e){function r(e){var t={};for(var n in e)t[n.toLowerCase()]=e[n];return t}function i(e){if(!e)return null;var t={},i=e.split(/\r?\n/),s=null,o,u,a;for(var f=0;f<i.length;f++){if(i[f].length==0)continue;(o=i[f].match(/^([^:]+):\s*(.+)$/))?(u=o[1],a=o[2],t[u]=a,s=u):(o=i[f].match(/^\s+(.+)$/))?(u=s,a=o[1],t[u]=t[u]+a):n.error("Failed to parse header line: "+i[f])}return r(t)}function s(e){var t=!1,n,r=new XMLHttpRequest;e.timeout&&(n=window.setTimeout(function(){t=!0,r.abort(),e.error("timeout")},e.timeout)),e.method||(e.method="GET"),r.open(e.method,e.url,!0);if(e.headers)for(var s in e.headers)r.setRequestHeader(s,e.headers[s]);r.onreadystatechange=function(){if(r.readyState==4){n&&window.clearTimeout(n);if(r.status==200||r.status==201||r.status==204||r.status==207){var t=i(r.getAllResponseHeaders());t||(t={"content-type":r.getResponseHeader("Content-Type")}),e.success(r.responseText,t)}else e.error(r.status||"unknown error")}},typeof e.data=="string"?r.send(e.data):r.send()}function o(e){var t=new XDomainRequest;t.timeout=e.timeout||3e3,t.open(e.method,e.url),t.onload=function(){t.status==200||t.status==201||t.status==204?e.success(xhr.responseText):e.error(xhr.status)},t.onerror=function(){err("unknown error")},t.ontimeout=function(){err(timeout)},e.data?t.send(e.data):t.send()}function u(e){var n=t("http"),i=t("https"),s=t("url");e.method||(e.method="GET"),e.data?e.headers["content-length"]=e.data.length:e.data=null;var o=s.parse(e.url),u={method:e.method,host:o.hostname,path:o.path,port:o.port?port:o.protocol=="https:"?443:80,headers:e.headers},a,f;e.timeout&&(a=setTimeout(function(){e.error("timeout"),f=!0},e.timeout));var l=o.protocol=="https:"?i:n,c=l.request(u,function(t){var n="";t.setEncoding("utf8"),t.on("data",function(e){n+=e}),t.on("end",function(){a&&clearTimeout(a),f||(t.statusCode==200||t.statusCode==201||t.statusCode==204?e.success(n,r(t.headers)):e.error(t.statusCode))})});c.on("error",function(t){a&&clearTimeout(a),e.error(t.message)}),e.data?c.end(e.data):c.end()}function a(e,t){var n=(new DOMParser).parseFromString(e,"text/xml"),r=n.getElementsByTagName("Link"),i={Link:[]};for(var s=0;s<r.length;s++){var o={};if(r[s].attributes)for(var u=0;u<r[s].attributes.length;u++)o[r[s].attributes[u].name]=r[s].attributes[u].value;var a=r[s].getElementsByTagName("Property");o.properties={};for(var f=0;f<a.length;f++)o.properties[a[f].getAttribute("type")]=a[f].childNodes[0].nodeValue;o.rel&&i.Link.push({"@":o})}t(null,i)}function f(e,n){var r=t("xml2js");(new r.Parser).parseString(e,n)}function l(){}function c(e){if(location.hash.length){var t=location.hash.substring(1).split("&");for(var n=0;n<t.length;n++)if(t[n].substring(0,(e+"=").length)==e+"="){var r=decodeURIComponent(t[n].substring((e+"=").length));return delete t[n],location="#"+t.join("&"),r}}}function h(e,t){}function p(e,t){var n=e;n instanceof Element||(n=document.getElementById(e)),n.innerHTML=t}function d(e){}function v(e){return document.getElementById(e).value}function m(e,t,n){}function g(e,t,n){t=="click"?document.getElementById(e).onclick=n:t=="hover"?document.getElementById(e).onmouseover=n:t=="type"&&(document.getElementById(e).onkeyup=n)}function y(){return window.location.href.split("#")[0]}function b(){}function w(e){window.location=e}function E(){}function S(e){alert(e)}function x(e){console.log(e)}var n=e.getLogger("platform");return typeof window=="undefined"?{ajax:u,parseXml:f,harvestParam:l,setElementHTML:h,getElementValue:d,eltOn:m,getLocation:b,setLocation:E,alert:x}:window.XDomainRequest?{ajax:o,parseXml:a,harvestParam:c,setElementHTML:p,getElementValue:v,eltOn:g,getLocation:y,setLocation:w,alert:S}:{ajax:s,parseXml:a,harvestParam:c,setElementHTML:p,getElementValue:v,eltOn:g,getLocation:y,setLocation:w,alert:S}}),n("lib/webfinger",["./platform","./util"],function(e,t){function r(e,t){var n=e.toLowerCase().split("@");if(n.length<2)t("That is not a user address. There is no @-sign in it");else if(n.length>2)t("That is not a user address. There is more than one @-sign in it");else if(!/^[\.0-9a-z\-\_]+$/.test(n[0]))t('That is not a user address. There are non-dotalphanumeric symbols before the @-sign: "'+n[0]+'"');else if(!/^[\.0-9a-z\-]+$/.test(n[1]))t('That is not a user address. There are non-dotalphanumeric symbols after the @-sign: "'+n[1]+'"');else{var r="?resource=acct:"+encodeURIComponent(e);t(null,["https://"+n[1]+"/.well-known/host-meta.json"+r,"https://"+n[1]+"/.well-known/host-meta"+r,"http://"+n[1]+"/.well-known/host-meta.json"+r,"http://"+n[1]+"/.well-known/host-meta"+r])}}function i(t,n,r,u){var a=t.shift();u||(u=[]),a?e.ajax({url:a,success:function(e){o(e,function(o,u){o?s(e,function(e,s){e?i(t,n,r):r(null,s)}):r(null,u)})},error:function(e){u.push(e),i(t,n,r,u)},timeout:n}):r("could not fetch XRD: "+u[0])}function s(t,n){e.parseXml(t,function(e,t){if(e)n(e);else if(t&&t.Link){var r={};if(t.Link&&t.Link["@"])t.Link["@"].rel&&(r[t.Link["@"].rel]=t.Link["@"]);else for(var i=0;i<t.Link.length;i++)t.Link[i]["@"]&&t.Link[i]["@"].rel&&(r[t.Link[i]["@"].rel]=t.Link[i]["@"]);n(null,r)}else n("found valid xml but with no Link elements in there")})}function o(e,t){var n;try{n=JSON.parse(e)}catch(r){t("not valid JSON");return}n.links||t("JRD contains no links");var i={};for(var s=0;s<n.links.length;s++)n.links[s].rel&&(i[n.links[s].rel]=n.links[s]);t(null,i)}function u(e,t){e&&e.href&&e.type&&e.properties&&e.properties["auth-endpoint"]?t(null,e):t("could not extract storageInfo from lrdd")}function a(e,t,s){r(e,function(r,o){n.debug("HOST META ADDRESSES",o,"(error: ",r,")"),r?s(r):i(o,t.timeout,function(n,r){if(n)s("could not fetch host-meta for "+e+" ("+n+")");else if(r.remoteStorage||r.remotestorage)u(r.remoteStorage||r.remotestorage,s);else if(r.lrdd&&r.lrdd.template){var o=r.lrdd.template.split("{uri}"),a=[o.join("acct:"+e),o.join(e)];i(a,t.timeout,function(t,n){t?s("could not fetch lrdd for "+e):n.remoteStorage?u(n.remoteStorage,s):n.remotestorage?u(n.remotestorage,s):s("could not extract storageInfo from lrdd")})}else s("could not extract lrdd template from host-meta")})})}var n=t.getLogger("webfinger");return{getStorageInfo:a}}),n("lib/hardcoded",["./platform"],function(e){function n(t,n,r){e.ajax({url:"http://proxy.unhosted.org/irisCouchCheck?q=acct:"+t,success:function(e){var t;try{t=JSON.parse(e)}catch(n){}t?r(null,t):r("err: unparsable response from IrisCouch check")},error:function(e){r("err: during IrisCouch test:"+e)},timeout:n.timeout})}function r(e){var t=e.split("@");return["libredocs","mail","browserid","me"].indexOf(t[0])==-1?t[0]+"@iriscouch.com":t[2].substring(0,t[2].indexOf("."))+"@iriscouch.com"}function i(e,r,i){var s=e.split("@");if(s.length<2)i("That is not a user address. There is no @-sign in it");else if(s.length>2)i("That is not a user address. There is more than one @-sign in it");else if(!/^[\.0-9A-Za-z]+$/.test(s[0]))i('That is not a user address. There are non-dotalphanumeric symbols before the @-sign: "'+s[0]+'"');else if(!/^[\.0-9A-Za-z\-]+$/.test(s[1]))i('That is not a user address. There are non-dotalphanumeric symbols after the @-sign: "'+s[1]+'"');else{while(s[1].indexOf(".")!=-1){if(t[s[1]]){blueprint=t[s[1]],i(null,{rel:"https://www.w3.org/community/unhosted/wiki/personal-data-service-00",type:blueprint.type,href:blueprint.hrefPrefix+"/"+(blueprint.pathFormat=="user@host"?e:s[1]+"/"+s[0]),properties:{"access-methods":["http://oauth.net/core/1.0/parameters/auth-header"],"auth-methods":["http://oauth.net/discovery/1.0/consumer-identity/static"],"auth-endpoint":blueprint.authPrefix+e}});return}s[1]=s[1].substring(s[1].indexOf(".")+1)}new Date<new Date("9/9/2012")?n(e,r,i):i("err: not a guessable domain, and fakefinger-migration has ended")}}var t={"iriscouch.com":{type:"https://www.w3.org/community/unhosted/wiki/remotestorage-2011.10#couchdb",authPrefix:"http://proxy.unhosted.org/OAuth.html?userAddress=",hrefPrefix:"http://proxy.unhosted.org/CouchDb",pathFormat:"host/user"}};return function(){var e={type:"https://www.w3.org/community/unhosted/wiki/remotestorage-2011.10#simple",authPrefix:"https://storage.surfnetlabs.nl/saml/oauth/authorize?user_address=",hrefPrefix:"https://storage.surfnetlabs.nl/saml",pathFormat:"user@host"},n={type:"https://www.w3.org/community/unhosted/wiki/remotestorage-2011.10#simple",authPrefix:"https://storage.surfnetlabs.nl/browserid/oauth/authorize?user_address=",hrefPrefix:"https://storage.surfnetlabs.nl/browserid",pathFormat:"user@host"},r=["leidenuniv.nl","leiden.edu","uva.nl","vu.nl","eur.nl","maastrichtuniversity.nl","ru.nl","rug.nl","uu.nl","tudelft.nl","utwente.nl","tue.nl","tilburguniversity.edu","uvt.nl","wur.nl","wageningenuniversity.nl","ou.nl","lumc.nl","amc.nl","ahk.nl","cah.nl","driestar.nl","che.nl","chn.nl","hen.nl","huygens.nl","diedenoort.nl","efa.nl","dehaagsehogeschool.nl","hasdenbosch.nl","inholland.nl","hsbrabant.nl","dehorst.nl","kempel.nl","domstad.nl","hsdrenthe.nl","edith.nl","hsleiden.nl","interport.nl","schumann.nl","hsbos.nl","hva.nl","han.nl","hvu.nl","hesasd.nl","hes-rdam.nl","hku.nl","hmtr.nl","hzeeland.nl","hotelschool.nl","ichtus-rdam.nl","larenstein.nl","iselinge.nl","koncon.nl","kabk.nl","lhump.nl","msm.nl","hsmarnix.nl","nhtv.nl","nth.nl","nhl.nl","sandberg.nl","hsij.nl","stoas.nl","thrijswijk.nl","tio.nl","vhall.nl","chw.nl","hogeschoolrotterdam.nl"],i=["surfnet.nl","fontys.nl"];for(var s=0;s<i.length;s++)t[i[s]]=e;for(var s=0;s<r.length;s++)t[r[s]]=n}(),{guessStorageInfo:i}}),n("lib/getputdelete",["./platform","./util"],function(e,t){function i(e){return e["content-type"]?e["content-type"].split(";")[0]:(n.error("Falling back to default content type: ",r,JSON.stringify(e)),r)}function s(t,r,s,o,u,a,f){n.info(t,r);var l={url:r,method:t,error:function(e){e==401?e="unauthorized":n.error(t+" "+r+": ",e),a(e)},success:function(e,t){a(null,e,i(t))},timeout:f||5e3,headers:{}};u&&(l.headers.Authorization="Bearer "+u),o&&(l.headers["Content-Type"]=o),l.fields={withCredentials:"true"},t!="GET"&&(l.data=s),e.ajax(l)}function o(e,n,r){s("GET",e,null,null,n,function(n,i,s){if(n==404)r(null,undefined);else if(n)r(n);else{if(t.isDir(e))try{i=JSON.parse(i)}catch(o){r("unparseable directory index");return}r(null,i,s)}})}function u(e,t,r,i,o){typeof t!="string"&&o("invalid value given to PUT, only strings allowed, got "+typeof t),n.info("calling PUT "+e," ("+t.length+")"),s("PUT",e,t,r,i,function(e,t){o(e,t)})}function a(e,t,n,r,i){typeof t=="undefined"?s("DELETE",e,null,null,r,i):u(e,t,n,r,i)}var n=t.getLogger("getputdelete"),r="application/octet-stream";return{get:o,set:a}}),n("lib/wireClient",["./getputdelete","./util"],function(e,t){function s(e,t){localStorage.setItem(n+e,JSON.stringify(t)),l(),i=="connected"&&r.emit("connected")}function o(e){localStorage.removeItem(n+e)}function u(e){var t=localStorage.getItem(n+e);if(typeof t=="string")try{return JSON.parse(t)}catch(r){localStorage.removeItem(n+e)}return null}function a(){t.grepLocalStorage(new RegExp("^"+n),function(e){localStorage.removeItem(e)})}function f(){return i}function l(){return u("storageType")&&u("storageHref")?u("bearerToken")?i="connected":i="authing":i="anonymous",i}function c(e,t){r.on(e,t)}function h(e){var t=u("storageHref");return t+e}function d(e){return p.test(e)}function v(t,n){if(d(t))return m(t,n);i!="connected"&&n(new Error("not-connected"));var r=u("bearerToken");typeof t!="string"?n(new Error('argument "path" should be a string')):e.get(h(t),r,n)}function m(t,n){var r=t.match(p),i=r[1],s=r[2],o=b(i);e.get(o+s,null,n)}function g(t,n,r,s){if(d(t))return s(new Error("Foreign storage is read-only"));i!="connected"&&s(new Error("not-connected"));var o=u("bearerToken");typeof t!="string"?s(new Error('argument "path" should be a string')):(n&&typeof n!="string"&&(n=JSON.stringify(n)),e.set(h(t),n,r,o,s))}function y(t,n){if(d(t))return n(new Error("Foreign storage is read-only"));var r=u("bearerToken");e.set(h(t),undefined,undefined,r,n)}function b(e){var t=u("storageInfo:"+e);if(!t)throw new Error("userAddress unknown to wireClient: "+e);return t.href}function w(e,t){s("storageInfo:"+e,t)}function E(e){return!!u("storageInfo:"+e)}var n="remote_storage_wire_",r=t.getEventEmitter("connected","error"),i="anonymous",p=/^([^\/][^:]+):(\/.*)$/;return{get:v,set:g,remove:y,setStorageInfo:function(e,t){s("storageType",e),s("storageHref",t)},getStorageHref:function(){return u("storageHref")},setBearerToken:function(e){s("bearerToken",e)},addStorageInfo:w,hasStorageInfo:E,disconnectRemote:a,on:c,getState:f,calcState:l}}),n("lib/store",["./util"],function(e){function o(e,t,n){var r=a(t);s.emit("change",{path:t,origin:e,oldValue:n,newValue:h(t),timestamp:r.timestamp})}function u(e,t){var n=a(e);s.emit("foreign-change",{path:e,oldValue:t,newValue:h(e),timestamp:n.timestamp})}function a(r){if(!r)throw new Error("No path given!");S(r);var i=localStorage.getItem(n+r),s;if(i)try{s=JSON.parse(i)}catch(o){t.error("Invalid node data in store: ",i)}return s||(s={startAccess:null,startForce:null,startForceTree:null,timestamp:0,lastUpdatedAt:0,mimeType:"application/json"},e.isDir(r)&&(s.diff={})),s}function f(e){S(e),localStorage.removeItem(n+e),localStorage.removeItem(r+e)}function l(){for(var e=0;e<localStorage.length;e++)if(localStorage.key(e).substr(0,n.length)==n||localStorage.key(e).substr(0,r.length)==r)localStorage.removeItem(localStorage.key(e)),e--}function c(e,t,n,r,i){var s=a(e),o;n||(s.lastUpdatedAt=r,o=h(e)),i||(i="application/json"),s.mimeType=i,N(e,t),C(e,t?s:undefined,n,!1,r,o)}function h(e,n){t.info("GET",e),S(e);var i=localStorage.getItem(r+e),o=a(e);if(i){if(!n&&o.mimeType=="application/json")try{return JSON.parse(i)}catch(u){s.emit("error","Invalid JSON node at "+e+": "+i)}return i}return undefined}function p(e,t){c(e,undefined,!1,t||E())}function d(e,t){var n=a(e);t!=n.startAccess&&(t=="rw"||n.startAccess==null)&&(n.startAccess=t,C(e,n,!1,!0))}function v(e,t,n){var r=a(e);r.startForce=t,r.startForceTree=n,C(e,r,!1,!0)}function m(e,t){var n=a(e);t?n.error=t:delete n.error,C(e,n,!1,!0)}function g(n,r){t.debug("clearDiff",n);var i=a(n);r&&(i.timestamp=i.lastUpdatedAt=r,C(n,i,!1,!0));var s=e.containingDir(n),o=e.baseName(n);if(s){var u=a(s);delete u.diff[o],C(s,u,!1,!0),Object.keys(u.diff).length===0&&g(s)}}function y(){function n(t){if(e.isDir(t)){var r=h(t);if(r)for(var i in r)n(t+i)}else o("device",t)}t.info("fire initial events"),n("/")}function b(e){return e.substring(0,n.length)==n}function w(t){var n=t.split("/");return e.isDir(t)?n[n.length-2]+"/":n[n.length-1]}function E(){return(new Date).getTime()}function S(e){if(e[0]!="/"&&!i.test(e))throw new Error("Invalid path: "+e)}function x(e){return e[0]!="/"}function T(e){var t=h(e);if(t){var n=[];for(var r in t)n.push(t[r]);return Math.max.apply(Math,n)}return E()}function N(e,t){S(e);if(!e)throw new Error("Path is required!");var n;typeof t!="undefined"?(typeof t=="object"?n=JSON.stringify(t):n=t,localStorage.setItem(r+e,n)):localStorage.removeItem(r+e)}function C(t,r,i,s,f,l){S(t);if(!s&&!f)if(i)f=E();else{if(!e.isDir(t))throw new Error("no timestamp given for node "+t);f=T(t)}r&&typeof f!="undefined"&&(r.timestamp=f),r?localStorage.setItem(n+t,JSON.stringify(r)):localStorage.removeItem(n+t);var c=e.containingDir(t);if(c){var p=a(c),d=h(c)||{},v=w(t);if(s){if(!d||!d[v])d[v]=0,N(c,d);C(c,p,!1,!0,f)}else if(i)r?d[v]=f:delete d[v],p.diff[v]=f,N(c,d),C(c,p,!0,!1,f);else{if(r){if(!d[v]||d[v]<f)d[v]=f,delete p.diff[v],N(c,d),C(c,p,!1,!1,f)}else d[v]&&(delete d[v],delete p.diff[v],N(c,d),C(c,p,!1,!1,f));e.isDir(t)||(x(t)?u(t,l):o("remote",t,l))}}}var t=e.getLogger("store"),n="remote_storage_nodes:",r="remote_storage_node_data:",i=/^[^@]+@[^:]+:\//,s=e.getEventEmitter("error","change","foreign-change");return typeof window!="undefined"&&window.addEventListener("storage",function(t){b(t.key)&&(e.isDir(t.key)||o("device",t.key.substring(n.length),t.oldValue))}),{getNode:a,getNodeData:h,setNodeData:c,clearDiff:g,removeNode:p,setNodeError:m,on:s.on,setNodeAccess:d,setNodeForce:v,forget:f,forgetAll:l,fireInitialEvents:y}}),n("lib/sync",["./wireClient","./store","./util"],function(e,t,n){function o(e){var t=localStorage.getItem(s+e);try{t=JSON.parse(t)}catch(n){}return t}function u(e,t){return typeof t!="string"&&(t=JSON.stringify(t)),localStorage.setItem(s+e,t)}function a(){for(var e=0;e<localStorage.length;e++){var t=localStorage.key(e);t.match(new RegExp("^"+s))&&localStorage.removeItem(t)}}function f(e){var r=t.getNodeData("/");for(var i in r)if(n.isDir(i)&&Object.keys(t.getNode("/"+i).diff).length>0)return!0;return!1}function l(e,t){function s(){r++,r==n.length&&e&&e.apply(this,arguments)}if(!P())return e&&e("not-connected");i.info("full "+(t?"push":"sync")+" started");var n=U(),r=0;if(n.length==0){i.info("full sync not happening. no access claimed.");return}n.forEach(function(e){y(function(){W(e,A,{pushOnly:t})},s)})}function c(e){l(e,!0)}function h(e,t,n){if(!P())return n&&n("not-connected");R(e),i.info("partial sync requested: "+e),y(function(){i.info("partial sync started from: "+e),r.once("ready",n),W(e,A,{depth:t})})}function p(e,n){if(!P())return n&&n("not-connected");R(e,!0),i.info("single sync requested: "+e),y(function(){i.info("single sync started: "+e),D(e,function(r){var i=O(e);A(e,i,r),n&&n(null,t.getNode(e),t.getNodeData(e))})})}function y(e,t){d?(g=t,e()):m.push({run:e,finalizer:t})}function b(){d=!1,r.emit("state","busy"),r.emit("busy")}function w(){d=!0,v.length>0?$.apply(this,v.shift()):(r.emit("state","connected"),r.emit("ready"))}function E(){d&&v.length==0&&r.emit("ready")}function S(){return d?"connected":"busy"}function x(e,t,n,i){r.emit("conflict",{type:e,path:t,localValue:n.data,remoteValue:i.data,localTime:new Date(n.timestamp),remoteTime:new Date(i.timestamp),lastUpdate:new Date(n.lastUpdatedAt),resolve:X(t,n,i)})}function T(e,t){var n={path:e};typeof t=="object"?(n.stack=t.stack,typeof (n.stack=="string")&&(n.stack=n.stack.split("\n")),n.message=t.message,n.exception=t):n.message=t,r.emit("error",n)}function N(e,n,r){i.info("DELETE",e,"REMOTE -> LOCAL");var s=t.getNodeData(e);t.removeNode(e,r.timestamp)}function C(r,s,o){i.info("DELETE",r,"LOCAL -> REMOTE"),e.remove(r,V(r,n.curry(t.clearDiff,r)))}function k(e,n,r){i.info("UPDATE",e,"REMOTE -> LOCAL"),t.setNodeData(e,r.data,!1,r.timestamp,r.mimeType)}function L(r,s,o){i.info("UPDATE",r,"LOCAL -> REMOTE"),e.set(r,s.data,s.mimeType,V(r,function(){M(n.containingDir(r),function(e){t.clearDiff(r,e[n.baseName(r)])})}))}function A(e,t,r){var s=null;if(t.deleted)i.debug(e,"outgoing delete"),s=C;else if(r.deleted&&t.lastUpdatedAt>0)t.timestamp==t.lastUpdatedAt?(i.debug(e,"incoming delete"),s=N):(i.debug(e,"deletion conflict","remote",r,"local",t),s=n.curry(x,"delete"));else{if(t.timestamp==r.timestamp){i.debug(e,"no action today");return}t.timestamp>r.timestamp?t.lastUpdatedAt==r.timestamp?(i.debug(e,"outgoing update"),s=L):(i.debug(e,"merge conflict (local > remote)","remote",r,"local",t),s=n.curry(x,"merge")):t.timestamp<r.timestamp&&(t.lastUpdatedAt==t.timestamp?(i.debug(e,"incoming update"),s=k):(i.debug(e,"merge conflict (local < remote)","remote",r,"local",t),s=n.curry(x,"merge")))}if(!s){var o=new Error("Something went terribly wrong.");throw o.path=e,o.localNode=t,o.remoteNode=r,o}s(e,t,r)}function O(e,r){i.info("fetch local",e);var s=t.getNode(e);s.data=t.getNodeData(e),I(e)&&(r=!1);if(typeof r=="undefined"){var o=n.containingDir(e);if(o){var u=n.baseName(e),a=t.getNode(o),f=t.getNodeData(o);r=!f[u]&&a.diff[u]}else r=!1}return s.deleted=r,s}function M(t,n){i.info("fetch remote",t),e.get(t,function(e,r,i){if(e)T(t,e);else try{n(r,i)}catch(s){T(t,s)}})}function _(e,t,n){return{timestamp:n,data:e,deleted:n==0,mimeType:t}}function D(e,t,r){function s(s,o){r(_(s,o,t&&t[n.baseName(e)]||(i?(new Date).getTime():0)))}var i=I(e);if(r)M(e,s);else{r=t,t=null;var o=n.containingDir(e);i?M(e,s):o?M(o,function(n){t=n,M(e,s)}):M(e,s)}}function P(){return e.getState()=="connected"}function H(e,t){var n={};for(var r=0;r<e.length;r++)n[e[r]]=!0;for(var i=0;i<t.length;i++)n[t[i]]=!0;return Object.keys(n)}function F(e){return j.test(e)}function I(e){return B.test(e)}function q(e,t){return F(e)||(t?I(e):!1)}function R(e,t){if(!q(e,t))throw new Error("Invalid path: "+e)}function U(e){var n=t.getNode("/"),r=[];return n.startAccess?r.push("/"):Object.keys(t.getNodeData("/")).forEach(function(e){t.getNode("/"+e).startAccess&&r.push("/"+e)}),r}function z(e){if(!e)return null;var r=t.getNode(e);return r.startAccess?r.startAccess:z(n.containingDir(e))}function W(e,r,s){i.info("traverse",e);if(!n.isDir(e))throw"Can't traverse data node: "+e;s||(s={});var o=s.done||function(){};(s.depth||s.depth==0)&&i.debug("traverse depth",s.depth,e);var u=t.getNode(e),a=t.getNodeData(e);a||(a={},t.setNodeData(e,a,!1,0,"application/json")),s.access=n.highestAccess(s.access,u.startAccess),s.force=s.force||u.startForce,s.forceTree=s.forceTree||u.startForceTree,s.access||(s.access=z(n.containingDir(e)));if(!s.access&&e!="/"&&!s.force&&!s.forceTree){i.debug("skipping",e,"no interest","(access: ",s.access," force: ",s.force," forceTree: ",s.forceTree,")"),E(),o();return}var f=Object.keys(u.diff).length>0;if(!f&&s.pushOnly){E(),o();return}M(e,function(l){l||(l={}),o();var c=H(Object.keys(l),Object.keys(a));s.forceTree&&!s.force&&Object.keys(a).length==0&&(c.forEach(function(e){a[e]=0}),t.setNodeData(e,a,!1,0,"application/json"));if(!f){var h=!1;for(var p=0;p<c.length;p++){var d=c[p];if(a[d]!=l[d]){h=!0;break}}if(!h){i.debug("skipping",e,"no changes"),E();return}}$(c,6,function(t,i){var o=e+t;if(n.isDir(t))if(s.depth&&s.depth==1)i();else{var f=n.extend({},s);f.depth&&f.depth--,f.done=i,W(o,r,f)}else s.force?D(o,l,function(e){var n=O(o,!a[t]&&u.diff[t]);r(o,n,e),i()}):i()})})}function X(e,t,n){return function(r,i){if(r=="local")i&&(t.data=i,k(e,t,t)),L(e,t,n);else{if(r!="remote")throw"Invalid conflict resolution: "+r;k(e,t,n)}}}function V(e,t){return function(n){if(n)T(e,n);else if(t){var r=Array.prototype.slice.call(arguments,1);t.apply(this,r)}}}function $(e,t,n){function s(){r++,n(e[i++],o)}function o(){r--,i==e.length&&r==0?w():i<e.length&&u()}function u(){while(r<t&&i<e.length)s()}if(!d){v.push([e,t,n]);return}b();var r=0,i=0;setTimeout(u,1)}function J(e,t,n){return function(){var r=Array.prototype.slice.call(arguments),s=r.slice(-1)[0],a=r;typeof s=="function"?a=r.slice(0,-1):s=null;var f=(new Date).getTime(),l=[e,a],c=o("limitCache")||{};c[l]&&c[l]>f-n?(i.debug("limit",e,"-> replay"),s&&s()):(i.debug("limit",e,"-> call through"),c[l]=f,u("limitCache",c),t.apply(this,r))}}var r=n.getEventEmitter("error","conflict","state","busy","ready"),i=n.getLogger("sync"),s="remote_storage_sync:",d=!0,v=[],m=[],g=null;r.on("ready",function(){i.info("READY","queued tasks: ",m.length),g&&(g(),g=null);if(m.length>0){var e=m.shift();g=e.finalizer,e.run()}});var B=/^[^\/][^:]+:\//,j=/^\//;r.on("error",function(e){i.error("Error: ",e)});var K=J("fullSync",l,3e4),Q=J("partialSync",h,3e4),G={fullSync:K,forceSync:l,fullPush:c,partialSync:Q,syncOne:p,needsSync:f,getState:S,on:r.on,clearSettings:a,syncNow:function(e,t){n.deprecate("sync.syncNow","sync.fullSync"),this.fullSync(t)},fetchNow:function(e,t){n.deprecate("sync.fetchNow","sync.syncOne or sync.partialSync"),this.syncOne(e,t)},disableThrottling:function(){G.fullSync=l,G.partialSync=h}};return G}),n("lib/widget",["./assets","./webfinger","./hardcoded","./wireClient","./sync","./store","./platform","./util"],function(e,t,n,r,i,s,o,u){function E(e){return e}function S(){var e=r.getState();return e=="connected"?i.getState():e}function x(){T(S())}function T(e,t){l=e,t!==!1&&k(e,c),y.emit("state",e)}function N(){return l}function C(){function t(e,t,n){var r=document.createElement(e);t&&r.setAttribute("id",t),n&&n._content&&(r.innerHTML=n._content,delete n._content);for(var i in n)r.setAttribute(i,n[i]);return r}var n={root:t("div","remotestorage-state"),connectButton:t("input","remotestorage-connect-button",{"class":"remotestorage-button",type:"submit",value:E("connect")}),registerButton:t("span","remotestorage-register-button",{"class":"remotestorage-button",_content:E("get remotestorage")}),cube:t("img","remotestorage-cube",{src:e.remoteStorageCube}),bubble:t("span","remotestorage-bubble"),helpHint:t("a","remotestorage-questionmark",{href:"http://unhosted.org/#remotestorage",target:"_blank"}),helpText:t("span","remotestorage-infotext",{"class":"infotext",_content:"This app allows you to use your own data storage!<br/>Click for more info on the Unhosted movement."}),userAddress:t("input","remotestorage-useraddress",{placeholder:"user@host"}),style:t("style")};return n.root.appendChild(n.connectButton),n.root.appendChild(n.registerButton),n.root.appendChild(n.cube),n.root.appendChild(n.bubble),n.root.appendChild(n.helpHint),n.root.appendChild(n.helpText),n.root.appendChild(n.userAddress),n.style.innerHTML=e.widgetCss,n}function k(e,t){if(e==="authing")return o.alert("Authentication was aborted. Please try again."),T("typing");if(!m){var n=document.getElementById(f);m=C(),m.registerButton.addEventListener("click",L),m.connectButton.addEventListener("click",F),m.bubble.addEventListener("click",I),m.cube.addEventListener("click",q),m.userAddress.addEventListener("keyup",R),n.appendChild(m.style),n.appendChild(m.root)}m.root.setAttribute("class",e);var t=localStorage.remote_storage_widget_useraddress||"";t?(m.userAddress.value=t,t="<strong>"+t+"</strong>"):t="<strong>(n/a)</strong>";var r="",i=!1;d?(r="Connecting "+t,i=!0):e=="connected"?r="Disconnect "+t:e=="busy"?r="Synchronizing "+t+"...":e=="offline"&&(g=="unauthorized"?(r="Access denied by remotestorage. Click to reconnect.",i=!0):r="Offline ("+t+")"),m.bubble.innerHTML=r,i?(m.cube.setAttribute("style","opacity:1"),m.bubble.setAttribute("style","display:inline")):(m.cube.removeAttribute("style"),m.bubble.removeAttribute("style")),e==="typing"&&m.userAddress.focus()}function L(){window.open("http://unhosted.org/en/a/register.html","Get your remote storage",b)}function A(e){if(e.substring(0,"http://".length)=="http://")e=e.substring("http://".length);else{if(e.substring(0,"https://".length)!="https://")return e;e=e.substring("https://".length)}var t=e.split("/")[0].split("@");return t.length>2?e:(t.length==2&&t.shift(),t[0])}function O(){p=window.open(document.location,"remotestorageAuthPopup",b+",dependent=yes"),window.remotestorageTokenReceived=function(){delete window.remotestorageTokenReceived,x()}}function M(){p.close()}function _(e){p.document.location=e}function D(){if(!frames.opener)return;frames.opener.remotestorageTokenReceived(),window.close()}function P(){var e=localStorage.remote_storage_widget_auth_endpoint,t=e.split("?"),n=[];t.length==2?n=t[1].split("&"):t.length>2&&errorHandler("more than one questionmark in auth-endpoint - ignoring");var r=o.getLocation(),i=[];for(var s in v)i.push(s+":"+v[s]);n.push("response_type=token"),n.push("scope="+encodeURIComponent(i.join(" "))),n.push("redirect_uri="+encodeURIComponent(r)),n.push("client_id="+encodeURIComponent(A(r)));var u=t[0]+"?"+n.join("&");if(typeof h=="function")h(u);else switch(h){case"redirect":o.setLocation(u);break;case"popup":_(u);break;default:throw"Invalid strategy for auth dialog: "+h}}function H(e,i){t.getStorageInfo(e,{timeout:5e3},function(t,s){t?n.guessStorageInfo(e,{timeout:5e3},function(e,n){e?(w.debug("Error from fakefinger: "+e),i(t)):n.type&&n.href&&s.properties&&s.properties["auth-endpoint"]?(r.setStorageInfo(n.type,n.href),i(null,n.properties["auth-endpoint"])):i("cannot make sense of storageInfo from webfinger")}):s.type&&s.href&&s.properties&&s.properties["auth-endpoint"]?(r.setStorageInfo(s.type,s.href),i(null,s.properties["auth-endpoint"])):i("cannot make sense of storageInfo from hardcoded")})}function j(e,t){typeof t=="undefined"&&(t=0),H(e,function(n,r){n?(n=="timeout"&&t!=B?j(e,t+1):o.alert("webfinger discovery failed! Please check if your user address is correct and try again. If the problem persists, contact your storage provider for support. (Error is: "+n+")"),h=="popup"&&M(),T("failed")):(localStorage.remote_storage_widget_auth_endpoint=r,P())})}function F(){l=="typing"?(c=m.userAddress.value,localStorage.remote_storage_widget_useraddress=c,T("connecting"),h=="popup"&&O(),j(c)):T("typing")}function I(){l=="connected"||l=="busy"?i.fullPush(function(){r.disconnectRemote(),s.forgetAll(),i.clearSettings(),T("disconnected",!0),T("anonymous")}):l=="offline"&&g=="unauthorized"&&P()}function q(){(l=="connected"||l=="connected")&&I()}function R(e){e.keyCode===13&&m.connectButton.click()}function U(){w.debug("handleWidgetHover")}function z(){console.log("NOW CONNECTED"),T("connected"),d=!0,s.fireInitialEvents(),i.forceSync(function(){w.info("Initial sync done."),d=!1,T(N()),y.emit("ready")})}function W(e,t){var n=o.harvestParam("access_token"),s=o.harvestParam("storage_root"),u=o.harvestParam("storage_api"),c=o.harvestParam("authorize_endpoint");t||(t={}),i.on("error",function(e){e.message=="unauthorized"&&(g="unauthorized",d&&(d=!1,y.emit("ready")),T("offline"))}),f=e,r.calcState()=="connected"?z():r.on("connected",z),r.on("error",function(e){o.alert(E(e))}),i.on("state",T),typeof t.authDialog!="undefined"&&(h=t.authDialog),a=t.locale,n&&(r.setBearerToken(n),h==="popup"&&D()),s&&r.setStorageInfo(u?u:"2012.04",s),c&&(localStorage.remote_storage_widget_auth_endpoint=c,P()),x(),t.syncShortcut!==!1&&window.addEventListener("keydown",function(e){if(e.ctrlKey&&e.which==83)return e.preventDefault(),i.fullSync(),!1}),window.addEventListener("beforeunload",function(e){if(l!="anonymous"&&l!="authing"&&i.needsSync()){i.fullPush();var t="Synchronizing your data now. Please wait until the cube stops spinning.";return e.returnValue=t,t}})}function X(e,t){if(!v[e]||t=="rw")v[e]=t}var a="en",f,l,c,h="redirect",p,d,v={},m,g,y=u.getEventEmitter("state","ready"),b="resizable,toolbar=yes,location=yes,scrollbars=yes,menubar=yes,width=820,height=800,top=0,left=0",w=u.getLogger("widget"),B=2;return{display:W,addScope:X,getState:N,on:y.on}}),n("lib/nodeConnect",["./wireClient","./webfinger"],function(e,t){return{setUserAddress:function(n,r){t.getStorageInfo(n,{timeout:3e3},function(t,i){t?console.error("Failed to look up storage info for user "+n+": ",t):e.setStorageInfo(i.type,i.href),r(t)})},setStorageInfo:e.setStorageInfo,setBearerToken:e.setBearerToken}}),n("lib/validate",[],function(){function n(e,t){return n(e,t,{changing:!1})}var e=n;e.Integer={type:"integer"};var t={String:String,Boolean:Boolean,Number:Number,Object:Object,Array:Array,Date:Date};e.validate=n,e.checkPropertyChange=function(e,t,r){return n(e,t,{changing:r||"property"})};var n=e._validate=function(e,n,r){function s(e){return e.type||t[e.name]==e&&e.name.toLowerCase()}function u(e,t,n,f){function c(e){o.push({property:n,message:e})}function h(e,t){if(e){if(!(typeof e!="string"||e=="any"||(e=="null"?t===null:typeof t==e)||t instanceof Array&&e=="array"||t instanceof Date&&e=="date"||e=="integer"&&t%1===0))return[{property:n,message:typeof t+" value found, but a "+e+" is required"}];if(e instanceof Array){var r=[];for(var i=0;i<e.length;i++)if(!(r=h(e[i],t)).length)break;if(r.length)return r}else if(typeof e=="object"){var s=o;o=[],u(t,e,n);var a=o;return o=s,a}}return[]}var l;n+=n?typeof f=="number"?"["+f+"]":typeof f=="undefined"?"":"."+f:f;if((typeof t!="object"||t instanceof Array)&&(n||typeof t!="function")&&(!t||!s(t)))return typeof t=="function"?e instanceof t||c("is not an instance of the class/constructor "+t.name):t&&c("Invalid schema/property definition "+t),null;i&&t.readonly&&c("is a readonly field, it can not be changed"),t["extends"]&&u(e,t["extends"],n,f);if(e===undefined)t.required&&c("is missing and it is required");else{o=o.concat(h(s(t),e)),t.disallow&&!h(t.disallow,e).length&&c(" disallowed value was matched");if(e!==null){if(e instanceof Array){if(t.items){var p=t.items instanceof Array,d=t.items;for(f=0,l=e.length;f<l;f+=1)p&&(d=t.items[f]),r.coerce&&(e[f]=r.coerce(e[f],d)),o.concat(u(e[f],d,n,f))}t.minItems&&e.length<t.minItems&&c("There must be a minimum of "+t.minItems+" in the array"),t.maxItems&&e.length>t.maxItems&&c("There must be a maximum of "+t.maxItems+" in the array")}else(t.properties||t.additionalProperties)&&o.concat(a(e,t.properties,n,t.additionalProperties));t.pattern&&typeof e=="string"&&!e.match(t.pattern)&&c("does not match the regex pattern "+t.pattern),t.maxLength&&typeof e=="string"&&e.length>t.maxLength&&c("may only be "+t.maxLength+" characters long"),t.minLength&&typeof e=="string"&&e.length<t.minLength&&c("must be at least "+t.minLength+" characters long"),typeof t.minimum!==undefined&&typeof e==typeof t.minimum&&t.minimum>e&&c("must have a minimum value of "+t.minimum),typeof t.maximum!==undefined&&typeof e==typeof t.maximum&&t.maximum<e&&c("must have a maximum value of "+t.maximum);if(t["enum"]){var v=t["enum"];l=v.length;var m;for(var g=0;g<l;g++)if(v[g]===e){m=1;break}m||c("does not have a value in the enumeration "+v.join(", "))}typeof t.maxDecimal=="number"&&e.toString().match(new RegExp("\\.[0-9]{"+(t.maxDecimal+1)+",}"))&&c("may only have "+t.maxDecimal+" digits of decimal places")}}return null}function a(e,t,n,s){if(typeof t=="object"){(typeof e!="object"||e instanceof Array)&&o.push({property:n,message:"an object is required"});for(var a in t)if(t.hasOwnProperty(a)){var f=e[a];if(f===undefined&&r.existingOnly)continue;var l=t[a];f===undefined&&l["default"]&&(f=e[a]=l["default"]),r.coerce&&a in e&&(f=e[a]=r.coerce(f,l)),u(f,l,n,a)}}for(a in e){if(e.hasOwnProperty(a)&&(a.charAt(0)!="_"||a.charAt(1)!="_")&&t&&!t[a]&&s===!1){if(r.filter){delete e[a];continue}o.push({property:n,message:typeof f+"The property "+a+" is not defined in the schema and the schema does not allow additional properties"})}var c=t&&t[a]&&t[a].requires;c&&!(c in e)&&o.push({property:n,message:"the presence of the property "+a+" requires that "+c+" also be present"}),f=e[a],s&&(!t||typeof t!="object"||!(a in t))&&(r.coerce&&(f=e[a]=r.coerce(f,s)),u(f,s,n,a)),!i&&f&&f.$schema&&(o=o.concat(u(f,f.$schema,n,a)))}return o}r||(r={});var i=r.changing,o=[];return n&&u(e,n,"",i||""),!i&&e&&e.$schema&&u(e,e.$schema,"",""),{valid:!o.length,errors:o}};return e.mustBeValid=function(e){if(!e.valid)throw new TypeError(e.errors.map(function(e){return"for property "+e.property+": "+e.message}).join(", \n"))},e}),n("lib/baseClient",["./sync","./store","./util","./validate"],function(e,t,n,r){function o(e){if(e&&typeof e=="string"){var t=e.split("/");if(t.length>3&&t[1]=="public")return t[2];if(t.length>2)return t[1]}}function a(e,t,n){var r=u.test(n.path),i;s[t]&&(i=s[t][r])&&(t!=="root"&&n.path&&(n.relativePath=n.path.replace((r?"/public/":"/")+t+"/","")),i.emit(e,n))}function f(e,t){var n=u.test(e);s[moduleName][n].emit("error",t)}function l(e,r,i){var s=o(r);if(n.isDir(r)){f(r,"attempt to set a value to a directory "+r);return}var u={origin:"window",oldValue:t.getNodeData(r),newValue:i,path:r};t.setNodeData(r,i,!0),a("change",s,u),a("change","root",u)}var i=n.getLogger("baseClient"),s={},u=/^\/public\//;t.on("change",function(e){var t=o(e.path);a("change",t,e),a("change","root",e)}),e.on("conflict",function(e){var t=o(e.path);a("conflict",t,e),a("conflict","root",e)});var c=function(e,t){this.moduleName=e,this.isPublic=t,s[e]||(s[e]={}),this.events=n.getEventEmitter("change","conflict","error"),s[e][t]=this.events,n.bindAll(this)};return c.prototype={makePath:function(e){var t=this.moduleName=="root"?e[0]==="/"?"":"/":"/"+this.moduleName+"/";return(this.isPublic?"/public"+t:t)+e},nodeGivesAccess:function(e,n){var r=t.getNode(e),i=(new RegExp(n)).test(r.startAccess);if(i)return!0;if(e.length>0)return this.nodeGivesAccess(e.replace(/[^\/]+\/?$/,""))},ensureAccess:function(e){var t=this.makePath(this.moduleName=="root"?"/":"");if(!this.nodeGivesAccess(t,e))throw"Not sufficient access claimed for node at "+t},lastUpdateOf:function(e){var n=this.makePath(e),r=t.getNode(n);return r?r.timestamp:null},on:function(e,t,r){this.events.on(e,n.bind(t,r))},getObject:function(r,i,s){this.ensureAccess("r");var o=this.makePath(r),u=t.getNodeData(o);if(!i)return u;var a=n.bind(i,s);!u||typeof u=="object"&&Object.keys(u).length==0?e.syncOne(o,function(e,t){a(t)}):a(u)},getListing:function(r,i,s){this.ensureAccess("r");var o=this.makePath(r);if(!i){var u=t.getNode(o),a=t.getNodeData(o),f=[];for(var l in a)f.push(l);return f}e.fetchNow(o,function(e,r){var u=t.getNodeData(o),a=[];for(var f in u)a.push(f);n.bind(i,s)(a)})},getAll:function(e,t,r,i){typeof t!="string"&&(t=e,r=t,i=r,e=null);var s=function(n){var r={};return n.forEach(function(n){var i=this.getObject(t+n);if(!e||e==i["@type"].split("/").slice(-1)[0])r[t+n]=i},this),r}.bind(this);if(!r)return s(this.getListing(t));this.getListing(t,function(e){n.bind(r,i)(s(e))},this)},getDocument:function(r,i,s){function u(){var e=t.getNode(o);return e?{mimeType:e.mimeType,data:t.getNodeData(o)}:null}this.ensureAccess("r");var o=this.makePath(r),a=u();if(!i)return a;var f=n.bind(i,s);a?f(a):e.syncOne(o,function(){f(u())})},remove:function(t,r,i){this.ensureAccess("w");var s=this.makePath(t);l(t,s,undefined),e.syncOne(s,n.bind(r,i))},storeObject:function(t,r,i,s,o){this.ensureAccess("w");if(typeof i!="object")throw"storeObject needs to get an object as value!";i["@type"]=this.resolveType(t);var u=this.validateObject(i);if(u)return console.error("Error saving this ",t,": ",i,u),u;var a=this.makePath(r);return l(r,a,i,"application/json"),e.syncOne(a,n.bind(s,o)),null},storeDocument:function(t,r,i,s,o){this.ensureAccess("w");var u=this.makePath(r);l(r,u,i,t),e.syncOne(u,n.bind(s,o))},getStorageHref:function(){return remoteStorage.getStorageHref()},getItemURL:function(e){var t=this.getStorageHref();return t?(t.substr(-1)!="/"&&(t+="/"),t+this.makePath(e)):null},syncOnce:function(n,r){var i=t.getNode(n).startForceTree;this.use(n,!1),e.partialSync(n,1,function(){i?this.use(n,!0):this.release(n),r&&r()}.bind(this))},use:function(e,n){var r=this.makePath(e);t.setNodeForce(r,!n,!0)},release:function(e){var n=this.makePath(e);t.setNodeForce(n,!1,!1)},hasDiff:function(e){var r=this.makePath(e);if(n.isDir(r))return Object.keys(t.getNode(r).diff).length>0;var i=n.containingDir(r);return!!t.getNode(i).diff[e.split("/").slice(-1)[0]]},types:{},schemas:{},resolveType:function(e){var t=this.types[e];return t||(t="https://remotestoragejs.com/spec/modules/"+this.moduleName+"/"+e,i.error("WARNING: type alias not declared: "+e,"(have:",this.types,this.schemas,")")),t},resolveSchema:function(e){var t=this.schemas[e];return t||(t={},i.error("WARNING: can't find schema for type: ",e)),t},declareType:function(e,t,n){this.types[e]&&i.error("WARNING: re-declaring already declared alias "+e),n||(n=t,t="https://remotestoragejs.com/spec/modules/"+this.moduleName+"/"+e);if(n["extends"]){var r=this.types[n["extends"]];if(!r){i.error("Type '"+e+"' tries to extend unknown schema '"+n["extends"]+"'");return}n["extends"]=this.schemas[r]}this.types[e]=t,this.schemas[t]=n},validateObject:function(e,t){var n=e["@type"];if(!n){if(!t)return[{property:"@type",message:"missing"}];n=this.resolveType(t)}var i=this.resolveSchema(n),s=r(e,i);return s.valid?null:s.errors}},c}),n("lib/foreignClient",["./util","./baseClient","./getputdelete","./store"],function(e,t,n,r){var i=e.getLogger("foreignClient"),s={};r.on("foreign-change",function(e){var t=e.path.split(":")[0],n=s[t];n&&n.events.emit("change",e)});var o=function(t){this.userAddress=t,this.pathPrefix=t+":",this.moduleName="root",this.isPublic=!0,this.events=e.getEventEmitter("change","error"),s[t]=this,e.bindAll(this)};o.prototype={getPublished:function(e,t){var n;typeof e=="function"?(t=e,n="/publishedItems"):n="/"+e+"/publishedItems",this.getObject(n,function(e){e&&delete e["@type"],t(e||{})})},getPublishedObjects:function(e,t){this.getPublished(e,function(n){function o(){if(i<r.length){var n=r[i++],u="/"+e+"/"+n;this.getObject(u,function(e){s[u]=e,o.call(this)}.bind(this))}else t(s)}var r=Object.keys(n),i=0,s={};o.call(this)}.bind(this))},makePath:function(e){return this.pathPrefix+t.prototype.makePath.call(this,e)},nodeGivesAccess:function(e,t){return t=="r"},on:function(e,t){this.events.on(e,t)}};var u={makePath:!0,getListing:!0,getAll:!0,storeDocument:!0,storeObject:!0,remove:!0,nodeGivesAccess:!0,fetchNow:!0,syncNow:!0,on:!0};for(var a in t.prototype)u[a]||(o.prototype[a]=t.prototype[a]);return{getClient:function(e){var t=s[e];return t||new o(e)}}}),n("remoteStorage",["require","./lib/widget","./lib/store","./lib/sync","./lib/wireClient","./lib/nodeConnect","./lib/util","./lib/webfinger","./lib/foreignClient","./lib/baseClient"],function(e,t,n,r,i,s,o,u,a,f){var l={},c={},h=/^[a-z]+$/,p=o.getLogger("base"),d={defineModule:function(e,t){if(!h.test(e))throw'Invalid moduleName: "'+e+'", only a-z lowercase allowed.';var n=t(new f(e,!1),new f(e,!0));c[e]=n,this[e]=n.exports},getModuleList:function(){return Object.keys(c)},getClaimedModuleList:function(){return Object.keys(l)},getModuleInfo:function(e){return c[e]},claimAccess:function(e,t){function r(e,t){if(!n.test(t))throw"Claimed access to module '"+e+"' but mode not correctly specified ('"+t+"')."}var n=/^rw?$/,i;typeof e=="object"?i=e:(r(e,t),i={},i[e]=t);for(var s in i){var o=i[s];r(s,o),this.claimModuleAccess(s,o)}},claimModuleAccess:function(e,r){p.debug("claimModuleAccess",e,r);if(!(e in c))throw"Module not defined: "+e;if(e in l)return;e=="root"?(e="",t.addScope("",r),n.setNodeAccess("/",r)):(t.addScope(e,r),n.setNodeAccess("/"+e+"/",r),n.setNodeAccess("/public/"+e+"/",r)),l[e]=!0},setBearerToken:function(e,t){i.setBearerToken(e)},disconnectRemote:i.disconnectRemote,flushLocal:n.forgetAll,fullSync:r.fullSync,syncNow:function(e,t,n){t||(n=t,t=null),r.partialSync(e,t,n)},displayWidget:t.display,onWidget:t.on,getWidgetState:t.getState,getSyncState:r.getState,setStorageInfo:i.setStorageInfo,getStorageHref:i.getStorageHref,disableSyncThrottling:r.disableThrottling,nodeConnect:s,util:o,getForeignClient:function(e,t){var n=a.getClient(e);i.hasStorageInfo(e)?t(null,n):u.getStorageInfo(e,{timeout:5e3},function(r,s){r?t(r):(i.addStorageInfo(e,s),t(null,n))})},getClient:function(e){return new f(e)}};return d}),global.localStorage={getItem:function(e){return this[e]},setItem:function(e,t){this[e]=t},removeItem:function(e){delete this[e]}},module.exports=t("remoteStorage")})()