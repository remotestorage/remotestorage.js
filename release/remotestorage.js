/*! For license information please see remotestorage.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("RemoteStorage",[],t):"object"==typeof exports?exports.RemoteStorage=t():e.RemoteStorage=t()}(this,(function(){return function(){var e={548:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Access=void 0;class r{constructor(){this.reset()}get scopes(){return Object.keys(this.scopeModeMap).map((e=>({name:e,mode:this.scopeModeMap[e]})))}get scopeParameter(){return this.scopes.map((e=>`${this._scopeNameForParameter(e)}:${e.mode}`)).join(" ")}claim(e,t){if("string"!=typeof e||-1!==e.indexOf("/")||0===e.length)throw new Error("Scope should be a non-empty string without forward slashes");if("string"!=typeof t||!t.match(/^rw?$/))throw new Error("Mode should be either 'r' or 'rw'");this._adjustRootPaths(e),this.scopeModeMap[e]=t}get(e){return this.scopeModeMap[e]}remove(e){const t={};for(const e in this.scopeModeMap)t[e]=this.scopeModeMap[e];this.reset(),delete t[e];for(const e in t)this.claim(e,t[e])}checkPermission(e,t){const r=this.get(e);return r&&("r"===t||"rw"===r)}checkPathPermission(e,t){if(this.checkPermission("*",t))return!0;const r=this._getModuleName(e);return!!this.checkPermission(r,t)}reset(){this.rootPaths=[],this.scopeModeMap={}}_getModuleName(e){if("/"!==e[0])throw new Error("Path should start with a slash");const t=e.replace(/^\/public/,"").match(/^\/([^/]*)\//);return t?t[1]:"*"}_adjustRootPaths(e){"*"in this.scopeModeMap||"*"===e?this.rootPaths=["/"]:e in this.scopeModeMap||(this.rootPaths.push("/"+e+"/"),this.rootPaths.push("/public/"+e+"/"))}_scopeNameForParameter(e){if("*"===e.name&&this.storageType){if("2012.04"===this.storageType)return"";if(this.storageType.match(/remotestorage-0[01]/))return"root"}return e.name}setStorageType(e){this.storageType=e}static _rs_init(){}}t.Access=r,t.default=r},275:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Authorize=void 0;const n=s(r(334)),i=r(746),a=s(r(503)),c=r(368);let l;function u(e){const t=e||h.getLocation().href,r={};for(const[e,o]of new URL(t).searchParams)r[e]=o;const o=t.indexOf("#");if(-1===o)return r;const s=t.substring(o+1);return s.includes("=")?s.split("&").reduce((function(e,t){const r=t.split("=");if("state"===r[0]&&r[1].match(/rsDiscovery/)){let t=decodeURIComponent(r[1]);const o=t.substr(t.indexOf("rsDiscovery=")).split("&")[0].split("=")[1];e.rsDiscovery=JSON.parse(atob(o)),t=t.replace(new RegExp("&?rsDiscovery="+o),""),t.length>0&&(e.state=t)}else e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]);return e}),r):r}class h{static authorize(e,t){if((0,n.default)("[Authorize] authURL = ",t.authURL,"scope = ",t.scope,"redirectUri = ",t.redirectUri,"clientId = ",t.clientId,"response_type =",t.response_type),!t.scope)throw new Error("Cannot authorize due to undefined or empty scope; did you forget to access.claim()?");if(!(0,i.localStorageAvailable)()&&"remotestorage"===e.backend){t.redirectUri+=t.redirectUri.indexOf("#")>0?"&":"#";const r={userAddress:e.remote.userAddress,href:e.remote.href,storageApi:e.remote.storageApi,properties:e.remote.properties};t.redirectUri+="rsDiscovery="+(0,i.toBase64)(JSON.stringify(r))}const r=function(e){const t=new URL(e.redirectUri);e.state||(e.state=t.hash?t.hash.substring(1):""),e.response_type||(e.response_type="token");const r=new URL(e.authURL);r.searchParams.set("redirect_uri",e.redirectUri.replace(/#.*$/,"")),r.searchParams.set("scope",e.scope),r.searchParams.set("client_id",e.clientId);for(const t of["state","response_type","code_challenge","code_challenge_method","token_access_type"]){const o=e[t];o&&r.searchParams.set(t,o)}return r.href}(t);i.globalContext.cordova?h.openWindow(r,t.redirectUri,"location=yes,clearsessioncache=yes,clearcache=yes").then((t=>{e.remote.configure({token:t.access_token})})):h.setLocation(r)}static refreshAccessToken(e,t,r){return o(this,void 0,void 0,(function*(){var e,o,s;yield t.configure({token:null,tokenType:null});const i=new URLSearchParams({grant_type:"refresh_token",client_id:t.clientId,refresh_token:r}),l=yield(0,c.requestWithTimeout)("POST",t.TOKEN_URL,{headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString(),responseType:"json"});if(200!==(null==l?void 0:l.status))throw yield t.configure({refreshToken:null}),new a.default("refresh token rejected:"+JSON.stringify(l.response));{(0,n.default)(`[Authorize] access token good for ${null===(e=null==l?void 0:l.response)||void 0===e?void 0:e.expires_in} seconds`);const r={token:null===(o=null==l?void 0:l.response)||void 0===o?void 0:o.access_token,tokenType:null===(s=null==l?void 0:l.response)||void 0===s?void 0:s.token_type};if(!r.token)throw new Error(`no access_token in "successful" refresh: ${l.response}`);yield t.configure(r)}}))}static setLocation(e){if("string"==typeof e)document.location.href=e;else{if("object"!=typeof e)throw"Invalid location "+e;document.location=e}}static _rs_supported(){return"undefined"!=typeof document}static _rs_cleanup(e){e.removeEventListener("features-loaded",l)}}t.Authorize=h,h.IMPLIED_FAKE_TOKEN=!1,h.getLocation=function(){return document.location},h.openWindow=function(e,t,r){return new Promise(((o,s)=>{const n=open(e,"_blank",r);function i(){s("Authorization was canceled")}n&&!n.closed?(n.addEventListener("loadstart",(function(e){if(0!==e.url.indexOf(t))return;n.removeEventListener("exit",i),n.close();const r=u(e.url);r?o(r):s("Authorization error")})),n.addEventListener("exit",i)):s("Authorization popup was blocked")}))},h._rs_init=function(e){const t=u();let r;t&&(r=h.getLocation(),r.hash=""),l=function(){let s=!1;if(t){if(t.error)throw"access_denied"===t.error?new a.default("Authorization failed: access denied",{code:"access_denied"}):new a.default(`Authorization failed: ${t.error}`);t.rsDiscovery&&e.remote.configure(t.rsDiscovery),t.access_token&&(e.remote.configure({token:t.access_token}),s=!0),t.remotestorage&&(e.connect(t.remotestorage),s=!0),t.state&&(r=h.getLocation(),h.setLocation(r.href.split("#")[0]+"#"+t.state)),t.code&&(function(t){o(this,void 0,void 0,(function*(){var o,s,i,a;const l=sessionStorage.getItem("remotestorage:codeVerifier");if(!l)return void(0,n.default)("[Authorize] Ignoring OAuth code parameter, because no PKCE code verifier found in sessionStorage");r=h.getLocation();let u=r.origin;"/"!==r.pathname&&(u+=r.pathname);const d=new URLSearchParams({code:t,grant_type:"authorization_code",client_id:e.remote.clientId,redirect_uri:u,code_verifier:l}),f=yield(0,c.requestWithTimeout)("POST",e.remote.TOKEN_URL,{headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d.toString(),responseType:"json"});if(200===f.status){(0,n.default)(`[Authorize] access token good for ${null===(o=null==f?void 0:f.response)||void 0===o?void 0:o.expires_in} seconds`);const t={token:null===(s=null==f?void 0:f.response)||void 0===s?void 0:s.access_token,refreshToken:null===(i=null==f?void 0:f.response)||void 0===i?void 0:i.refresh_token,tokenType:null===(a=null==f?void 0:f.response)||void 0===a?void 0:a.token_type};t.token?e.remote.configure(t):e._emit("error",new Error(`no access_token in "successful" response: ${f.response}`)),sessionStorage.removeItem("remotestorage:codeVerifier")}else e._emit("error",new Error(`${f.statusText}: ${f.response}`))}))}(t.code),s=!0),s||e.remote.stopWaitingForToken()}else e.remote.stopWaitingForToken()},e.on("features-loaded",l)},t.default=h},424:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseClient=void 0;const n=s(r(439)),i=s(r(613)),a=s(r(491)),c=s(r(93)),l=s(r(28)),u=r(746);class h{constructor(e,t){if(this.schemas={configurable:!0,get(){return h.Types.inScope(this.moduleName)}},"/"!==t[t.length-1])throw"Not a folder: "+t;"/"===t&&(this.makePath=e=>("/"===e[0]?"":"/")+e),this.storage=e,this.base=t,this.moduleName=function(e){const t=e.split("/");return e.length>2?t[1]:"root"}(this.base),this.addEvents(["change"]),this.on=this.on.bind(this),e.onChange(this.base,this._fireChange.bind(this))}scope(e){return new h(this.storage,this.makePath(e))}getListing(e,t){return o(this,void 0,void 0,(function*(){if("string"!=typeof e)e="";else if(e.length>0&&!(0,u.isFolder)(e))return Promise.reject("Not a folder: "+e);return this.storage.get(this.makePath(e),t).then((e=>404===e.statusCode?{}:e.body))}))}getAll(e,t){return o(this,void 0,void 0,(function*(){if("string"!=typeof e)e="";else if(e.length>0&&!(0,u.isFolder)(e))return Promise.reject("Not a folder: "+e);return this.storage.get(this.makePath(e),t).then((r=>{if(404===r.statusCode)return{};if("object"==typeof r.body){const o=Object.keys(r.body);if(0===o.length)return{};const s=o.map((o=>this.storage.get(this.makePath(e+o),t).then((e=>{if("string"==typeof e.body)try{e.body=JSON.parse(e.body)}catch(e){}"object"==typeof e.body&&(r.body[o]=e.body)}))));return Promise.all(s).then((()=>r.body))}}))}))}getFile(e,t){return o(this,void 0,void 0,(function*(){return"string"!=typeof e?Promise.reject("Argument 'path' of baseClient.getFile must be a string"):this.storage.get(this.makePath(e),t).then((e=>({data:e.body,contentType:e.contentType,revision:e.revision})))}))}storeFile(e,t,r){return o(this,void 0,void 0,(function*(){return"string"!=typeof e?Promise.reject("Argument 'contentType' of baseClient.storeFile must be a string"):"string"!=typeof t?Promise.reject("Argument 'path' of baseClient.storeFile must be a string"):"string"!=typeof r&&"object"!=typeof r?Promise.reject("Argument 'body' of baseClient.storeFile must be a string, ArrayBuffer, or ArrayBufferView"):(this.storage.access.checkPathPermission(this.makePath(t),"rw")||console.warn("WARNING: Editing a document to which only read access ('r') was claimed"),this.storage.put(this.makePath(t),r,e).then((e=>200===e.statusCode||201===e.statusCode?e.revision:Promise.reject("Request (PUT "+this.makePath(t)+") failed with status: "+e.statusCode))))}))}getObject(e,t){return o(this,void 0,void 0,(function*(){return"string"!=typeof e?Promise.reject("Argument 'path' of baseClient.getObject must be a string"):this.storage.get(this.makePath(e),t).then((t=>{if("object"==typeof t.body)return t.body;if("string"==typeof t.body)try{return JSON.parse(t.body)}catch(t){throw new Error("Not valid JSON: "+this.makePath(e))}else if(void 0!==t.body&&200===t.statusCode)return Promise.reject("Not an object: "+this.makePath(e))}))}))}storeObject(e,t,r){return o(this,void 0,void 0,(function*(){if("string"!=typeof e)return Promise.reject("Argument 'typeAlias' of baseClient.storeObject must be a string");if("string"!=typeof t)return Promise.reject("Argument 'path' of baseClient.storeObject must be a string");if("object"!=typeof r)return Promise.reject("Argument 'object' of baseClient.storeObject must be an object");this._attachType(r,e);try{const e=this.validate(r);if(!e.valid)return Promise.reject(e)}catch(e){return Promise.reject(e)}return this.storage.put(this.makePath(t),JSON.stringify(r),"application/json; charset=UTF-8").then((e=>200===e.statusCode||201===e.statusCode?e.revision:Promise.reject("Request (PUT "+this.makePath(t)+") failed with status: "+e.statusCode)))}))}remove(e){return o(this,void 0,void 0,(function*(){return"string"!=typeof e?Promise.reject("Argument 'path' of baseClient.remove must be a string"):(this.storage.access.checkPathPermission(this.makePath(e),"rw")||console.warn("WARNING: Removing a document to which only read access ('r') was claimed"),this.storage.delete(this.makePath(e),this.storage.connected))}))}getItemURL(e){if("string"!=typeof e)throw"Argument 'path' of baseClient.getItemURL must be a string";return this.storage.connected?(e=(0,u.cleanPath)(this.makePath(e)),this.storage.remote.href+e):void 0}cache(e,t="ALL"){if("string"!=typeof e)throw"Argument 'path' of baseClient.cache must be a string";if("string"!=typeof t)throw"Argument 'strategy' of baseClient.cache must be a string or undefined";if("FLUSH"!==t&&"SEEN"!==t&&"ALL"!==t)throw'Argument \'strategy\' of baseclient.cache must be one of ["FLUSH", "SEEN", "ALL"]';return this.storage.caching.set(this.makePath(e),t),this}declareType(e,t,r){let o;if(r&&"string"==typeof t)o=t;else if(r||"string"==typeof t){if(!r&&"string"==typeof t)throw new Error("declareType() requires a JSON Schema object to be passed, in order to validate object types/formats")}else r=t,o=this._defaultTypeURI(e);h.Types.declare(this.moduleName,e,o,r)}validate(e){const t=h.Types.getSchema(e["@context"]);if(t)return n.default.validateResult(e,t);throw new a.default(e["@context"])}_defaultTypeURI(e){return"http://remotestorage.io/spec/modules/"+encodeURIComponent(this.moduleName)+"/"+encodeURIComponent(e)}_attachType(e,t){e["@context"]=h.Types.resolveAlias(this.moduleName+"/"+t)||this._defaultTypeURI(t)}makePath(e){return this.base+(e||"")}_fireChange(e){l.default.changeEvents[e.origin]&&(["new","old","lastCommon"].forEach((function(t){if((!e[t+"ContentType"]||/^application\/(.*)json(.*)/.exec(e[t+"ContentType"]))&&"string"==typeof e[t+"Value"])try{e[t+"Value"]=JSON.parse(e[t+"Value"])}catch(e){}})),this._emit("change",e))}static _rs_init(){}}t.BaseClient=h,h.Types=i.default,(0,u.applyMixins)(h,[c.default]),t.default=h},285:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Caching=void 0;const s=r(746),n=o(r(334));class i{constructor(e){this.pendingActivations=[],this._access=e.access,this.reset()}set(e,t){if("string"!=typeof e)throw new Error("path should be a string");if(!(0,s.isFolder)(e))throw new Error("path should be a folder");if(!this._access.checkPathPermission(e,"r"))throw new Error('No access to path "'+e+'". You must claim access to it first.');if(void 0===t||!t.match(/^(FLUSH|SEEN|ALL)$/))throw new Error("strategy should be 'FLUSH', 'SEEN', or 'ALL'");this._rootPaths[e]=t,"ALL"===t&&(this.activateHandler?this.activateHandler(e):this.pendingActivations.push(e))}enable(e){this.set(e,"ALL")}disable(e){this.set(e,"FLUSH")}onActivate(e){(0,n.default)("[Caching] Setting activate handler",e,this.pendingActivations),this.activateHandler=e;for(let t=0;t<this.pendingActivations.length;t++)e(this.pendingActivations[t]);this.pendingActivations=[]}checkPath(e){return void 0!==this._rootPaths[e]?this._rootPaths[e]:"/"===e?"SEEN":this.checkPath((0,s.containingFolder)(e))}reset(){this._rootPaths={}}static _rs_init(){}}t.Caching=i,t.default=i},496:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const n=s(r(451)),i=s(r(93)),a=s(r(28)),c=s(r(334)),l=r(746);function u(e){if("object"==typeof e&&"string"==typeof e.path)if((0,l.isFolder)(e.path)){if(e.local&&e.local.itemsMap)return e.local;if(e.common&&e.common.itemsMap)return e.common}else{if(e.local){if(e.local.body&&e.local.contentType)return e.local;if(!1===e.local.body)return}if(e.common&&e.common.body&&e.common.contentType)return e.common}}function h(e,t){for(const r in e){if(e[r]&&e[r].remote)return!0;const o=u(e[r]);if(o&&o.timestamp&&(new Date).getTime()-o.timestamp<=t)return!1;if(!o)return!0}return!0}function d(e){const t={path:e,common:{}};return(0,l.isFolder)(e)&&(t.common.itemsMap={}),t}function f(e,t){return e.common||(e.common={itemsMap:{}}),e.common.itemsMap||(e.common.itemsMap={}),e.local||(e.local=(0,l.deepClone)(e.common)),e.local.itemsMap||(e.local.itemsMap=e.common.itemsMap),e.local.itemsMap[t]=!0,e}class p{constructor(){this._updateNodesRunning=!1,this._updateNodesQueued=[],(new n.default).isBrowser()&&l.globalContext.BroadcastChannel&&(this.broadcastChannel=new BroadcastChannel("remotestorage:changes"),this.broadcastChannel.onmessage=e=>{this.emitChange(e.data)})}get(e,t,r){return o(this,void 0,void 0,(function*(){return"number"==typeof t?this.getNodes((0,l.pathsFromRoot)(e)).then((o=>{const s=u(o[e]);return h(o,t)?r(e):s?{statusCode:200,body:s.body||s.itemsMap,contentType:s.contentType}:{statusCode:404}})):this.getNodes([e]).then((t=>{const r=u(t[e]);if(r){if((0,l.isFolder)(e))for(const e in r.itemsMap)r.itemsMap.hasOwnProperty(e)&&!1===r.itemsMap[e]&&delete r.itemsMap[e];return{statusCode:200,body:r.body||r.itemsMap,contentType:r.contentType}}return{statusCode:404}}))}))}put(e,t,r){return o(this,void 0,void 0,(function*(){const o=(0,l.pathsFromRoot)(e);return this._updateNodes(o,(function(e,o){try{for(let s=0,n=e.length;s<n;s++){const n=e[s];let i,a=o[n];a||(o[n]=a=d(n)),0===s?(i=u(a),a.local={body:t,contentType:r,previousBody:i?i.body:void 0,previousContentType:i?i.contentType:void 0}):a=f(a,e[s-1].substring(n.length))}return o}catch(e){throw(0,c.default)("[Cachinglayer] Error during PUT",o,e),e}}))}))}delete(e,t){return o(this,void 0,void 0,(function*(){const r=(0,l.pathsFromRoot)(e);return this._updateNodes(r,(function(e,r){for(let o=0,s=e.length;o<s;o++){const s=e[o],n=r[s];let i;if(n)if(0===o)i=u(n),n.local={body:!t&&void 0,previousBody:i?i.body:void 0,previousContentType:i?i.contentType:void 0};else{n.local||(n.local=(0,l.deepClone)(n.common));const t=e[o-1].substring(s.length);if(delete n.local.itemsMap[t],Object.getOwnPropertyNames(n.local.itemsMap).length>0)break}else console.error("Cannot delete non-existing node "+s)}return r}))}))}flush(e){return this._getAllDescendentPaths(e).then((e=>this.getNodes(e))).then((e=>{for(const t in e){const r=e[t];r&&r.common&&r.local&&this.emitChange({path:r.path,origin:"local",oldValue:!1===r.local.body?void 0:r.local.body,newValue:!1===r.common.body?void 0:r.common.body}),e[t]=void 0}return this.setNodes(e)}))}emitChange(e){a.default.changeEvents[e.origin]&&this._emit("change",e)}fireInitial(){a.default.changeEvents.local&&this.forAllNodes((e=>{if((0,l.isDocument)(e.path)){const t=u(e);t&&this.emitChange({path:e.path,origin:"local",oldValue:void 0,oldContentType:void 0,newValue:t.body,newContentType:t.contentType})}})).then((()=>{this._emit("local-events-done")}))}onDiff(e){this.diffHandler=e}_updateNodes(e,t){return new Promise(((r,o)=>{this._doUpdateNodes(e,t,{resolve:r,reject:o})}))}_doUpdateNodes(e,t,r){return o(this,void 0,void 0,(function*(){if(this._updateNodesRunning)return void this._updateNodesQueued.push({paths:e,cb:t,promise:r});this._updateNodesRunning=!0;try{let o=yield this.getNodes(e);const s=(0,l.deepClone)(o),n=[];o=t(e,o);for(const e in o){const t=o[e];(0,l.equal)(t,s[e])?delete o[e]:(0,l.isDocument)(e)&&((0,l.equal)(t.local.body,t.local.previousBody)&&t.local.contentType===t.local.previousContentType||n.push({path:e,origin:"window",oldValue:t.local.previousBody,newValue:!1===t.local.body?void 0:t.local.body,oldContentType:t.local.previousContentType,newContentType:t.local.contentType}),void 0===t.local.body?o[e]=void 0:(delete t.local.previousBody,delete t.local.previousContentType))}yield this.setNodes(o),this._emitChangeEvents(n),r.resolve({statusCode:200})}catch(e){r.reject(e)}this._updateNodesRunning=!1;const o=this._updateNodesQueued.shift();o&&(yield this._doUpdateNodes(o.paths,o.cb,o.promise))}))}_emitChangeEvents(e){for(let t=0,r=e.length;t<r;t++){const r=e[t];this.emitChange(r),this.diffHandler&&this.diffHandler(r.path),this.broadcastChannel&&"window"===r.origin&&this.broadcastChannel.postMessage(r)}}_getAllDescendentPaths(e){return(0,l.isFolder)(e)?this.getNodes([e]).then((t=>{const r=[e],o=u(t[e]),s=Object.keys(o.itemsMap).map((t=>this._getAllDescendentPaths(e+t).then((e=>{for(let t=0,o=e.length;t<o;t++)r.push(e[t])}))));return Promise.all(s).then((()=>r))})):Promise.resolve([e])}_getInternals(){return{getLatest:u,makeNode:d,isOutdated:h}}}(0,l.applyMixins)(p,[i.default]),e.exports=p},28:function(e){"use strict";e.exports={cache:!0,changeEvents:{local:!0,window:!1,remote:!0,conflict:!0},cordovaRedirectUri:void 0,logging:!1,modules:[],backgroundSyncInterval:6e4,disableFeatures:[],discoveryTimeout:5e3,isBackground:!1,requestTimeout:3e4,syncInterval:1e4}},373:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const s=o(r(199)),n=o(r(28)),i=o(r(334)),a=r(746);let c;const l="remotestorage:discover";let u={};const h=function(e){return new Promise(((t,r)=>{if(e in u)return t(u[e]);const o=new s.default({tls_only:!1,uri_fallback:!0,request_timeout:n.default.discoveryTimeout});return setTimeout((()=>r(new Error("timed out"))),n.default.discoveryTimeout),o.lookup(e,(function(o,s){if(o)return r(o);if("object"!=typeof s.idx.links.remotestorage||"number"!=typeof s.idx.links.remotestorage.length||s.idx.links.remotestorage.length<=0)return(0,i.default)("[Discover] WebFinger record for "+e+" does not have remotestorage defined in the links section ",JSON.stringify(s.json)),r("WebFinger record for "+e+" does not have remotestorage defined in the links section.");const n=s.idx.links.remotestorage[0],a=n.properties["http://tools.ietf.org/html/rfc6749#section-4.2"]||n.properties["auth-endpoint"],h=n.properties["http://remotestorage.io/spec/version"]||n.type;return u[e]={href:n.href,storageApi:h,authURL:a,properties:n.properties},c&&localStorage.setItem(l,JSON.stringify({cache:u})),t(u[e])}))}))};(h.DiscoveryError=function(e){this.name="DiscoveryError",this.message=e,this.stack=(new Error).stack}).prototype=Object.create(Error.prototype),h.DiscoveryError.prototype.constructor=h.DiscoveryError,h._rs_init=function(){if(c=(0,a.localStorageAvailable)(),c){const e=JSON.parse(localStorage.getItem(l));e&&(u=e.cache)}},h._rs_supported=function(){return Object.prototype.hasOwnProperty.call(a.globalContext,"fetch")||Object.prototype.hasOwnProperty.call(a.globalContext,"XMLHttpRequest")},h._rs_cleanup=function(){c&&localStorage.removeItem(l)},e.exports=h},706:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const n=s(r(93)),i=s(r(424)),a=s(r(941)),c=s(r(982)),l=s(r(503)),u=r(746),h=r(368),d=r(684),f=s(r(275));let p;const m="remotestorage:dropbox",g="https://api.dropboxapi.com/2/files/list_folder",y="https://api.dropboxapi.com/2/files/list_folder/continue",v="/remotestorage";function _(e){return(v+"/"+e).replace(/\/+$/,"").replace(/\/+/g,"/")}const b=/[\u007f-\uffff]/g;function w(e){return JSON.stringify(e).replace(b,(function(e){return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)}))}function P(e,t){return new RegExp("^"+t.join("\\/")+"(\\/|$)").test(e.error_summary)}function T(e){return e instanceof ArrayBuffer||(0,h.isArrayBufferView)(e)}class E extends d.RemoteBase{constructor(e){if(super(e),this.online=!0,this.storageApi="draft-dejong-remotestorage-19",this._initialFetchDone=!1,this.addEvents(["connected","not-connected"]),this.clientId=e.apiKeys.dropbox.appKey,this.TOKEN_URL="https://api.dropboxapi.com/oauth2/token",this._revCache=new a.default("rev"),this._fetchDeltaCursor=null,this._fetchDeltaPromise=null,this._itemRefs={},p=(0,u.localStorageAvailable)(),p){const e=(0,u.getJSONFromLocalStorage)(m);e&&this.configure(e),this._itemRefs=(0,u.getJSONFromLocalStorage)(`${m}:shares`)||{}}this.connected&&setTimeout(this._emit.bind(this),0,"connected")}connect(){return o(this,void 0,void 0,(function*(){try{if(this.rs.setBackend("dropbox"),this.token)A(this.rs);else{const{codeVerifier:e,codeChallenge:t,state:r}=yield(0,u.generateCodeVerifier)();sessionStorage.setItem("remotestorage:codeVerifier",e),sessionStorage.setItem("remotestorage:state",r),this.rs.authorize({authURL:"https://www.dropbox.com/oauth2/authorize",scope:"account_info.read files.content.read files.content.write files.metadata.read files.metadata.write",clientId:this.clientId,response_type:"code",state:r,code_challenge:t,code_challenge_method:"S256",token_access_type:"offline"})}}catch(e){throw this.rs._emit("error",e),this.rs.setBackend(void 0),e}}))}configure(e){return o(this,void 0,void 0,(function*(){void 0!==e.userAddress&&(this.userAddress=e.userAddress),void 0!==e.token&&(this.token=e.token),void 0!==e.refreshToken&&(this.refreshToken=e.refreshToken),void 0!==e.tokenType&&(this.tokenType=e.tokenType);const t=()=>{p&&localStorage.setItem(m,JSON.stringify({userAddress:this.userAddress,token:this.token,refreshToken:this.refreshToken,tokenType:this.tokenType}))};if(this.refreshToken||this.token)if(this.connected=!0,this.userAddress)this._emit("connected"),t();else try{const e=yield this.info();this.userAddress=e.email,this._emit("connected"),t()}catch(e){this.connected=!1,this.rs._emit("error",new Error("Could not fetch user info.")),t.apply(this)}else(()=>{this.connected=!1,p&&localStorage.removeItem(m),this.rs.setBackend(void 0)})()}))}_getFolder(e){const t=this._revCache,r=r=>{let s;if(200!==r.status&&409!==r.status)return Promise.reject("Unexpected response status: "+r.status);try{s=JSON.parse(r.responseText)}catch(e){return Promise.reject(e)}if(409===r.status)return P(s,["path","not_found"])?Promise.resolve({}):Promise.reject(new Error("API returned an error: "+s.error_summary));const n=s.entries.reduce(((r,o)=>{try{const s="folder"===o[".tag"],n=o.path_display.split("/").slice(-1)[0]+(s?"/":"");if(s)r[n]={ETag:t.get(e+n)};else{const t=new Date(o.server_modified);r[n]={ETag:o.rev,"Content-Length":o.size,"Last-Modified":t.toUTCString()},this._revCache.set(e+n,o.rev)}}catch(t){console.error(`[Dropbox] folder “${e}” has entry ${JSON.stringify(o)}:`,t)}return r}),{});return s.has_more?o(s.cursor).then((function(e){return Object.assign(n,e)})):Promise.resolve(n)},o=e=>{const t={body:{cursor:e}};return this._request("POST",y,t).then(r)};return this._request("POST",g,{body:{path:_(e)}}).then(r).then((function(r){return Promise.resolve({statusCode:200,body:r,contentType:"application/json; charset=UTF-8",revision:t.get(e)})}))}get(e,t={}){if(!this.connected)return Promise.reject("not connected (path: "+e+")");const r=this._revCache.get(e);if(null===r)return Promise.resolve({statusCode:404});if(t&&t.ifNoneMatch){if(!this._initialFetchDone)return this.fetchDelta().then((()=>this.get(e,t)));if(r&&r===t.ifNoneMatch)return Promise.resolve({statusCode:304})}if("/"===e.slice(-1))return this._getFolder(e);const o={headers:{"Dropbox-API-Arg":w({path:_(e)})},responseType:"arraybuffer"};return t&&t.ifNoneMatch&&(o.headers["If-None-Match"]=t.ifNoneMatch),this._request("GET","https://content.dropboxapi.com/2/files/download",o).then((t=>{const r=t.status;let o,s,n,i;return 200!==r&&409!==r?Promise.resolve({statusCode:r}):(o=t.getResponseHeader("Dropbox-API-Result"),(0,u.getTextFromArrayBuffer)(t.response,"UTF-8").then((a=>{s=a,409===r&&(o=s);try{o=JSON.parse(o)}catch(e){return Promise.reject(e)}if(409===r)return P(o,["path","not_found"])?{statusCode:404}:Promise.reject(new Error('API error while downloading file ("'+e+'"): '+o.error_summary));if(n=t.getResponseHeader("Content-Type"),i=o.rev,this._revCache.set(e,i),this._shareIfNeeded(e),(0,u.shouldBeTreatedAsBinary)(a,n))s=t.response;else try{s=JSON.parse(s),n="application/json; charset=UTF-8"}catch(e){}return{statusCode:r,body:s,contentType:n,revision:i}})))}))}put(e,t,r){return o(this,arguments,void 0,(function*(e,t,r,o={}){if(!this.connected)throw new Error("not connected (path: "+e+")");const s=this._revCache.get(e);if(o&&o.ifMatch&&s&&s!==o.ifMatch)return{statusCode:412,revision:s};if(o&&"*"===o.ifNoneMatch&&s&&"rev"!==s)return{statusCode:412,revision:s};if(!r.match(/charset=/)&&T(t)&&(r+="; charset=binary"),t.length>157286400)throw new Error("Cannot upload file larger than 150MB");const n={body:t,contentType:r,path:e};if(o&&(o.ifMatch||"*"===o.ifNoneMatch)){const t=yield this._getMetadata(e);if(o&&"*"===o.ifNoneMatch&&t)return{statusCode:412,revision:t.rev};if(o&&o.ifMatch&&t&&t.rev!==o.ifMatch)return{statusCode:412,revision:t.rev}}const i=yield this._uploadSimple(n);return this._shareIfNeeded(e),i}))}delete(e){return o(this,arguments,void 0,(function*(e,t={}){if(!this.connected)throw new Error("not connected (path: "+e+")");const r=this._revCache.get(e);if((null==t?void 0:t.ifMatch)&&r&&t.ifMatch!==r)return{statusCode:412,revision:r};if(null==t?void 0:t.ifMatch){const r=yield this._getMetadata(e);if((null==t?void 0:t.ifMatch)&&r&&r.rev!==t.ifMatch)return{statusCode:412,revision:r.rev}}return this._deleteSimple(e)}))}_shareIfNeeded(e){if(e.match(/^\/public\/.*[^/]$/)&&void 0===this._itemRefs[e])return this.share(e)}share(e){const t={body:{path:_(e)}};return this._request("POST","https://api.dropboxapi.com/2/sharing/create_shared_link_with_settings",t).then((t=>{if(200!==t.status&&409!==t.status)return Promise.reject(new Error("Invalid response status:"+t.status));let r;try{r=JSON.parse(t.responseText)}catch(e){return Promise.reject(new Error("Invalid response body: "+t.responseText))}return 409===t.status?P(r,["shared_link_already_exists"])?this._getSharedLink(e):Promise.reject(new Error("API error: "+r.error_summary)):Promise.resolve(r.url)})).then((t=>(this._itemRefs[e]=t,p&&localStorage.setItem(m+":shares",JSON.stringify(this._itemRefs)),Promise.resolve(t))),(t=>(t.message='Sharing Dropbox file or folder ("'+e+'") failed: '+t.message,Promise.reject(t))))}info(){return this._request("POST","https://api.dropboxapi.com/2/users/get_current_account",{}).then((function(e){let t;try{const r=JSON.parse(e.responseText);t=null==r?void 0:r.email}catch(t){return Promise.reject(new Error("Could not query current account info: Invalid API response: "+e.responseText))}return Promise.resolve({email:t})}))}_request(e,t,r){return o(this,arguments,void 0,(function*(e,t,r,o=1){if(this.isForbiddenRequestMethod(e,t))throw`Don't use ${e} on directories!`;if(!this.token)throw new l.default("No access token");r.headers||(r.headers={}),r.headers.Authorization="Bearer "+this.token,"object"!=typeof r.body||T(r.body)||(r.body=JSON.stringify(r.body),r.headers["Content-Type"]="application/json; charset=UTF-8"),this.rs._emit("wire-busy",{method:e,isFolder:(0,u.isFolder)(t)});try{const s=yield(0,h.requestWithTimeout)(e,t,r);return this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:e,isFolder:(0,u.isFolder)(t),success:!0}),401===(null==s?void 0:s.status)&&this.refreshToken?o>=3?(console.error(`Abandoned after ${o} attempts: ${e} ${t}`),s):(this.rs._emit("wire-busy",{method:e,isFolder:(0,u.isFolder)(t)}),yield f.default.refreshAccessToken(this.rs,this,this.refreshToken),this.rs._emit("wire-done",{method:e,isFolder:(0,u.isFolder)(t),success:!0}),this._request(e,t,r,o+1)):[503,429].includes(null==s?void 0:s.status)?(this.online&&(this.online=!1,this.rs._emit("network-offline")),o>=3?(console.warn(`Abandoned after ${o} attempts: ${e} ${t}`),s):(yield new Promise((e=>setTimeout(e,(0,h.retryAfterMs)(s)))),this._request(e,t,r,o+1))):s}catch(r){throw this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:e,isFolder:(0,u.isFolder)(t),success:!1}),r}}))}fetchDelta(...e){if(this._fetchDeltaPromise)return this._fetchDeltaPromise;const t=e=>o(this,void 0,void 0,(function*(){let r,o;"string"==typeof e?(r=y,o={cursor:e}):(r=g,o={path:v,recursive:!0,include_deleted:!0});try{const s=yield this._request("POST",r,{body:o});if(401===s.status)throw new l.default;if(200!==s.status&&409!==s.status)throw new Error("Invalid response status: "+s.status);let n;try{n=JSON.parse(s.responseText)}catch(e){throw new Error("Invalid response body: "+s.responseText)}if(409===s.status){if(!P(n,["path","not_found"]))throw new Error("API returned an error: "+n.error_summary);n={cursor:null,entries:[],has_more:!1}}if(e||this._revCache.deactivatePropagation(),n.entries.forEach((e=>{const t=e.path_display.slice(14);"deleted"===e[".tag"]?(this._revCache.delete(t),this._revCache.delete(t+"/")):"file"===e[".tag"]&&this._revCache.set(t,e.rev)})),this._fetchDeltaCursor=n.cursor,n.has_more)return t(n.cursor);this._revCache.activatePropagation(),this._initialFetchDone=!0}catch(e){if("timeout"===e)return;throw e}}));return this._fetchDeltaPromise=t(this._fetchDeltaCursor).catch((e=>("object"==typeof e&&"message"in e?e.message="Dropbox: fetchDelta: "+e.message:e=`Dropbox: fetchDelta: ${e}`,this.rs._emit("error",e),this._fetchDeltaPromise=null,Promise.reject(e)))).then((()=>(this._fetchDeltaPromise=null,Promise.resolve(e)))),this._fetchDeltaPromise}_getMetadata(e){const t={path:_(e)};return this._request("POST","https://api.dropboxapi.com/2/files/get_metadata",{body:t}).then((e=>{if(200!==e.status&&409!==e.status)return Promise.reject(new Error("Invalid response status:"+e.status));let t;try{t=JSON.parse(e.responseText)}catch(t){return Promise.reject(new Error("Invalid response body: "+e.responseText))}return 409===e.status?P(t,["path","not_found"])?Promise.resolve():Promise.reject(new Error("API error: "+t.error_summary)):Promise.resolve(t)})).then(void 0,(t=>(t.message='Could not load metadata for file or folder ("'+e+'"): '+t.message,Promise.reject(t))))}_uploadSimple(e){const t={path:_(e.path),mode:{".tag":"overwrite",update:void 0},mute:!0};return e.ifMatch&&(t.mode={".tag":"update",update:e.ifMatch}),this._request("POST","https://content.dropboxapi.com/2/files/upload",{body:e.body,headers:{"Content-Type":"application/octet-stream","Dropbox-API-Arg":w(t)}}).then((t=>{if(200!==t.status&&409!==t.status)return Promise.resolve({statusCode:t.status});let r;try{r=JSON.parse(t.responseText)}catch(e){return Promise.reject(new Error("Invalid API result: "+t.responseText))}return 409===t.status?P(r,["path","conflict"])?this._getMetadata(e.path).then((function(e){return Promise.resolve({statusCode:412,revision:e.rev})})):(this.rs._emit("error",new Error(r.error_summary)),Promise.resolve({statusCode:t.status})):(this._revCache.set(e.path,r.rev),Promise.resolve({statusCode:t.status,revision:r.rev}))}))}_deleteSimple(e){const t={path:_(e)};return this._request("POST","https://api.dropboxapi.com/2/files/delete",{body:t}).then((e=>{if(200!==e.status&&409!==e.status)return Promise.resolve({statusCode:e.status});let t;try{t=JSON.parse(e.responseText)}catch(t){return Promise.reject(new Error("Invalid response body: "+e.responseText))}if(409===e.status){if(P(t,["path_lookup","not_found"]))return Promise.resolve({statusCode:404});this.rs._emit("error",new Error(t.error_summary))}return Promise.resolve({statusCode:e.status})})).then((t=>(200!==t.statusCode&&404!==t.statusCode||(this._revCache.delete(e),delete this._itemRefs[e]),Promise.resolve(t))),(t=>(t.message='Could not delete Dropbox file or folder ("'+e+'"): '+t.message,Promise.reject(t))))}_getSharedLink(e){return o(this,void 0,void 0,(function*(){const t={body:{path:_(e),direct_only:!0}};return this._request("POST","https://api.dropbox.com/2/sharing/list_shared_links",t).then((e=>{if(200!==e.status&&409!==e.status)return Promise.reject(new Error("Invalid response status: "+e.status));let t;try{t=JSON.parse(e.responseText)}catch(t){return Promise.reject(new Error("Invalid response body: "+e.responseText))}return 409===e.status?Promise.reject(new Error("API error: "+(null==t?void 0:t.error_summary)||0)):t.links.length?Promise.resolve(t.links[0].url):Promise.reject(new Error("No links returned"))}),(t=>(t.message='Could not get link to a shared file or folder ("'+e+'"): '+t.message,Promise.reject(t))))}))}static _rs_init(e){p=(0,u.localStorageAvailable)(),e.apiKeys.dropbox&&(e.dropbox=new E(e)),"dropbox"===e.backend&&A(e)}static _rs_supported(){return!0}static _rs_cleanup(e){!function(e){(function(e){e._origRemote&&(e.remote=e._origRemote,delete e._origRemote)})(e),function(e){e._dropboxOrigSync&&(e.sync.sync=e._dropboxOrigSync,delete e._dropboxOrigSync)}(e),function(e){e._origBaseClientGetItemURL&&(i.default.prototype.getItemURL=e._origBaseClientGetItemURL,delete e._origBaseClientGetItemURL)}(e),S(e)}(e),p&&localStorage.removeItem(m),e.setBackend(void 0)}}function k(e,...t){e._dropboxOrigSync||(e._dropboxOrigSync=e.sync.sync.bind(e.sync),e.sync.sync=function(){return this.dropbox.fetchDelta(e,...t).then(e._dropboxOrigSync,(function(t){e._emit("error",new c.default(t)),e._emit("sync-done")}))}.bind(e))}function S(e){e._dropboxOrigSyncCycle&&(e.syncCycle=e._dropboxOrigSyncCycle,delete e._dropboxOrigSyncCycle)}function A(e){!function(e){e._origRemote||(e._origRemote=e.remote,e.remote=e.dropbox)}(e),e.sync?k(e):function(e,...t){e._dropboxOrigSyncCycle||(e._dropboxOrigSyncCycle=e.syncCycle,e.syncCycle=()=>{if(!e.sync)throw new Error("expected sync to be initialized by now");k(e),e._dropboxOrigSyncCycle(e,...t),S(e)})}(e),function(e){e._origBaseClientGetItemURL||(e._origBaseClientGetItemURL=i.default.prototype.getItemURL,i.default.prototype.getItemURL=function(){throw new Error("getItemURL is not implemented for Dropbox yet")})}(e)}(0,u.applyMixins)(E,[n.default]),e.exports=E},451:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const s=o(r(93)),n=r(746),i=o(r(334));class a{constructor(){this.addEvents(["background","foreground"]),this.mode="undefined"!=typeof window?"browser":"node","browser"===this.mode&&(this.setBrowserPrefixedNames(),document.addEventListener(this.visibilityChangeEvent,this.setVisibility.bind(this),!1),this.setVisibility())}setBrowserPrefixedNames(){"browser"===this.mode&&(void 0!==document.hidden?(this.hiddenProperty="hidden",this.visibilityChangeEvent="visibilitychange"):void 0!==document.mozHidden?(this.hiddenProperty="mozHidden",this.visibilityChangeEvent="mozvisibilitychange"):void 0!==document.msHidden?(this.hiddenProperty="msHidden",this.visibilityChangeEvent="msvisibilitychange"):void 0!==document.webkitHidden&&(this.hiddenProperty="webkitHidden",this.visibilityChangeEvent="webkitvisibilitychange"))}setVisibility(){document[this.hiddenProperty]?((0,i.default)("[Env] Going into background mode"),this.goBackground()):((0,i.default)("[Env] Going into foreground mode"),this.goForeground())}isBrowser(){return"browser"===this.mode}isNode(){return"node"===this.mode}goBackground(){this._emit("background")}goForeground(){this._emit("foreground")}static _rs_init(){}static _rs_cleanup(){}}(0,n.applyMixins)(a,[s.default]),e.exports=a},93:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventHandling=void 0;const s=o(r(334));class n{addEvents(e){e.forEach((e=>this._addEvent(e)))}addEventListener(e,t){if("string"!=typeof e)throw new Error("Argument eventName should be a string");if("function"!=typeof t)throw new Error("Argument handler should be a function");(0,s.default)("[EventHandling] Adding event listener",e),this._validateEvent(e),this._handlers[e].push(t)}on(e,t){return this.addEventListener(e,t)}removeEventListener(e,t){this._validateEvent(e);const r=this._handlers[e].length;for(let o=0;o<r;o++)if(this._handlers[e][o]===t)return void this._handlers[e].splice(o,1)}_emit(e,...t){this._validateEvent(e),this._handlers[e].slice().forEach((e=>{e(...t)}))}_validateEvent(e){if(!(e in this._handlers))throw new Error("Unknown event: "+e)}_delegateEvent(e,t){t.on(e,(t=>{this._emit(e,t)}))}_addEvent(e){void 0===this._handlers&&(this._handlers={}),this._handlers[e]=[]}}t.EventHandling=n,t.default=n},545:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const s=o(r(28)),n=o(r(451)),i=o(r(334)),a=r(746),c=o(r(370)),l=o(r(548)),u=o(r(275)),h=o(r(373)),d=o(r(424)),f=o(r(801)),p=o(r(706)),m=o(r(600)),g=o(r(313)),y=o(r(285)),v=o(r(567)),_=o(r(794)),b=o(r(365)),w={features:[],featuresDone:0,readyFired:!1,loadFeatures(){this.features=[],this.featuresDone=0,this.readyFired=!1,this.featureModules={WireClient:m.default,Dropbox:p.default,GoogleDrive:f.default,Access:l.default,Discover:h.default,Authorize:u.default,BaseClient:d.default,Env:n.default},s.default.cache&&(0,a.extend)(this.featureModules,{Caching:y.default,IndexedDB:v.default,LocalStorage:_.default,InMemoryStorage:b.default,Sync:g.default}),s.default.disableFeatures.forEach((e=>{this.featureModules[e]&&delete this.featureModules[e]})),this._allLoaded=!1;for(const e in this.featureModules)this.loadFeature(e)},hasFeature(e){for(let t=this.features.length-1;t>=0;t--)if(this.features[t].name===e)return this.features[t].supported;return!1},loadFeature(e){const t=this.featureModules[e],r=!t._rs_supported||t._rs_supported();(0,i.default)(`[RemoteStorage] [FEATURE ${e}] initializing ...`),"object"==typeof r?r.then((()=>{this.featureSupported(e,!0),this.initFeature(e)}),(()=>{this.featureSupported(e,!1)})):"boolean"==typeof r?(this.featureSupported(e,r),r&&this.initFeature(e)):this.featureSupported(e,!1)},initFeature(e){const t=this.featureModules[e];let r;try{r=t._rs_init(this)}catch(t){return void this.featureFailed(e,t)}"object"==typeof r&&"function"==typeof r.then?r.then((()=>{this.featureInitialized(e)}),(t=>{this.featureFailed(e,t)})):this.featureInitialized(e)},featureFailed(e,t){(0,i.default)(`[RemoteStorage] [FEATURE ${e}] initialization failed (${t})`),this.featureDone()},featureSupported(e,t){(0,i.default)(`[RemoteStorage] [FEATURE ${e}]${t?"":"not "} supported`),t||this.featureDone()},featureInitialized(e){(0,i.default)(`[RemoteStorage] [FEATURE ${e}] initialized`),this.features.push({name:e,init:this.featureModules[e]._rs_init,supported:!0,cleanup:this.featureModules[e]._rs_cleanup}),this.featureDone()},featureDone(){this.featuresDone++,this.featuresDone===Object.keys(this.featureModules).length&&setTimeout(this.featuresLoaded.bind(this),0)},_setCachingModule(){["IndexedDB","LocalStorage","InMemoryStorage"].some((e=>{if(this.features.some((t=>t.name===e)))return this.features.local=this.featureModules[e],!0}))},_fireReady(){try{this.readyFired||(this._emit("ready"),this.readyFired=!0)}catch(e){console.error("'ready' failed: ",e,e.stack),this._emit("error",e)}},featuresLoaded(){(0,i.default)("[RemoteStorage] All features loaded"),this._setCachingModule(),this.local=s.default.cache&&this.features.local&&new this.features.local,this.local&&this.remote?(this._setGPD(c.default,this),this._bindChange(this.local)):this.remote&&this._setGPD(this.remote,this.remote),this.remote&&(this.remote.on("connected",(()=>{this._fireReady(),this._emit("connected")})),this.remote.on("not-connected",(()=>{this._fireReady(),this._emit("not-connected")})),this.remote.connected&&(this._fireReady(),this._emit("connected")),this.hasFeature("Authorize")||this.remote.stopWaitingForToken()),this._collectCleanupFunctions();try{this._allLoaded=!0,this._emit("features-loaded")}catch(e){(0,a.logError)(e),this._emit("error",e)}this._processPending()},_collectCleanupFunctions(){this._cleanups=[];for(let e=0;e<this.features.length;e++){const t=this.features[e].cleanup;"function"==typeof t&&this._cleanups.push(t)}}};e.exports=w},801:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const s=o(r(424)),n=o(r(93)),i=r(746),a=r(368),c=r(684),l="https://www.googleapis.com",u="remotestorage:googledrive",h="application/vnd.google-apps.folder";let d;function f(e){return"/"===e.substr(-1)&&(e=e.substr(0,e.length-1)),decodeURIComponent(e)}function p(e){return e.replace(/[^\/]+\/?$/,"")}function m(e){const t=e.split("/");return"/"===e.substr(-1)?t[t.length-2]+"/":t[t.length-1]}function g(e){return(0,i.cleanPath)(`/remotestorage/${e}`)}class y{constructor(e){this._items={},this.maxAge=e,this._items={}}get(e){const t=this._items[e],r=(new Date).getTime();return t&&t.t>=r-this.maxAge?t.v:void 0}set(e,t){this._items[e]={v:t,t:(new Date).getTime()}}}class v extends c.RemoteBase{constructor(e,t){if(super(e),this.online=!0,this.storageApi="draft-dejong-remotestorage-19",this.addEvents(["connected","not-connected"]),this.clientId=t,this._fileIdCache=new y(300),d=(0,i.localStorageAvailable)(),d){const e=(0,i.getJSONFromLocalStorage)(u);e&&this.configure(e)}}configure(e){void 0!==e.userAddress&&(this.userAddress=e.userAddress),void 0!==e.token&&(this.token=e.token);const t=function(){d&&localStorage.setItem(u,JSON.stringify({userAddress:this.userAddress,token:this.token}))},r=function(){this.connected=!1,delete this.token,d&&localStorage.removeItem(u)};this.token?(this.connected=!0,this.userAddress?(this._emit("connected"),t.apply(this)):this.info().then((e=>{this.userAddress=e.user.emailAddress,this._emit("connected"),t.apply(this)})).catch((()=>{r.apply(this),this.rs._emit("error",new Error("Could not fetch user info."))}))):r.apply(this)}connect(){this.rs.setBackend("googledrive"),this.rs.authorize({authURL:"https://accounts.google.com/o/oauth2/auth",scope:"https://www.googleapis.com/auth/drive",clientId:this.clientId})}get(e,t={}){return(0,i.isFolder)(e)?this._getFolder(g(e)):this._getFile(g(e),t)}put(e,t,r,o={}){const s=g(e);function n(e){if(e.status>=200&&e.status<300){const t=JSON.parse(e.responseText),r=this.stripQuotes(t.etag);return Promise.resolve({statusCode:200,contentType:t.mimeType,revision:r})}return 412===e.status?Promise.resolve({statusCode:412,revision:"conflict"}):Promise.reject("PUT failed with status "+e.status+" ("+e.responseText+")")}return this._getFileId(s).then((e=>e?o&&"*"===o.ifNoneMatch?n({status:412}):this._updateFile(e,s,t,r,o).then(n):this._createFile(s,t,r).then(n)))}delete(e,t={}){const r=g(e);return this._getFileId(r).then((e=>e?this._getMeta(e).then((r=>{let o;return"object"==typeof r&&"string"==typeof r.etag&&(o=this.stripQuotes(r.etag)),t&&t.ifMatch&&t.ifMatch!==o?{statusCode:412,revision:o}:this._request("DELETE",l+"/drive/v2/files/"+e,{}).then((e=>200===e.status||204===e.status?{statusCode:200}:Promise.reject("Delete failed: "+e.status+" ("+e.responseText+")")))})):Promise.resolve({statusCode:200})))}info(){const e=l+"/drive/v2/about?fields=user";return this._request("GET",e,{}).then((function(e){try{const t=JSON.parse(e.responseText);return Promise.resolve(t)}catch(e){return Promise.reject(e)}}))}_updateFile(e,t,r,o,s){const n={mimeType:o},i={"Content-Type":"application/json; charset=UTF-8"};return s&&s.ifMatch&&(i["If-Match"]=this.addQuotes(s.ifMatch)),this._request("PUT",l+"/upload/drive/v2/files/"+e+"?uploadType=resumable",{body:JSON.stringify(n),headers:i}).then((e=>412===e.status?e:this._request("PUT",e.getResponseHeader("Location"),{body:o.match(/^application\/json/)?JSON.stringify(r):r})))}_createFile(e,t,r){return this._getParentId(e).then((o=>{const s={title:f(m(e)),mimeType:r,parents:[{kind:"drive#fileLink",id:o}]};return this._request("POST",l+"/upload/drive/v2/files?uploadType=resumable",{body:JSON.stringify(s),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then((e=>this._request("POST",e.getResponseHeader("Location"),{body:r.match(/^application\/json/)?JSON.stringify(t):t})))}))}_getFile(e,t){return this._getFileId(e).then((e=>this._getMeta(e).then((e=>{let r;if("object"==typeof e&&"string"==typeof e.etag&&(r=this.stripQuotes(e.etag)),t&&t.ifNoneMatch&&r===t.ifNoneMatch)return Promise.resolve({statusCode:304});if(!e.downloadUrl){if(!e.exportLinks||!e.exportLinks["text/html"])return Promise.resolve({statusCode:200,body:"",contentType:e.mimeType,revision:r});e.mimeType+=";export=text/html",e.downloadUrl=e.exportLinks["text/html"]}return this._request("GET",e.downloadUrl,{responseType:"arraybuffer"}).then((t=>(0,i.getTextFromArrayBuffer)(t.response,"UTF-8").then((function(o){let s=o;if(e.mimeType.match(/^application\/json/))try{s=JSON.parse(s)}catch(e){}else(0,i.shouldBeTreatedAsBinary)(o,e.mimeType)&&(s=t.response);return{statusCode:200,body:s,contentType:e.mimeType,revision:r}}))))}))))}_getFolder(e){return this._getFileId(e).then((t=>{let r,o,s;if(!t)return Promise.resolve({statusCode:404});const n="'"+t+"' in parents";return this._request("GET",l+"/drive/v2/files?q="+encodeURIComponent(n)+"&fields="+encodeURIComponent("items(downloadUrl,etag,fileSize,id,mimeType,title,labels)")+"&maxResults=1000&trashed=false",{}).then((t=>{var n;if(200!==t.status)return Promise.reject("request failed or something: "+t.status);try{r=JSON.parse(t.responseText)}catch(e){return Promise.reject("non-JSON response from GoogleDrive")}s={};for(const t of r.items)(null===(n=t.labels)||void 0===n?void 0:n.trashed)||(o=this.stripQuotes(t.etag),t.mimeType===h?(this._fileIdCache.set(e+(0,i.cleanPath)(t.title)+"/",t.id),s[t.title+"/"]={ETag:o}):(this._fileIdCache.set(e+(0,i.cleanPath)(t.title),t.id),s[t.title]={ETag:o,"Content-Type":t.mimeType,"Content-Length":t.fileSize}));return Promise.resolve({statusCode:200,body:s,contentType:"application/json; charset=UTF-8",revision:void 0})}))}))}_getParentId(e){const t=p(e);return this._getFileId(t).then((e=>e?Promise.resolve(e):this._createFolder(t)))}_createFolder(e){return this._getParentId(e).then((t=>this._request("POST",l+"/drive/v2/files",{body:JSON.stringify({title:f(m(e)),mimeType:h,parents:[{id:t}]}),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then((e=>{const t=JSON.parse(e.responseText);return Promise.resolve(t.id)}))))}_getFileId(e){let t;return"/"===e?Promise.resolve("root"):(t=this._fileIdCache.get(e))?Promise.resolve(t):this._getFolder(p(e)).then((()=>(t=this._fileIdCache.get(e),t?Promise.resolve(t):"/"===e.substr(-1)?this._createFolder(e).then((()=>this._getFileId(e))):Promise.resolve())))}_getMeta(e){return this._request("GET",l+"/drive/v2/files/"+e,{}).then((function(t){return 200===t.status?Promise.resolve(JSON.parse(t.responseText)):Promise.reject("request (getting metadata for "+e+") failed with status: "+t.status)}))}_request(e,t,r){return this.isForbiddenRequestMethod(e,t)?Promise.reject(`Don't use ${e} on directories!`):(r.headers||(r.headers={}),r.headers.Authorization="Bearer "+this.token,this.rs._emit("wire-busy",{method:e,isFolder:(0,i.isFolder)(t)}),(0,a.requestWithTimeout)(e,t,r).then((r=>r&&401===r.status?void this.connect():(this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:e,isFolder:(0,i.isFolder)(t),success:!0}),Promise.resolve(r))),(r=>(this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:e,isFolder:(0,i.isFolder)(t),success:!1}),Promise.reject(r)))))}static _rs_init(e){const t=e.apiKeys.googledrive;var r;t&&(e.googledrive=new v(e,t.clientId),"googledrive"===e.backend&&(e._origRemote=e.remote,e.remote=e.googledrive,(r=e)._origBaseClientGetItemURL||(r._origBaseClientGetItemURL=s.default.prototype.getItemURL,s.default.prototype.getItemURL=function(){throw new Error("getItemURL is not implemented for Google Drive yet")})))}static _rs_supported(){return!0}static _rs_cleanup(e){var t;e.setBackend(void 0),e._origRemote&&(e.remote=e._origRemote,delete e._origRemote),(t=e)._origBaseClientGetItemURL&&(s.default.prototype.getItemURL=t._origBaseClientGetItemURL,delete t._origBaseClientGetItemURL)}}(0,i.applyMixins)(v,[n.default]),e.exports=v},567:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const n=s(r(93)),i=s(r(496)),a=s(r(334)),c=r(746),l="remotestorage";let u;class h extends i.default{constructor(e){super(),this.addEvents(["change","local-events-done"]),this.db=e||u,this.db?(this.getsRunning=0,this.putsRunning=0,this.changesQueued={},this.changesRunning={},this.commitSlownessWarning=null):(0,a.default)("[IndexedDB] Failed to open DB")}getNodes(e){return o(this,void 0,void 0,(function*(){const t=[],r={};for(let o=0,s=e.length;o<s;o++)void 0!==this.changesQueued[e[o]]?r[e[o]]=(0,c.deepClone)(this.changesQueued[e[o]]||void 0):void 0!==this.changesRunning[e[o]]?r[e[o]]=(0,c.deepClone)(this.changesRunning[e[o]]||void 0):t.push(e[o]);return t.length>0?this.getNodesFromDb(t).then((function(e){for(const t in r)e[t]=r[t];return e})):r}))}setNodes(e){return o(this,void 0,void 0,(function*(){for(const t in e)this.changesQueued[t]=e[t]||!1;this.maybeFlush()}))}maybeFlush(){0===this.putsRunning?this.flushChangesQueued():this.commitSlownessWarning||(this.commitSlownessWarning=r.g.setInterval((function(){console.warn("WARNING: waited more than 10 seconds for previous commit to finish")}),1e4))}flushChangesQueued(){this.commitSlownessWarning&&(clearInterval(this.commitSlownessWarning),this.commitSlownessWarning=null),Object.keys(this.changesQueued).length>0&&(this.changesRunning=this.changesQueued,this.changesQueued={},this.setNodesInDb(this.changesRunning).then(this.flushChangesQueued.bind(this)))}getNodesFromDb(e){return new Promise(((t,r)=>{const o=this.db.transaction(["nodes"],"readonly"),s=o.objectStore("nodes"),n={};this.getsRunning++,e.map((e=>{s.get(e).onsuccess=t=>{n[e]=t.target.result}})),o.oncomplete=()=>{t(n),this.getsRunning--},o.onerror=o.onabort=()=>{r("get transaction error/abort"),this.getsRunning--}}))}setNodesInDb(e){return o(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{const o=this.db.transaction(["nodes"],"readwrite"),s=o.objectStore("nodes"),n=(new Date).getTime();this.putsRunning++,(0,a.default)("[IndexedDB] Starting puts",e,this.putsRunning);for(const t in e){const r=e[t];if("object"==typeof r)try{s.put(r)}catch(e){throw(0,a.default)("[IndexedDB] Error while putting",r,e),e}else try{s.delete(t)}catch(e){throw(0,a.default)("[IndexedDB] Error while removing",s,r,e),e}}o.oncomplete=()=>{this.putsRunning--,(0,a.default)("[IndexedDB] Finished puts",e,this.putsRunning,(new Date).getTime()-n+"ms"),t()},o.onerror=()=>{this.putsRunning--,r("transaction error")},o.onabort=()=>{r("transaction abort"),this.putsRunning--}}))}))}reset(e){const t=this.db.name;this.db.close(),h.clean(t,(()=>{h.open(t,((r,o)=>{r?(0,a.default)(`[IndexedDB] Error while resetting database ${t}:`,r):this.db=o,"function"==typeof e&&e(self)}))}))}forAllNodes(e){return o(this,void 0,void 0,(function*(){return new Promise((t=>{this.db.transaction(["nodes"],"readonly").objectStore("nodes").openCursor().onsuccess=r=>{const o=r.target.result;o?(e(o.value),o.continue()):t()}}))}))}closeDB(){0===this.putsRunning?this.db.close():setTimeout(this.closeDB.bind(this),100)}static open(e,t){const r=setTimeout((function(){t("timeout trying to open db")}),1e4);try{const o=indexedDB.open(e,2);o.onerror=function(){(0,a.default)("[IndexedDB] Opening DB failed",o),clearTimeout(r),t(o.error)},o.onupgradeneeded=function(e){const t=o.result;(0,a.default)("[IndexedDB] Upgrade: from ",e.oldVersion," to ",e.newVersion),1!==e.oldVersion&&((0,a.default)("[IndexedDB] Creating object store: nodes"),t.createObjectStore("nodes",{keyPath:"path"})),(0,a.default)("[IndexedDB] Creating object store: changes"),t.createObjectStore("changes",{keyPath:"path"})},o.onsuccess=function(){clearTimeout(r);const s=o.result;if(!s.objectStoreNames.contains("nodes")||!s.objectStoreNames.contains("changes"))return(0,a.default)("[IndexedDB] Missing object store. Resetting the database."),void h.clean(e,(function(){h.open(e,t)}));t(null,o.result)}}catch(o){(0,a.default)("[IndexedDB] Failed to open database: "+o),(0,a.default)("[IndexedDB] Resetting database and trying again."),clearTimeout(r),h.clean(e,(function(){h.open(e,t)}))}}static clean(e,t){const r=indexedDB.deleteDatabase(e);r.onsuccess=function(){(0,a.default)(`[IndexedDB] Deleted database "${e}"`),t()},r.onerror=r.onabort=function(t){console.error('Failed to remove database "'+e+'"',t)}}static _rs_init(e){return new Promise(((t,r)=>{h.open(l,(function(o,s){o?r(o):(u=s,s.onerror=()=>{e._emit("error",o)},t())}))}))}static _rs_supported(){return new Promise(((e,t)=>{const r=(0,c.getGlobalContext)();let o=!1;if("undefined"!=typeof navigator&&navigator.userAgent.match(/Android (2|3|4\.[0-3])/)&&(navigator.userAgent.match(/Chrome|Firefox/)||(o=!0)),"indexedDB"in r&&!o)try{const r=indexedDB.open("rs-check");r.onerror=function(){t()},r.onsuccess=function(){r.result.close(),indexedDB.deleteDatabase("rs-check"),e()}}catch(e){t()}else t()}))}static _rs_cleanup(e){return new Promise((t=>{e.local instanceof h&&e.local.closeDB(),h.clean(l,t)}))}diffHandler(){}}(0,c.applyMixins)(h,[n.default]),e.exports=h},365:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const s=o(r(93)),n=o(r(496)),i=r(746);class a extends n.default{constructor(){super(),this._storage={},this.addEvents(["change","local-events-done"])}getNodes(e){const t={};for(let r=0,o=e.length;r<o;r++)t[e[r]]=(0,i.deepClone)(this._storage[e[r]]);return Promise.resolve(t)}setNodes(e){for(const t in e)void 0===e[t]?delete this._storage[t]:this._storage[t]=e[t];return Promise.resolve()}forAllNodes(e){for(const t in this._storage)e(this._storage[t]);return Promise.resolve()}diffHandler(){}static _rs_init(){}static _rs_supported(){return!0}static _rs_cleanup(){}}(0,i.applyMixins)(a,[s.default]),e.exports=a},794:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const s=o(r(496)),n=o(r(93)),i=o(r(334)),a=r(746),c="remotestorage:cache:nodes:";function l(e){return e.substr(0,26)===c||"remotestorage:cache:changes:"===e.substr(0,28)}class u extends s.default{constructor(){super(),this.addEvents(["change","local-events-done"])}diffHandler(...e){}getNodes(e){const t={};for(let r=0,o=e.length;r<o;r++)try{const o=JSON.parse(localStorage.getItem(c+e[r]));t[e[r]]=o||void 0}catch(o){(0,i.default)(`[LocalStorage] Failed to get node: ${o.message}`),t[e[r]]=void 0}return Promise.resolve(t)}setNodes(e){for(const t in e)localStorage.setItem(c+t,JSON.stringify(e[t]));return Promise.resolve()}forAllNodes(e){let t;for(let r=0,o=localStorage.length;r<o;r++)if(localStorage.key(r).substr(0,26)===c){try{t=JSON.parse(localStorage.getItem(localStorage.key(r)))}catch(e){t=void 0}t&&e(t)}return Promise.resolve()}static _rs_init(){}static _rs_supported(){return(0,a.localStorageAvailable)()}static _rs_cleanup(){const e=[];(0,i.default)("[LocalStorage] Starting cleanup");for(let t=0,r=localStorage.length;t<r;t++){const r=localStorage.key(t);l(r)&&e.push(r)}for(const t in e)(0,i.default)("[LocalStorage] Removing",t),localStorage.removeItem(t)}}(0,a.applyMixins)(u,[n.default]),e.exports=u},334:function(e,t,r){"use strict";const o=(this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(r(28));e.exports=function(...e){o.default.logging&&console.log(...e)}},684:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteBase=void 0;const s=o(r(93)),n=r(746);class i extends s.default{constructor(e){super(),this.rs=e,this.connected=!1}stopWaitingForToken(){this.connected||this._emit("not-connected")}addQuotes(e){return"string"!=typeof e?e:"*"===e?"*":'"'+e+'"'}stripQuotes(e){return"string"!=typeof e?e:e.replace(/^["']|["']$/g,"")}isForbiddenRequestMethod(e,t){return("PUT"===e||"DELETE"===e)&&(0,n.isFolder)(t)}}t.RemoteBase=i},423:function(e,t,r){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,s)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteStorage=void 0;const a=i(r(28)),c=i(r(334)),l=r(746),u=i(r(548)),h=i(r(275)),d=i(r(424)),f=i(r(285)),p=r(93),m=i(r(801)),g=i(r(706)),y=i(r(373)),v=i(r(982)),_=i(r(503)),b=i(r(545)),w=n(r(746)),P=(0,l.getGlobalContext)();let T;function E(e){return 403!==e.statusCode&&401!==e.statusCode||this._emit("error",new _.default),Promise.resolve(e)}function k(e){return"number"==typeof e&&e>=2e3&&e<=36e5}var S;!function(e){e.GOOGLE="googledrive",e.DROPBOX="dropbox"}(S||(S={}));class A{constructor(e){if(this._pending=[],this._cleanups=[],this._pathHandlers={change:{}},this.apiKeys={},this._init=b.default.loadFeatures,this.features=b.default.features,this.loadFeature=b.default.loadFeature,this.featureSupported=b.default.featureSupported,this.featureDone=b.default.featureDone,this.featuresDone=b.default.featuresDone,this.featuresLoaded=b.default.featuresLoaded,this.featureInitialized=b.default.featureInitialized,this.featureFailed=b.default.featureFailed,this.hasFeature=b.default.hasFeature,this._setCachingModule=b.default._setCachingModule,this._collectCleanupFunctions=b.default._collectCleanupFunctions,this._fireReady=b.default._fireReady,this.initFeature=b.default.initFeature,"object"==typeof e&&(0,l.extend)(a.default,e),this.addEvents(["ready","authing","connecting","connected","disconnected","not-connected","conflict","error","features-loaded","sync-interval-change","sync-started","sync-req-done","sync-done","wire-busy","wire-done","network-offline","network-online"]),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")}),T=(0,l.localStorageAvailable)(),T){this.apiKeys=(0,l.getJSONFromLocalStorage)("remotestorage:api-keys")||{};const e=localStorage.getItem("remotestorage:backend");"dropbox"===e||"googledrive"===e?this.setBackend(e):this.setBackend("remotestorage")}const t=this.on;this.on=function(e,r){if(this._allLoaded)switch(e){case"features-loaded":setTimeout(r,0);break;case"ready":this.remote&&setTimeout(r,0);break;case"connected":this.remote&&this.remote.connected&&setTimeout(r,0);break;case"not-connected":this.remote&&!this.remote.connected&&setTimeout(r,0)}return t.call(this,e,r)},this._init(),this.fireInitial=function(){this.local&&setTimeout(this.local.fireInitial.bind(this.local),0)}.bind(this),this.on("ready",this.fireInitial.bind(this)),this.loadModules()}get connected(){return this.remote.connected}loadModules(){a.default.modules.forEach(this.addModule.bind(this))}authorize(e){if(this.access.setStorageType(this.remote.storageApi),void 0===e.scope&&(e.scope=this.access.scopeParameter),P.cordova)e.redirectUri=a.default.cordovaRedirectUri;else{const t=h.default.getLocation();let r=t.origin;"/"!==t.pathname&&(r+=t.pathname),e.redirectUri=r}void 0===e.clientId&&(e.clientId=e.redirectUri.match(/^(https?:\/\/[^/]+)/)[0]),h.default.authorize(this,e)}impliedauth(e,t){e=e||this.remote.storageApi,t=t||String(document.location),(0,c.default)("ImpliedAuth proceeding due to absent authURL; storageApi = "+e+" redirectUri = "+t),this.remote.configure({token:h.default.IMPLIED_FAKE_TOKEN}),document.location.href=t}connect(e,t){if(this.setBackend("remotestorage"),e.indexOf("@")<0&&!e.match(/^(https?:\/\/)?[^\s\/$\.?#]+\.[^\s]*$/))this._emit("error",new A.DiscoveryError("Not a valid user address or URL."));else{if(e.indexOf("@")<0&&!e.match(/^https?:\/\//)&&(e=`https://${e}`),P.cordova){if("string"!=typeof a.default.cordovaRedirectUri)return void this._emit("error",new A.DiscoveryError("Please supply a custom HTTPS redirect URI for your Cordova app"));if(!P.cordova.InAppBrowser)return void this._emit("error",new A.DiscoveryError("Please include the InAppBrowser Cordova plugin to enable OAuth"))}this.remote.configure({userAddress:e}),this._emit("connecting"),(0,y.default)(e).then((r=>{if(this._emit("authing"),r.userAddress=e,this.remote.configure(r),!this.remote.connected)if(r.authURL)if(void 0===t)this.authorize({authURL:r.authURL});else{if("string"!=typeof t)throw new Error("Supplied bearer token must be a string");(0,c.default)("Skipping authorization sequence and connecting with known token"),this.remote.configure({token:t})}else this.impliedauth()}),(()=>{this._emit("error",new A.DiscoveryError("No storage information found for this user address."))}))}}reconnect(){this.remote.configure({token:null}),"remotestorage"===this.backend?this.connect(this.remote.userAddress):this.remote.connect()}disconnect(){this.remote&&this.remote.configure({userAddress:null,href:null,storageApi:null,token:null,properties:null}),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")});const e=this._cleanups.length;let t=0;const r=()=>{t++,t>=e&&(this._init(),(0,c.default)('Cleanups done, emitting "disconnected" event'),this._emit("disconnected"))};e>0?this._cleanups.forEach((e=>{const t=e(this);"object"==typeof t&&"function"==typeof t.then?t.then(r):r()})):r()}setBackend(e){this.backend=e,T&&(void 0!==e?localStorage.setItem("remotestorage:backend",e):localStorage.removeItem("remotestorage:backend"))}onChange(e,t){this._pathHandlers.change[e]||(this._pathHandlers.change[e]=[]),this._pathHandlers.change[e].push(t)}enableLog(){a.default.logging=!0}disableLog(){a.default.logging=!1}log(...e){c.default.apply(A,e)}setApiKeys(e){const t=[S.GOOGLE,S.DROPBOX];if("object"!=typeof e||!Object.keys(e).every((e=>t.includes(e))))return console.error("setApiKeys() was called with invalid arguments"),!1;Object.keys(e).forEach((t=>{const r=e[t];if(r){switch(t){case S.DROPBOX:this.apiKeys[S.DROPBOX]={appKey:r},void 0!==this.dropbox&&this.dropbox.clientId===r||g.default._rs_init(this);break;case S.GOOGLE:this.apiKeys[S.GOOGLE]={clientId:r},void 0!==this.googledrive&&this.googledrive.clientId===r||m.default._rs_init(this)}return!0}delete this.apiKeys[t]})),T&&localStorage.setItem("remotestorage:api-keys",JSON.stringify(this.apiKeys))}setCordovaRedirectUri(e){if("string"!=typeof e||!e.match(/http(s)?:\/\//))throw new Error("Cordova redirect URI must be a URI string");a.default.cordovaRedirectUri=e}_setGPD(e,t){function r(e){return function(...r){return e.apply(t,r).then(E.bind(this))}}this.get=r(e.get),this.put=r(e.put),this.delete=r(e.delete)}_pendingGPD(e){return(...t)=>{const r=Array.prototype.slice.call(t);return new Promise(((t,o)=>{this._pending.push({method:e,args:r,promise:{resolve:t,reject:o}})}))}}_processPending(){this._pending.forEach((e=>{try{this[e.method](...e.args).then(e.promise.resolve,e.promise.reject)}catch(t){e.promise.reject(t)}})),this._pending=[]}_bindChange(e){e.on("change",this._dispatchEvent.bind(this,"change"))}_dispatchEvent(e,t){Object.keys(this._pathHandlers[e]).forEach((r=>{const o=r.length;t.path.substr(0,o)===r&&this._pathHandlers[e][r].forEach((e=>{const o={};for(const e in t)o[e]=t[e];o.relativePath=t.path.replace(new RegExp("^"+r),"");try{e(o)}catch(e){console.error("'change' handler failed: ",e,e.stack),this._emit("error",e)}}))}))}scope(e){if("string"!=typeof e)throw"Argument 'path' of baseClient.scope must be a string";return this.access.checkPathPermission(e,"r")||console.warn("WARNING: Please use remoteStorage.access.claim() to ask for access permissions first: https://remotestorage.io/rs.js/docs/api/access/classes/Access.html#claim"),new d.default(this,e)}getSyncInterval(){return a.default.syncInterval}setSyncInterval(e){if(!k(e))throw e+" is not a valid sync interval";const t=a.default.syncInterval;a.default.syncInterval=e,this._emit("sync-interval-change",{oldValue:t,newValue:e})}getBackgroundSyncInterval(){return a.default.backgroundSyncInterval}setBackgroundSyncInterval(e){if(!k(e))throw e+" is not a valid sync interval";const t=a.default.backgroundSyncInterval;a.default.backgroundSyncInterval=e,this._emit("sync-interval-change",{oldValue:t,newValue:e})}getCurrentSyncInterval(){return a.default.isBackground?a.default.backgroundSyncInterval:a.default.syncInterval}getRequestTimeout(){return a.default.requestTimeout}setRequestTimeout(e){if("number"!=typeof e)throw e+" is not a valid request timeout";a.default.requestTimeout=e}setupSyncCycle(){this.sync&&!this.sync.stopped&&((0,c.default)("[Sync] Setting up sync cycle"),this.on("sync-done",(()=>{(0,c.default)("[Sync] Sync done. Setting timer to",this.getCurrentSyncInterval()),this.sync&&!this.sync.stopped&&(this._syncTimer&&clearTimeout(this._syncTimer),this._syncTimer=setTimeout(this.sync.sync.bind(this.sync),this.getCurrentSyncInterval()))})),this.sync.sync())}startSync(){return a.default.cache?(this.sync.stopped=!1,this.syncStopped=!1,this.sync.sync()):(console.warn("Nothing to sync, because caching is disabled."),Promise.resolve())}stopSync(){clearTimeout(this._syncTimer),this._syncTimer=void 0,this.sync?((0,c.default)("[Sync] Stopping sync"),this.sync.stopped=!0):((0,c.default)("[Sync] Will instantiate sync stopped"),this.syncStopped=!0)}addModule(e){const t=e.name,r=e.builder;if(Object.defineProperty(this,t,{configurable:!0,get:function(){const e=this._loadModule(t,r);return Object.defineProperty(this,t,{value:e}),e}}),-1!==t.indexOf("-")){const e=t.replace(/\-[a-z]/g,(function(e){return e[1].toUpperCase()}));Object.defineProperty(this,e,{get:function(){return this[t]}})}}_loadModule(e,t){if(t)return t(new d.default(this,"/"+e+"/"),new d.default(this,"/public/"+e+"/")).exports;throw"Unknown module: "+e}}t.RemoteStorage=A,A.SyncError=v.default,A.Unauthorized=_.default,A.DiscoveryError=y.default.DiscoveryError,A.util=w,Object.defineProperty(A.prototype,"access",{configurable:!0,get:function(){const e=new u.default;return Object.defineProperty(this,"access",{value:e}),e}}),Object.defineProperty(A.prototype,"caching",{configurable:!0,get:function(){const e=new f.default(this);return Object.defineProperty(this,"caching",{value:e}),e}}),(0,l.applyMixins)(A,[p.EventHandling]),t.default=A},368:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isArrayBufferView=void 0,t.retryAfterMs=function(e){const t=1e3*parseInt(e.getResponseHeader("Retry-After"));return t>=1e3?t:Math.max(1500,Math.min(6e4,Math.round(i.default.syncInterval/(2.9+.2*Math.random()))))},t.requestWithTimeout=function(e,r,s){return o(this,void 0,void 0,(function*(){return"function"==typeof fetch?function(e,t,r){return o(this,void 0,void 0,(function*(){const o="function"==typeof AbortController?new AbortController:null;let s;const a=new Promise(((e,t)=>{s=setTimeout((()=>{o&&o.abort(),t("timeout")}),i.default.requestTimeout)}));let c;const l={},u=fetch(t,{method:e,headers:r.headers,body:r.body,signal:o?o.signal:void 0}).then((e=>{switch((0,n.default)("[requests fetch]",e),e.headers.forEach(((e,t)=>{l[t.toUpperCase()]=e})),c={readyState:4,status:e.status,statusText:e.statusText,response:void 0,getResponseHeader:e=>l[e.toUpperCase()]||null,responseType:r.responseType,responseURL:t},r.responseType){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json();case void 0:case"":case"text":return e.text();default:throw new Error("responseType 'document' is not currently supported using fetch")}})).then((e=>(c.response=e,r.responseType&&"text"!==r.responseType||(c.responseText=e),c))).finally((()=>{clearTimeout(s)}));return Promise.race([u,a])}))}(e,r,s):"function"==typeof XMLHttpRequest?function(e,r,s){return o(this,void 0,void 0,(function*(){return new Promise(((o,a)=>{(0,n.default)("[requests XHR]",e,r);let c=!1;const l=setTimeout((()=>{c=!0,a("timeout")}),i.default.requestTimeout),u=new XMLHttpRequest;if(u.open(e,r,!0),s.responseType&&(u.responseType=s.responseType),s.headers)for(const e in s.headers)u.setRequestHeader(e,s.headers[e]);u.onload=()=>{c||(clearTimeout(l),o(u))},u.onerror=e=>{c||(clearTimeout(l),a(e))};let h=s.body;"object"==typeof h&&!(0,t.isArrayBufferView)(h)&&h instanceof ArrayBuffer&&(h=new Uint8Array(h)),u.send(h)}))}))}(e,r,s):Promise.reject("[Requests] You need to add a polyfill for fetch or XMLHttpRequest")}))};const n=s(r(334)),i=s(r(28));if("function"==typeof(r.g||window).ArrayBufferView)t.isArrayBufferView=function(e){return e&&e instanceof(r.g||window).ArrayBufferView};else{const e=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];t.isArrayBufferView=function(t){for(let r=0;r<8;r++)if(t instanceof e[r])return!0;return!1}}},941:function(e){"use strict";e.exports=class{constructor(e){this._itemsRev={},this._storage={},this._canPropagate=!1,this.defaultValue=e,this.activatePropagation()}get(e){e=e.toLowerCase();let t=this._storage[e];return void 0===t&&(t=this.defaultValue,this._storage[e]=t),t}set(e,t){return e=e.toLowerCase(),this._storage[e]===t||(this._storage[e]=t,t||delete this._itemsRev[e],this._updateParentFolderItemRev(e,t),this._canPropagate&&this._propagate(e)),t}delete(e){return this.set(e,null)}deactivatePropagation(){return this._canPropagate=!1,!0}activatePropagation(){return this._canPropagate||(this._generateFolderRev("/"),this._canPropagate=!0),!0}_hashCode(e){let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}_generateHash(e){const t=e.sort().join("|");return""+this._hashCode(t)}_updateParentFolderItemRev(e,t){if("/"!==e){const r=this._getParentFolder(e);this._itemsRev[r]||(this._itemsRev[r]={});const o=this._itemsRev[r];t?o[e]=t:delete o[e],this._updateParentFolderItemRev(r,this.defaultValue)}}_getParentFolder(e){return e.substr(0,e.lastIndexOf("/",e.length-2)+1)}_propagate(e){if("/"!==e){const t=this._getParentFolder(e),r=this._itemsRev[t],o=[];for(const e in r)o.push(r[e]);const s=this._generateHash(o);this.set(t,s)}}_generateFolderRev(e){const t=this._itemsRev[e];let r=this.defaultValue;if(t){const e=[];for(const r in t){let o;o="/"===r.substr(-1)?this._generateFolderRev(r):t[r],e.push(o)}e.length>0&&(r=this._generateHash(e))}return this.set(e,r),r}}},491:function(e){"use strict";class t extends Error{constructor(e){super();const t=new Error("Schema not found: "+e);return t.name="SchemaNotFound",t}}e.exports=t},982:function(e){"use strict";class t extends Error{constructor(e){super(),this.name="SyncError",this.message="Sync failed: ","string"==typeof e?this.message+=e:(this.message+=e.message,this.stack=e.stack,this.originalError=e)}}e.exports=t},313:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Sync=void 0;const n=s(r(28)),i=s(r(451)),a=s(r(93)),c=s(r(334)),l=s(r(275)),u=s(r(982)),h=s(r(503)),d=r(746);let f,p;function m(e,t,r){return{action:e,path:t,promise:r}}function g(e,t){return e.common.revision!==t&&(!e.remote||e.remote.revision!==t)}function y(e){return!!e.common&&!!e.common.revision}class v{constructor(e){this.numThreads=10,this._tasks={},this._running={},this._timeStarted={},this._finishedTasks=[],this.rs=e,this.rs.local.onDiff((e=>{this.addTask(e),this.doTasks()})),this.rs.caching.onActivate((e=>{this.addTask(e),this.doTasks()})),this.addEvents(["done","req-done"])}now(){return(new Date).getTime()}queueGetRequest(e){return o(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{this.rs.remote.connected?this.rs.remote.online?(this.addTask(e,function(){this.rs.local.get(e).then((e=>t(e)))}.bind(this)),this.doTasks()):r("cannot fulfill maxAge requirement - remote is not online"):r("cannot fulfill maxAge requirement - remote is not connected")}))}))}corruptServerItemsMap(e){if("object"!=typeof e||Array.isArray(e))return!0;for(const t in e){const r=e[t];if("object"!=typeof r)return!0;if("string"!=typeof r.ETag)return!0;if((0,d.isFolder)(t)){if(-1!==t.substring(0,t.length-1).indexOf("/"))return!0}else if(-1!==t.indexOf("/"))return!0}return!1}corruptItemsMap(e){if("object"!=typeof e||Array.isArray(e))return!0;for(const t in e)if("boolean"!=typeof e[t])return!0;return!1}corruptRevision(e){return"object"!=typeof e||Array.isArray(e)||e.revision&&"string"!=typeof e.revision||e.body&&"string"!=typeof e.body&&"object"!=typeof e.body||e.contentType&&"string"!=typeof e.contentType||e.contentLength&&"number"!=typeof e.contentLength||e.timestamp&&"number"!=typeof e.timestamp||e.itemsMap&&this.corruptItemsMap(e.itemsMap)}isCorrupt(e){return"object"!=typeof e||Array.isArray(e)||"string"!=typeof e.path||this.corruptRevision(e.common)||e.local&&this.corruptRevision(e.local)||e.remote&&this.corruptRevision(e.remote)||e.push&&this.corruptRevision(e.push)}hasTasks(){return Object.keys(this._tasks).length>0}collectDiffTasks(){return o(this,void 0,void 0,(function*(){let e=0;return this.rs.local.forAllNodes((t=>{e>100||(this.isCorrupt(t)?((0,c.default)("[Sync] WARNING: corrupt node in local cache",t),"object"==typeof t&&t.path&&(this.addTask(t.path),e++)):(this.needsFetch(t)&&this.rs.access.checkPathPermission(t.path,"r")||(0,d.isDocument)(t.path)&&this.needsPush(t)&&this.rs.access.checkPathPermission(t.path,"rw"))&&(this.addTask(t.path),e++))})).then((()=>e))}))}inConflict(e){return!(!e.local||!e.remote||void 0===e.remote.body&&!e.remote.itemsMap)}needsRefresh(e){return!!e.common&&(!e.common.timestamp||this.now()-e.common.timestamp>n.default.syncInterval)}needsFetch(e){return!!this.inConflict(e)||!(!e.common||void 0!==e.common.itemsMap||void 0!==e.common.body)||!(!e.remote||void 0!==e.remote.itemsMap||void 0!==e.remote.body)}needsPush(e){return!this.inConflict(e)&&(!(!e.local||e.push)||void 0)}needsRemotePut(e){return e.local&&"string"==typeof e.local.body}needsRemoteDelete(e){return e.local&&!1===e.local.body}getParentPath(e){const t=e.match(/^(.*\/)([^\/]+\/?)$/);if(t)return t[1];throw new Error('Not a valid path: "'+e+'"')}deleteChildPathsFromTasks(){for(const e in this._tasks){const t=(0,d.pathsFromRoot)(e);for(let r=1;r<t.length;r++)this._tasks[t[r]]&&(Array.isArray(this._tasks[e])&&this._tasks[e].length&&Array.prototype.push.apply(this._tasks[t[r]],this._tasks[e]),delete this._tasks[e])}}collectRefreshTasks(){return o(this,void 0,void 0,(function*(){yield this.rs.local.forAllNodes((e=>{let t;if(this.needsRefresh(e)){try{t=this.getParentPath(e.path)}catch(e){}t&&this.rs.access.checkPathPermission(t,"r")?this.addTask(t):this.rs.access.checkPathPermission(e.path,"r")&&this.addTask(e.path)}})),this.deleteChildPathsFromTasks()}))}flush(e){for(const t in e)"FLUSH"===this.rs.caching.checkPath(t)&&e[t]&&!e[t].local&&((0,c.default)("[Sync] Flushing",t),e[t]=void 0);return e}doTask(e){return o(this,void 0,void 0,(function*(){return this.rs.local.getNodes([e]).then((t=>{const r=t[e];return void 0===r||function(e){return!(!e.remote||!e.remote.revision||e.remote.itemsMap||e.remote.body)}(r)?m("get",e,this.rs.remote.get(e)):this.needsRemotePut(r)?(r.push=(0,d.deepClone)(r.local),r.push.timestamp=this.now(),this.rs.local.setNodes(this.flush(t)).then((()=>{let t;return t=y(r)?{ifMatch:r.common.revision}:{ifNoneMatch:"*"},m("put",e,this.rs.remote.put(e,r.push.body,r.push.contentType,t))}))):this.needsRemoteDelete(r)?(r.push={body:!1,timestamp:this.now()},this.rs.local.setNodes(this.flush(t)).then((()=>y(r)?m("delete",e,this.rs.remote.delete(e,{ifMatch:r.common.revision})):m("get",e,this.rs.remote.get(e))))):y(r)?m("get",e,this.rs.remote.get(e,{ifNoneMatch:r.common.revision})):m("get",e,this.rs.remote.get(e))}))}))}autoMergeFolder(e){if(e.remote.itemsMap&&(e.common=e.remote,delete e.remote,e.common.itemsMap)){for(const t in e.common.itemsMap)e.local.itemsMap[t]||(e.local.itemsMap[t]=!1);for(const t in e.local.itemsMap)e.common.itemsMap[t]||this.addTask(e.path+t);(0,d.equal)(e.local.itemsMap,e.common.itemsMap)&&delete e.local}return e}autoMergeDocument(e){var t;return function(e){return(!e.remote||!e.remote.revision||e.remote.revision===e.common.revision)&&(void 0===e.common.body&&!1===e.remote.body||e.remote.body===e.common.body&&e.remote.contentType===e.common.contentType)}(e)?delete(e=function(e){return e.remote&&!1===e.remote.body&&e.local&&!1===e.local.body&&delete e.local,e}(e)).remote:void 0!==e.remote.body&&(!1===e.remote.body&&!1===(null===(t=e.local)||void 0===t?void 0:t.body)||((0,c.default)("[Sync] Emitting conflict event"),setTimeout(this.rs.local.emitChange.bind(this.rs.local),10,{origin:"conflict",path:e.path,oldValue:e.local.body,newValue:e.remote.body,lastCommonValue:e.common.body,oldContentType:e.local.contentType,newContentType:e.remote.contentType,lastCommonContentType:e.common.contentType})),!1===e.remote.body?e.common={}:e.common=e.remote,delete e.remote,delete e.local),e}autoMerge(e){if(e.remote){if(e.local)return(0,d.isFolder)(e.path)?this.autoMergeFolder(e):this.autoMergeDocument(e);if((0,d.isFolder)(e.path))void 0!==e.remote.itemsMap&&(e.common=e.remote,delete e.remote);else if(void 0!==e.remote.body){const t={origin:"remote",path:e.path,oldValue:!1===e.common.body?void 0:e.common.body,newValue:!1===e.remote.body?void 0:e.remote.body,oldContentType:e.common.contentType,newContentType:e.remote.contentType};if(void 0===t.oldValue&&void 0===t.newValue||this.rs.local.emitChange(t),!1===e.remote.body)return;e.common=e.remote,delete e.remote}return e}e.common.body&&this.rs.local.emitChange({origin:"remote",path:e.path,oldValue:e.common.body,newValue:void 0,oldContentType:e.common.contentType,newContentType:void 0})}updateCommonTimestamp(e,t){return o(this,void 0,void 0,(function*(){return this.rs.local.getNodes([e]).then((r=>(r[e]&&r[e].common&&r[e].common.revision===t&&(r[e].common.timestamp=this.now()),this.rs.local.setNodes(this.flush(r)))))}))}markChildren(e,t,r,s){return o(this,void 0,void 0,(function*(){const o=[],n={},i={};for(const r in t)o.push(e+r),n[e+r]=t[r];for(const t in s)o.push(e+t);const a=yield this.rs.local.getNodes(o);let c,l;for(const t in a)if(l=a[t],n[t])l&&l.common?g(l,n[t].ETag)&&(r[t]=(0,d.deepClone)(l),r[t].remote={revision:n[t].ETag,timestamp:this.now()},r[t]=this.autoMerge(r[t])):(c=this.rs.caching.checkPath(t),"ALL"===c&&(r[t]={path:t,common:{timestamp:this.now()},remote:{revision:n[t].ETag,timestamp:this.now()}})),r[t]&&n[t]["Content-Type"]&&(r[t].remote.contentType=n[t]["Content-Type"]),r[t]&&n[t]["Content-Length"]&&(r[t].remote.contentLength=n[t]["Content-Length"]);else if(s[t.substring(e.length)]&&l&&l.common){if(l.common.itemsMap)for(const e in l.common.itemsMap)i[t+e]=!0;if(l.local&&l.local.itemsMap)for(const e in l.local.itemsMap)i[t+e]=!0;if(l.remote||(0,d.isFolder)(t))r[t]=void 0;else if(r[t]=this.autoMerge(l),void 0===r[t]){const o=this.getParentPath(t),s=r[o],n=t.substring(e.length);s&&s.local&&(delete s.local.itemsMap[n],(0,d.equal)(s.local.itemsMap,s.common.itemsMap)&&delete s.local)}}const u=yield this.markRemoteDeletions(Object.keys(i),r);u&&(yield this.rs.local.setNodes(this.flush(u)))}))}markRemoteDeletions(e,t){return o(this,void 0,void 0,(function*(){if(0===e.length)return t;const r=yield this.rs.local.getNodes(e),o={};function s(e,t){if(e&&e.itemsMap)for(const r in e.itemsMap)o[t+r]=!0}for(const e in r){const o=r[e];o&&((0,d.isFolder)(e)?(s(o.common,e),s(o.local,e)):o.common&&void 0!==o.common.body&&(t[e]=(0,d.deepClone)(o),t[e].remote={body:!1,timestamp:this.now()},t[e]=this.autoMerge(t[e])))}const n=yield this.markRemoteDeletions(Object.keys(o),t);n&&(yield this.rs.local.setNodes(this.flush(n)))}))}completeFetch(e,t,r,s){return o(this,void 0,void 0,(function*(){let o,n;const i=(0,d.pathsFromRoot)(e);(0,d.isFolder)(e)?o=[e]:(n=i[1],o=[e,n]);const a=yield this.rs.local.getNodes(o),c=a[n],l={};let u,h=a[e];function f(e){if(e&&e.itemsMap)for(u in e.itemsMap)t[u]||(l[u]=!0)}if("object"==typeof h&&h.path===e&&"object"==typeof h.common||(h={path:e,common:{}},a[e]=h),h.remote={revision:s,timestamp:this.now()},(0,d.isFolder)(e))for(u in f(h.common),f(h.remote),h.remote.itemsMap={},t)h.remote.itemsMap[u]=!0;else h.remote.body=t,h.remote.contentType=r,c&&c.local&&c.local.itemsMap&&(u=e.substring(n.length),!1!==t?c.local.itemsMap[u]=!0:c.local.itemsMap[u]&&delete c.local.itemsMap[u],(0,d.equal)(c.local.itemsMap,c.common.itemsMap)&&delete c.local);return a[e]=this.autoMerge(h),{toBeSaved:a,missingChildren:l}}))}completePush(e,t,r,s){return o(this,void 0,void 0,(function*(){const o=yield this.rs.local.getNodes([e]),n=o[e];if(!n.push)throw this.stopped=!0,new Error("completePush called but no push version!");r?((0,c.default)("[Sync] We have a conflict"),n.remote&&n.remote.revision===s||(n.remote={revision:s||"conflict",timestamp:this.now()},delete n.push),o[e]=this.autoMerge(n)):(n.common={revision:s,timestamp:this.now()},"put"===t?(n.common.body=n.push.body,n.common.contentType=n.push.contentType,(0,d.equal)(n.local.body,n.push.body)&&n.local.contentType===n.push.contentType&&delete n.local,delete n.push):"delete"===t&&(!1===n.local.body?o[e]=void 0:delete n.push)),yield this.rs.local.setNodes(this.flush(o))}))}dealWithFailure(e){return o(this,void 0,void 0,(function*(){const t=yield this.rs.local.getNodes([e]);if(t[e])return delete t[e].push,this.rs.local.setNodes(this.flush(t))}))}interpretStatus(e){const t={statusCode:e,successful:void 0,conflict:void 0,unAuth:void 0,notFound:void 0,changed:void 0,networkProblems:void 0};if("string"==typeof e&&("offline"===e||"timeout"===e))return t.successful=!1,t.networkProblems=!0,t;if("number"==typeof e){const r=Math.floor(e/100);return t.successful=2===r||304===e||412===e||404===e,t.conflict=412===e,t.unAuth=401===e&&this.rs.remote.token!==l.default.IMPLIED_FAKE_TOKEN||402===e||403===e,t.notFound=404===e,t.changed=304!==e,t}}handleGetResponse(e,t,r,s,n){return o(this,void 0,void 0,(function*(){if(t.notFound&&(r=!!(0,d.isFolder)(e)&&{}),t.changed){const t=yield this.completeFetch(e,r,s,n);if((0,d.isFolder)(e)){if(this.corruptServerItemsMap(r))return(0,c.default)("[Sync] WARNING: Discarding corrupt folder description from server for "+e),!1;yield this.markChildren(e,r,t.toBeSaved,t.missingChildren)}else yield this.rs.local.setNodes(this.flush(t.toBeSaved))}else yield this.updateCommonTimestamp(e,n);return!0}))}handleResponse(e,t,r){return o(this,void 0,void 0,(function*(){const o=this.interpretStatus(r.statusCode);if(o.successful){if("get"===t)return this.handleGetResponse(e,o,r.body,r.contentType,r.revision);if("put"===t||"delete"===t)return this.completePush(e,t,o.conflict,r.revision).then((function(){return!0}));throw new Error(`cannot handle response for unknown action ${t}`)}{let t;return t=o.unAuth?new h.default:o.networkProblems?new u.default("Network request failed."):new Error("HTTP response code "+o.statusCode+" received."),this.dealWithFailure(e).then((()=>{throw this.rs._emit("error",t),t}))}}))}finishTask(e){return o(this,arguments,void 0,(function*(e,t=!0){if(void 0===e.action)return void delete this._running[e.path];if(t&&((0,c.default)("[Sync] queue finished task:",e.path),this._finishedTasks.push(e),this._finishedTasks.length>1))return void(0,c.default)("[Sync] delaying finished task:",e.path);let r;(0,c.default)("[Sync] run task:",e.path);try{r=yield e.promise}catch(t){(0,c.default)("[Sync] wire client rejects its promise",e.path,e.action,t),r={statusCode:"offline"}}try{const t=yield this.handleResponse(e.path,e.action,r);this.finishSuccessfulTask(e,t)}catch(t){this.finishUnsuccessfulTask(e,t)}}))}finishSuccessfulTask(e,t){return o(this,void 0,void 0,(function*(){if(this._finishedTasks.shift(),delete this._timeStarted[e.path],delete this._running[e.path],t&&this._tasks[e.path]){for(let t=0;t<this._tasks[e.path].length;t++)this._tasks[e.path][t]();delete this._tasks[e.path]}this.rs._emit("sync-req-done",{tasksRemaining:Object.keys(this._tasks).length}),this._finishedTasks.length>0?yield this.finishTask(this._finishedTasks[0],!1):yield this.collectTasks(!1).then((()=>{!this.hasTasks()||this.stopped?(this.done||(this.done=!0),this.rs._emit("sync-done",{completed:!0})):setTimeout((()=>{this.doTasks()}),10)}))}))}finishUnsuccessfulTask(e,t){return o(this,void 0,void 0,(function*(){(0,c.default)("[Sync]",t.message),this._finishedTasks.shift(),delete this._timeStarted[e.path],delete this._running[e.path],this.rs._emit("sync-req-done",{tasksRemaining:Object.keys(this._tasks).length}),this._finishedTasks.length>0?yield this.finishTask(this._finishedTasks[0],!1):this.done||(this.done=!0,this.rs._emit("sync-done",{completed:!1}))}))}tasksWanted(){return this.rs.remote.connected?this.rs.remote.online?this.numThreads:1:0}doTasks(){const e=this.tasksWanted()-Object.keys(this._running).length;if(e<=0)return!0;this.hasTasks()&&!this.done&&this.rs._emit("sync-started");let t,r=0;for(t in this._tasks)if(!this._running[t]&&(this._timeStarted[t]=this.now(),this._running[t]=this.doTask(t).then(this.finishTask.bind(this)),r++,r>=e))break;return r>=e}collectTasks(){return o(this,arguments,void 0,(function*(e=!0){if(!this.hasTasks()&&!this.stopped)return(yield this.collectDiffTasks())>0?void 0:e?this.collectRefreshTasks():void 0}))}addTask(e,t){this._tasks[e]||(this._tasks[e]=[]),"function"==typeof t&&this._tasks[e].push(t)}sync(){return o(this,void 0,void 0,(function*(){if(this.done=!1,!this.doTasks()){try{yield this.collectTasks()}catch(e){throw(0,c.default)("[Sync] Sync error",e),new Error("Local cache unavailable")}this.doTasks()}}))}static _rs_init(e){f=function(){const t=new i.default;t.isBrowser()&&function(e,t){function r(e){const r=t.getCurrentSyncInterval();n.default.isBackground=!e;const o=t.getCurrentSyncInterval();t._emit("sync-interval-change",{oldValue:r,newValue:o})}e.on("background",(()=>r(!1))),e.on("foreground",(()=>r(!0)))}(t,e),e.sync||(e.sync=new v(e),e.syncStopped&&((0,c.default)("[Sync] Initializing with sync stopped"),e.sync.stopped=!0,delete e.syncStopped)),e.setupSyncCycle()},p=function(){e.removeEventListener("connected",p),e.startSync()},e.on("ready",f),e.on("connected",p)}static _rs_cleanup(e){e.stopSync(),e.removeEventListener("ready",f),e.removeEventListener("connected",p),e.sync=void 0,delete e.sync}}t.Sync=v,(0,d.applyMixins)(v,[a.default]),t.default=v},370:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};const s=(this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(r(334));function n(e){return"dropbox"===this.backend&&!!e.match(/^\/public\/.*[^\/]$/)}const i={get:function(e,t){if(this.local){if(void 0===t)t="object"==typeof(r=this).remote&&r.remote.connected&&r.remote.online?2*r.getSyncInterval():((0,s.default)("Not setting default maxAge, because remote is offline or not connected"),!1);else if("number"!=typeof t&&!1!==t)return Promise.reject("Argument 'maxAge' must be 'false' or a number");return this.local.get(e,t,this.sync.queueGetRequest.bind(this.sync))}return this.remote.get(e);var r},put:function(e,t,r){return n.bind(this)(e)?i._wrapBusyDone.call(this,this.remote.put(e,t,r)):this.local?this.local.put(e,t,r):i._wrapBusyDone.call(this,this.remote.put(e,t,r))},delete:function(e,t){return this.local?this.local.delete(e,t):i._wrapBusyDone.call(this,this.remote.delete(e,t))},_wrapBusyDone:function(e){return o(this,void 0,void 0,(function*(){return this._emit("wire-busy"),e.then((e=>(this._emit("wire-done",{success:!0}),Promise.resolve(e))),(e=>(this._emit("wire-done",{success:!1}),Promise.reject(e))))}))}};e.exports=i},613:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseClientTypes=void 0;class r{constructor(){this.uris={},this.schemas={},this.aliases={}}declare(e,t,r,o){const s=e+"/"+t;if(o.extends){const t=o.extends.split("/"),r=1===t.length?e+"/"+t.shift():t.join("/"),n=this.uris[r];if(!n)throw"Type '"+s+"' tries to extend unknown schema '"+r+"'";o.extends=this.schemas[n]}this.uris[s]=r,this.aliases[r]=s,this.schemas[r]=o}resolveAlias(e){return this.uris[e]}getSchema(e){return this.schemas[e]}inScope(e){const t=e.length,r={};for(const o in this.uris)if(o.substr(0,t+1)===e+"/"){const e=this.uris[o];r[e]=this.schemas[e]}return r}}t.BaseClientTypes=r;const o=new r;t.default=o},503:function(e){"use strict";class t extends Error{constructor(e,t={}){super(),this.name="Unauthorized",this.message=void 0===e?"App authorization expired or revoked.":e,void 0!==t.code&&(this.code=t.code),this.stack=(new Error).stack}}e.exports=t},746:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};function s(e,t){if("object"==typeof e&&!Array.isArray(e)&&null!==e)for(const r in e)if("object"==typeof e[r]&&null!==e[r])if("[object ArrayBuffer]"===e[r].toString()){t[r]=new ArrayBuffer(e[r].byteLength);const o=new Int8Array(e[r]);new Int8Array(t[r]).set(o)}else s(e[r],t[r])}Object.defineProperty(t,"__esModule",{value:!0}),t.toBase64=t.getTextFromArrayBuffer=t.shouldBeTreatedAsBinary=t.getJSONFromLocalStorage=t.localStorageAvailable=t.pathsFromRoot=t.deepClone=t.equal=t.bindAll=t.cleanPath=t.baseName=t.isDocument=t.isFolder=t.containingFolder=t.extend=t.getGlobalContext=t.globalContext=t.logError=void 0,t.generateCodeVerifier=function(){return o(this,arguments,void 0,(function*(e=128){const t=new Uint8Array(e);crypto.getRandomValues(t);const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",o=Array.from(t).map((e=>r[e%66])),s=o.join(""),n=Uint8Array.from(o.map((e=>e.charCodeAt(0)))),i=(a=yield crypto.subtle.digest("SHA-256",n),btoa(String.fromCharCode.apply(null,new Uint8Array(a))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""));var a;return crypto.getRandomValues(t),{codeVerifier:s,codeChallenge:i,state:Array.from(t).map((e=>r[e%66])).join("")}}))},t.applyMixins=function(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((r=>{Object.defineProperty(e.prototype,r,Object.getOwnPropertyDescriptor(t.prototype,r))}))}))},t.logError=e=>{"string"==typeof e?console.error(e):console.error(e.message,e.stack)},t.globalContext="undefined"!=typeof window?window:"object"==typeof self?self:r.g,t.getGlobalContext=()=>"undefined"!=typeof window?window:"object"==typeof self?self:r.g,t.extend=(...e)=>{const t=e[0];return Array.prototype.slice.call(e,1).forEach((function(e){for(const r in e)t[r]=e[r]})),t},t.containingFolder=e=>{if(""===e)return"/";if(!e)throw"Path not given!";return e.replace(/\/+/g,"/").replace(/[^\/]+\/?$/,"")},t.isFolder=e=>"/"===e.slice(-1),t.isDocument=e=>!(0,t.isFolder)(e),t.baseName=e=>{const r=e.split("/");return(0,t.isFolder)(e)?r[r.length-2]+"/":r[r.length-1]},t.cleanPath=e=>e.replace(/\/+/g,"/").split("/").map(encodeURIComponent).join("/").replace(/'/g,"%27"),t.bindAll=e=>{for(const t in this)"function"==typeof e[t]&&(e[t]=e[t].bind(e))},t.equal=(e,r,o=[])=>{let s;if(typeof e!=typeof r)return!1;if("number"==typeof e||"boolean"==typeof e||"string"==typeof e)return e===r;if("function"==typeof e)return e.toString()===r.toString();if(e instanceof ArrayBuffer&&r instanceof ArrayBuffer&&(e=new Uint8Array(e),r=new Uint8Array(r)),e instanceof Array){if(e.length!==r.length)return!1;for(let s=0,n=e.length;s<n;s++)if(!(0,t.equal)(e[s],r[s],o))return!1}else{for(s in e)if(e.hasOwnProperty(s)&&!(s in r))return!1;for(s in r){if(!r.hasOwnProperty(s))continue;if(!(s in e))return!1;let n;if("object"==typeof r[s]){if(o.indexOf(r[s])>=0)continue;n=o.slice(),n.push(r[s])}if(!(0,t.equal)(e[s],r[s],n))return!1}}return!0},t.deepClone=e=>{if(void 0!==e){const t=JSON.parse(JSON.stringify(e));return s(e,t),t}},t.pathsFromRoot=e=>{const t=[e],r=e.replace(/\/$/,"").split("/");for(;r.length>1;)r.pop(),t.push(r.join("/")+"/");return t},t.localStorageAvailable=()=>{const e=(0,t.getGlobalContext)();if(!("localStorage"in e))return!1;try{return e.localStorage.setItem("rs-check","1"),e.localStorage.removeItem("rs-check"),!0}catch(e){return!1}},t.getJSONFromLocalStorage=e=>{const r=(0,t.getGlobalContext)();try{return JSON.parse(r.localStorage.getItem(e))}catch(e){}},t.shouldBeTreatedAsBinary=(e,t)=>!!(t&&t.match(/charset=binary/)||/[\x00-\x08\x0E-\x1F\uFFFD]/.test(e)),t.getTextFromArrayBuffer=(e,r)=>new Promise((o=>{if("undefined"==typeof Blob||"undefined"==typeof FileReader){const t=Buffer.from(e);o(t.toString(r))}else{let s;const n=t.globalContext;if(n.BlobBuilder=n.BlobBuilder||n.WebKitBlobBuilder,void 0!==n.BlobBuilder){const t=new n.BlobBuilder;t.append(e),s=t.getBlob()}else s=new Blob([e]);const i=new FileReader;"function"==typeof i.addEventListener?i.addEventListener("loadend",(function(e){o(e.target.result)})):i.onloadend=function(e){o(e.target.result)},i.readAsText(s,r)}})),t.toBase64=e=>{const r=(0,t.getGlobalContext)();return"btoa"in r?r.btoa(e):Buffer.from(e).toString("base64")}},600:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const n=s(r(275)),i=s(r(93)),a=s(r(503)),c=s(r(334)),l=r(746),u=r(368),h=r(684);let d;const f="remotestorage:wireclient",p={"draft-dejong-remotestorage-00":2,"draft-dejong-remotestorage-01":3,"draft-dejong-remotestorage-02":4,"https://www.w3.org/community/rww/wiki/read-write-web-00#simple":1};class m extends h.RemoteBase{constructor(e){if(super(e),this._revisionCache={},d=(0,l.localStorageAvailable)(),this.addEvents(["connected","not-connected"]),d){const e=function(){const e=(0,l.getJSONFromLocalStorage)(f)||{},{userAddress:t,href:r,storageApi:o,token:s,properties:n}=e;return{userAddress:t,href:r,storageApi:o,token:s,properties:n}}();e&&setTimeout((()=>{this.configure(e)}),0)}this.connected&&setTimeout(this._emit.bind(this),0,"connected")}get storageType(){if(this.storageApi){const e=this.storageApi.match(/draft-dejong-(remotestorage-\d\d)/);return e?e[1]:"2012.04"}}_request(e,t,r,s,i,h,d){return o(this,void 0,void 0,(function*(){if(this.isForbiddenRequestMethod(e,t))return Promise.reject(`Don't use ${e} on directories!`);let o;return r!==n.default.IMPLIED_FAKE_TOKEN&&(s.Authorization="Bearer "+r),this.rs._emit("wire-busy",{method:e,isFolder:(0,l.isFolder)(t)}),(0,u.requestWithTimeout)(e,t,{body:i,headers:s,responseType:"arraybuffer"}).then((r=>{if(this.online||(this.online=!0,this.rs._emit("network-online")),this.rs._emit("wire-done",{method:e,isFolder:(0,l.isFolder)(t),success:!0}),s=r.status,[401,403,404,412].indexOf(s)>=0)return(0,c.default)("[WireClient] Error response status",r.status),o=h?this.stripQuotes(r.getResponseHeader("ETag")):void 0,401===r.status&&this.rs._emit("error",new a.default),Promise.resolve({statusCode:r.status,revision:o});if(function(e){return[201,204,304].indexOf(e)>=0}(r.status)||200===r.status&&"GET"!==e)return o=this.stripQuotes(r.getResponseHeader("ETag")),(0,c.default)("[WireClient] Successful request",o),Promise.resolve({statusCode:r.status,revision:o});{const e=r.getResponseHeader("Content-Type");o=h?this.stripQuotes(r.getResponseHeader("ETag")):200===r.status?d:void 0;const t=function(e){let t,r="utf-8";return e&&(t=e.match(/charset=(.+)$/),t&&(r=t[1])),r}(e);return(0,l.shouldBeTreatedAsBinary)(r.response,e)?((0,c.default)("[WireClient] Successful request with unknown or binary mime-type",o),Promise.resolve({statusCode:r.status,body:r.response,contentType:e,revision:o})):(0,l.getTextFromArrayBuffer)(r.response,t).then((t=>((0,c.default)("[WireClient] Successful request",o),Promise.resolve({statusCode:r.status,body:t,contentType:e,revision:o}))))}var s}),(r=>(this.online&&(this.online=!1,this.rs._emit("network-offline")),this.rs._emit("wire-done",{method:e,isFolder:(0,l.isFolder)(t),success:!1}),Promise.reject(r))))}))}configure(e){if("object"!=typeof e)throw new Error("WireClient configure settings parameter should be an object");if(void 0!==e.userAddress&&(this.userAddress=e.userAddress),void 0!==e.href&&(this.href=e.href),void 0!==e.storageApi&&(this.storageApi=e.storageApi),void 0!==e.token&&(this.token=e.token),void 0!==e.properties&&(this.properties=e.properties),"string"==typeof this.storageApi){const e=p[this.storageApi]||5;this.supportsRevs=e>=2}this.href&&this.token?(this.connected=!0,this.online=!0,this._emit("connected")):this.connected=!1,d&&localStorage.setItem(f,JSON.stringify({userAddress:this.userAddress,href:this.href,storageApi:this.storageApi,token:this.token,properties:this.properties}))}get(e,t={}){if(!this.connected)return Promise.reject("not connected (path: "+e+")");const r={};return this.supportsRevs&&t.ifNoneMatch&&(r["If-None-Match"]=this.addQuotes(t.ifNoneMatch)),this._request("GET",this.href+(0,l.cleanPath)(e),this.token,r,void 0,this.supportsRevs,this._revisionCache[e]).then((t=>{if(!(0,l.isFolder)(e))return Promise.resolve(t);let r={};if(void 0!==t.body)try{t.body=JSON.parse(t.body)}catch(t){return Promise.reject("Folder description at "+this.href+(0,l.cleanPath)(e)+" is not JSON")}if(200===t.statusCode&&"object"==typeof t.body){if(0===Object.keys(t.body).length)t.statusCode=404;else if("http://remotestorage.io/spec/folder-description"===(o=t.body)["@context"]&&"object"==typeof o.items){for(const r in t.body.items)this._revisionCache[e+r]=t.body.items[r].ETag;r=t.body.items}else Object.keys(t.body).forEach((o=>{this._revisionCache[e+o]=t.body[o],r[o]={ETag:t.body[o]}}));return t.body=r,Promise.resolve(t)}return Promise.resolve(t);var o}))}put(e,t,r,o={}){if(!this.connected)return Promise.reject("not connected (path: "+e+")");!r.match(/charset=/)&&(t instanceof ArrayBuffer||(0,u.isArrayBufferView)(t))&&(r+="; charset=binary");const s={"Content-Type":r};return this.supportsRevs&&(o.ifMatch&&(s["If-Match"]=this.addQuotes(o.ifMatch)),o.ifNoneMatch&&(s["If-None-Match"]=this.addQuotes(o.ifNoneMatch))),this._request("PUT",this.href+(0,l.cleanPath)(e),this.token,s,t,this.supportsRevs)}delete(e,t={}){if(!this.connected)throw new Error("not connected (path: "+e+")");t||(t={});const r={};return this.supportsRevs&&t.ifMatch&&(r["If-Match"]=this.addQuotes(t.ifMatch)),this._request("DELETE",this.href+(0,l.cleanPath)(e),this.token,r,void 0,this.supportsRevs)}static _rs_init(e){e.remote=new m(e),e.remote.online=!0}static _rs_supported(){return"function"==typeof fetch||"function"==typeof XMLHttpRequest}static _rs_cleanup(){d&&delete localStorage[f]}}(0,l.applyMixins)(m,[i.default]),e.exports=m},439:function(e,t){var r,o;r=function(){var e,t,r,o;Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),o=(r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(s){if("object"!=typeof s&&"function"!=typeof s||null===s)throw new TypeError("Object.keys called on non-object");var n=[];for(var i in s)e.call(s,i)&&n.push(i);if(t)for(var a=0;a<o;a++)e.call(s,r[a])&&n.push(r[a]);return n})),Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var t=Object(this),r=t.length>>>0;if(0===r)return-1;var o=0;if(arguments.length>1&&((o=Number(arguments[1]))!=o?o=0:0!==o&&o!==1/0&&o!==-1/0&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=r)return-1;for(var s=o>=0?o:Math.max(r-Math.abs(o),0);s<r;s++)if(s in t&&t[s]===e)return s;return-1}),Object.isFrozen||(Object.isFrozen=function(e){for(var t="tv4_test_frozen_key";e.hasOwnProperty(t);)t+=Math.random();try{return e[t]=!0,delete e[t],!1}catch(e){return!0}});var s={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},n={"*":!0};function i(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,(function(e){return"%"+e.substring(3)}))}function a(e){var t="";s[e.charAt(0)]&&(t=e.charAt(0),e=e.substring(1));var r="",o="",a=!0,c=!1,l=!1;"+"===t?a=!1:"."===t?(o=".",r="."):"/"===t?(o="/",r="/"):"#"===t?(o="#",a=!1):";"===t?(o=";",r=";",c=!0,l=!0):"?"===t?(o="?",r="&",c=!0):"&"===t&&(o="&",r="&",c=!0);for(var u=[],h=e.split(","),d=[],f={},p=0;p<h.length;p++){var m=h[p],g=null;if(-1!==m.indexOf(":")){var y=m.split(":");m=y[0],g=parseInt(y[1],10)}for(var v={};n[m.charAt(m.length-1)];)v[m.charAt(m.length-1)]=!0,m=m.substring(0,m.length-1);var _={truncate:g,name:m,suffices:v};d.push(_),f[m]=_,u.push(m)}var b=function(e){for(var t="",s=0,n=0;n<d.length;n++){var u=d[n],h=e(u.name);if(null==h||Array.isArray(h)&&0===h.length||"object"==typeof h&&0===Object.keys(h).length)s++;else if(t+=n===s?o:r||",",Array.isArray(h)){c&&(t+=u.name+"=");for(var f=0;f<h.length;f++)f>0&&(t+=u.suffices["*"]&&r||",",u.suffices["*"]&&c&&(t+=u.name+"=")),t+=a?encodeURIComponent(h[f]).replace(/!/g,"%21"):i(h[f])}else if("object"==typeof h){c&&!u.suffices["*"]&&(t+=u.name+"=");var p=!0;for(var m in h)p||(t+=u.suffices["*"]&&r||","),p=!1,t+=a?encodeURIComponent(m).replace(/!/g,"%21"):i(m),t+=u.suffices["*"]?"=":",",t+=a?encodeURIComponent(h[m]).replace(/!/g,"%21"):i(h[m])}else c&&(t+=u.name,l&&""===h||(t+="=")),null!=u.truncate&&(h=h.substring(0,u.truncate)),t+=a?encodeURIComponent(h).replace(/!/g,"%21"):i(h)}return t};return b.varNames=u,{prefix:o,substitution:b}}function c(e){if(!(this instanceof c))return new c(e);for(var t=e.split("{"),r=[t.shift()],o=[],s=[],n=[];t.length>0;){var i=t.shift(),l=i.split("}")[0],u=i.substring(l.length+1),h=a(l);s.push(h.substitution),o.push(h.prefix),r.push(u),n=n.concat(h.substitution.varNames)}this.fill=function(e){for(var t=r[0],o=0;o<s.length;o++)t+=(0,s[o])(e),t+=r[o+1];return t},this.varNames=n,this.template=e}c.prototype={toString:function(){return this.template},fillFromObject:function(e){return this.fill((function(t){return e[t]}))}};var l=function(e,t,r,o,s){if(this.missing=[],this.missingMap={},this.formatValidators=e?Object.create(e.formatValidators):{},this.schemas=e?Object.create(e.schemas):{},this.collectMultiple=t,this.errors=[],this.handleError=t?this.collectError:this.returnError,o&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),s&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=r||y("en"),"string"==typeof this.errorReporter)throw new Error("debug");if(this.definedKeywords={},e)for(var n in e.definedKeywords)this.definedKeywords[n]=e.definedKeywords[n].slice(0)};function u(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!u(e[r],t[r]))return!1}else{var o;for(o in e)if(void 0===t[o]&&void 0!==e[o])return!1;for(o in t)if(void 0===e[o]&&void 0!==t[o])return!1;for(o in e)if(!u(e[o],t[o]))return!1}return!0}return!1}l.prototype.defineKeyword=function(e,t){this.definedKeywords[e]=this.definedKeywords[e]||[],this.definedKeywords[e].push(t)},l.prototype.createError=function(e,t,r,o,s,n,i){var a=new P(e,t,r,o,s);return a.message=this.errorReporter(a,n,i),a},l.prototype.returnError=function(e){return e},l.prototype.collectError=function(e){return e&&this.errors.push(e),null},l.prototype.prefixErrors=function(e,t,r){for(var o=e;o<this.errors.length;o++)this.errors[o]=this.errors[o].prefixWith(t,r);return this},l.prototype.banUnknownProperties=function(e,t){for(var r in this.unknownPropertyPaths){var o=this.createError(v.UNKNOWN_PROPERTY,{path:r},r,"",null,e,t),s=this.handleError(o);if(s)return s}return null},l.prototype.addFormat=function(e,t){if("object"==typeof e){for(var r in e)this.addFormat(r,e[r]);return this}this.formatValidators[e]=t},l.prototype.resolveRefs=function(e,t){if(void 0!==e.$ref){if((t=t||{})[e.$ref])return this.createError(v.CIRCULAR_REFERENCE,{urls:Object.keys(t).join(", ")},"","",null,void 0,e);t[e.$ref]=!0,e=this.getSchema(e.$ref,t)}return e},l.prototype.getSchema=function(e,t){var r;if(void 0!==this.schemas[e])return r=this.schemas[e],this.resolveRefs(r,t);var o=e,s="";if(-1!==e.indexOf("#")&&(s=e.substring(e.indexOf("#")+1),o=e.substring(0,e.indexOf("#"))),"object"==typeof this.schemas[o]){r=this.schemas[o];var n=decodeURIComponent(s);if(""===n)return this.resolveRefs(r,t);if("/"!==n.charAt(0))return;for(var i=n.split("/").slice(1),a=0;a<i.length;a++){var c=i[a].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===r[c]){r=void 0;break}r=r[c]}if(void 0!==r)return this.resolveRefs(r,t)}void 0===this.missing[o]&&(this.missing.push(o),this.missing[o]=o,this.missingMap[o]=o)},l.prototype.searchSchemas=function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)this.searchSchemas(e[r],t);else if(e&&"object"==typeof e)for(var o in"string"==typeof e.id&&function(e,t){if(t.substring(0,e.length)===e){var r=t.substring(e.length);if(t.length>0&&"/"===t.charAt(e.length-1)||"#"===r.charAt(0)||"?"===r.charAt(0))return!0}return!1}(t,e.id)&&void 0===this.schemas[e.id]&&(this.schemas[e.id]=e),e)if("enum"!==o)if("object"==typeof e[o])this.searchSchemas(e[o],t);else if("$ref"===o){var s=m(e[o]);s&&void 0===this.schemas[s]&&void 0===this.missingMap[s]&&(this.missingMap[s]=s)}},l.prototype.addSchema=function(e,t){if("string"!=typeof e||void 0===t){if("object"!=typeof e||"string"!=typeof e.id)return;e=(t=e).id}e===m(e)+"#"&&(e=m(e)),this.schemas[e]=t,delete this.missingMap[e],g(t,e),this.searchSchemas(t,e)},l.prototype.getSchemaMap=function(){var e={};for(var t in this.schemas)e[t]=this.schemas[t];return e},l.prototype.getSchemaUris=function(e){var t=[];for(var r in this.schemas)e&&!e.test(r)||t.push(r);return t},l.prototype.getMissingUris=function(e){var t=[];for(var r in this.missingMap)e&&!e.test(r)||t.push(r);return t},l.prototype.dropSchemas=function(){this.schemas={},this.reset()},l.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},l.prototype.validateAll=function(e,t,r,o,s){var n;if(!(t=this.resolveRefs(t)))return null;if(t instanceof P)return this.errors.push(t),t;var i,a=this.errors.length,c=null,l=null;if(this.checkRecursive&&e&&"object"==typeof e){if(n=!this.scanned.length,e[this.validatedSchemasKey]){var u=e[this.validatedSchemasKey].indexOf(t);if(-1!==u)return this.errors=this.errors.concat(e[this.validationErrorsKey][u]),null}if(Object.isFrozen(e)&&-1!==(i=this.scannedFrozen.indexOf(e))){var h=this.scannedFrozenSchemas[i].indexOf(t);if(-1!==h)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[i][h]),null}if(this.scanned.push(e),Object.isFrozen(e))-1===i&&(i=this.scannedFrozen.length,this.scannedFrozen.push(e),this.scannedFrozenSchemas.push([])),c=this.scannedFrozenSchemas[i].length,this.scannedFrozenSchemas[i][c]=t,this.scannedFrozenValidationErrors[i][c]=[];else{if(!e[this.validatedSchemasKey])try{Object.defineProperty(e,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(e,this.validationErrorsKey,{value:[],configurable:!0})}catch(t){e[this.validatedSchemasKey]=[],e[this.validationErrorsKey]=[]}l=e[this.validatedSchemasKey].length,e[this.validatedSchemasKey][l]=t,e[this.validationErrorsKey][l]=[]}}var d=this.errors.length,f=this.validateBasic(e,t,s)||this.validateNumeric(e,t,s)||this.validateString(e,t,s)||this.validateArray(e,t,s)||this.validateObject(e,t,s)||this.validateCombinations(e,t,s)||this.validateHypermedia(e,t,s)||this.validateFormat(e,t,s)||this.validateDefinedKeywords(e,t,s)||null;if(n){for(;this.scanned.length;)delete this.scanned.pop()[this.validatedSchemasKey];this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(f||d!==this.errors.length)for(;r&&r.length||o&&o.length;){var p=r&&r.length?""+r.pop():null,m=o&&o.length?""+o.pop():null;f&&(f=f.prefixWith(p,m)),this.prefixErrors(d,p,m)}return null!==c?this.scannedFrozenValidationErrors[i][c]=this.errors.slice(a):null!==l&&(e[this.validationErrorsKey][l]=this.errors.slice(a)),this.handleError(f)},l.prototype.validateFormat=function(e,t){if("string"!=typeof t.format||!this.formatValidators[t.format])return null;var r=this.formatValidators[t.format].call(null,e,t);return"string"==typeof r||"number"==typeof r?this.createError(v.FORMAT_CUSTOM,{message:r},"","/format",null,e,t):r&&"object"==typeof r?this.createError(v.FORMAT_CUSTOM,{message:r.message||"?"},r.dataPath||"",r.schemaPath||"/format",null,e,t):null},l.prototype.validateDefinedKeywords=function(e,t,r){for(var o in this.definedKeywords)if(void 0!==t[o])for(var s=this.definedKeywords[o],n=0;n<s.length;n++){var i=(0,s[n])(e,t[o],t,r);if("string"==typeof i||"number"==typeof i)return this.createError(v.KEYWORD_CUSTOM,{key:o,message:i},"","",null,e,t).prefixWith(null,o);if(i&&"object"==typeof i){var a=i.code;if("string"==typeof a){if(!v[a])throw new Error("Undefined error code (use defineError): "+a);a=v[a]}else"number"!=typeof a&&(a=v.KEYWORD_CUSTOM);var c="object"==typeof i.message?i.message:{key:o,message:i.message||"?"},l=i.schemaPath||"/"+o.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(a,c,i.dataPath||null,l,null,e,t)}}return null},l.prototype.validateBasic=function(e,t,r){var o;return(o=this.validateType(e,t,r))||(o=this.validateEnum(e,t,r))?o.prefixWith(null,"type"):null},l.prototype.validateType=function(e,t){if(void 0===t.type)return null;var r=typeof e;null===e?r="null":Array.isArray(e)&&(r="array");var o=t.type;Array.isArray(o)||(o=[o]);for(var s=0;s<o.length;s++){var n=o[s];if(n===r||"integer"===n&&"number"===r&&e%1==0)return null}return this.createError(v.INVALID_TYPE,{type:r,expected:o.join("/")},"","",null,e,t)},l.prototype.validateEnum=function(e,t){if(void 0===t.enum)return null;for(var r=0;r<t.enum.length;r++)if(u(e,t.enum[r]))return null;return this.createError(v.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(e):e},"","",null,e,t)},l.prototype.validateNumeric=function(e,t,r){return this.validateMultipleOf(e,t,r)||this.validateMinMax(e,t,r)||this.validateNaN(e,t,r)||null};var h=Math.pow(2,-51),d=1-h;function f(e){var t=String(e).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return t?{href:t[0]||"",protocol:t[1]||"",authority:t[2]||"",host:t[3]||"",hostname:t[4]||"",port:t[5]||"",pathname:t[6]||"",search:t[7]||"",hash:t[8]||""}:null}function p(e,t){return t=f(t||""),e=f(e||""),t&&e?(t.protocol||e.protocol)+(t.protocol||t.authority?t.authority:e.authority)+(r=t.protocol||t.authority||"/"===t.pathname.charAt(0)?t.pathname:t.pathname?(e.authority&&!e.pathname?"/":"")+e.pathname.slice(0,e.pathname.lastIndexOf("/")+1)+t.pathname:e.pathname,o=[],r.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,(function(e){"/.."===e?o.pop():o.push(e)})),o.join("").replace(/^\//,"/"===r.charAt(0)?"/":""))+(t.protocol||t.authority||t.pathname?t.search:t.search||e.search)+t.hash:null;var r,o}function m(e){return e.split("#")[0]}function g(e,t){if(e&&"object"==typeof e)if(void 0===t?t=e.id:"string"==typeof e.id&&(t=p(t,e.id),e.id=t),Array.isArray(e))for(var r=0;r<e.length;r++)g(e[r],t);else for(var o in"string"==typeof e.$ref&&(e.$ref=p(t,e.$ref)),e)"enum"!==o&&g(e[o],t)}function y(e){var t=T[e=e||"en"];return function(e){var r=t[e.code]||w[e.code];if("string"!=typeof r)return"Unknown error code "+e.code+": "+JSON.stringify(e.messageParams);var o=e.params;return r.replace(/\{([^{}]*)\}/g,(function(e,t){var r=o[t];return"string"==typeof r||"number"==typeof r?r:e}))}}l.prototype.validateMultipleOf=function(e,t){var r=t.multipleOf||t.divisibleBy;if(void 0===r)return null;if("number"==typeof e){var o=e/r%1;if(o>=h&&o<d)return this.createError(v.NUMBER_MULTIPLE_OF,{value:e,multipleOf:r},"","",null,e,t)}return null},l.prototype.validateMinMax=function(e,t){if("number"!=typeof e)return null;if(void 0!==t.minimum){if(e<t.minimum)return this.createError(v.NUMBER_MINIMUM,{value:e,minimum:t.minimum},"","/minimum",null,e,t);if(t.exclusiveMinimum&&e===t.minimum)return this.createError(v.NUMBER_MINIMUM_EXCLUSIVE,{value:e,minimum:t.minimum},"","/exclusiveMinimum",null,e,t)}if(void 0!==t.maximum){if(e>t.maximum)return this.createError(v.NUMBER_MAXIMUM,{value:e,maximum:t.maximum},"","/maximum",null,e,t);if(t.exclusiveMaximum&&e===t.maximum)return this.createError(v.NUMBER_MAXIMUM_EXCLUSIVE,{value:e,maximum:t.maximum},"","/exclusiveMaximum",null,e,t)}return null},l.prototype.validateNaN=function(e,t){return"number"!=typeof e?null:!0===isNaN(e)||e===1/0||e===-1/0?this.createError(v.NUMBER_NOT_A_NUMBER,{value:e},"","/type",null,e,t):null},l.prototype.validateString=function(e,t,r){return this.validateStringLength(e,t,r)||this.validateStringPattern(e,t,r)||null},l.prototype.validateStringLength=function(e,t){return"string"!=typeof e?null:void 0!==t.minLength&&e.length<t.minLength?this.createError(v.STRING_LENGTH_SHORT,{length:e.length,minimum:t.minLength},"","/minLength",null,e,t):void 0!==t.maxLength&&e.length>t.maxLength?this.createError(v.STRING_LENGTH_LONG,{length:e.length,maximum:t.maxLength},"","/maxLength",null,e,t):null},l.prototype.validateStringPattern=function(e,t){if("string"!=typeof e||"string"!=typeof t.pattern&&!(t.pattern instanceof RegExp))return null;var r;if(t.pattern instanceof RegExp)r=t.pattern;else{var o,s="",n=t.pattern.match(/^\/(.+)\/([img]*)$/);n?(o=n[1],s=n[2]):o=t.pattern,r=new RegExp(o,s)}return r.test(e)?null:this.createError(v.STRING_PATTERN,{pattern:t.pattern},"","/pattern",null,e,t)},l.prototype.validateArray=function(e,t,r){return Array.isArray(e)&&(this.validateArrayLength(e,t,r)||this.validateArrayUniqueItems(e,t,r)||this.validateArrayItems(e,t,r))||null},l.prototype.validateArrayLength=function(e,t){var r;return void 0!==t.minItems&&e.length<t.minItems&&(r=this.createError(v.ARRAY_LENGTH_SHORT,{length:e.length,minimum:t.minItems},"","/minItems",null,e,t),this.handleError(r))||void 0!==t.maxItems&&e.length>t.maxItems&&(r=this.createError(v.ARRAY_LENGTH_LONG,{length:e.length,maximum:t.maxItems},"","/maxItems",null,e,t),this.handleError(r))?r:null},l.prototype.validateArrayUniqueItems=function(e,t){if(t.uniqueItems)for(var r=0;r<e.length;r++)for(var o=r+1;o<e.length;o++)if(u(e[r],e[o])){var s=this.createError(v.ARRAY_UNIQUE,{match1:r,match2:o},"","/uniqueItems",null,e,t);if(this.handleError(s))return s}return null},l.prototype.validateArrayItems=function(e,t,r){if(void 0===t.items)return null;var o,s;if(Array.isArray(t.items)){for(s=0;s<e.length;s++)if(s<t.items.length){if(o=this.validateAll(e[s],t.items[s],[s],["items",s],r+"/"+s))return o}else if(void 0!==t.additionalItems)if("boolean"==typeof t.additionalItems){if(!t.additionalItems&&(o=this.createError(v.ARRAY_ADDITIONAL_ITEMS,{},"/"+s,"/additionalItems",null,e,t),this.handleError(o)))return o}else if(o=this.validateAll(e[s],t.additionalItems,[s],["additionalItems"],r+"/"+s))return o}else for(s=0;s<e.length;s++)if(o=this.validateAll(e[s],t.items,[s],["items"],r+"/"+s))return o;return null},l.prototype.validateObject=function(e,t,r){return"object"!=typeof e||null===e||Array.isArray(e)?null:this.validateObjectMinMaxProperties(e,t,r)||this.validateObjectRequiredProperties(e,t,r)||this.validateObjectProperties(e,t,r)||this.validateObjectDependencies(e,t,r)||null},l.prototype.validateObjectMinMaxProperties=function(e,t){var r,o=Object.keys(e);return void 0!==t.minProperties&&o.length<t.minProperties&&(r=this.createError(v.OBJECT_PROPERTIES_MINIMUM,{propertyCount:o.length,minimum:t.minProperties},"","/minProperties",null,e,t),this.handleError(r))||void 0!==t.maxProperties&&o.length>t.maxProperties&&(r=this.createError(v.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:o.length,maximum:t.maxProperties},"","/maxProperties",null,e,t),this.handleError(r))?r:null},l.prototype.validateObjectRequiredProperties=function(e,t){if(void 0!==t.required)for(var r=0;r<t.required.length;r++){var o=t.required[r];if(void 0===e[o]){var s=this.createError(v.OBJECT_REQUIRED,{key:o},"","/required/"+r,null,e,t);if(this.handleError(s))return s}}return null},l.prototype.validateObjectProperties=function(e,t,r){var o;for(var s in e){var n=r+"/"+s.replace(/~/g,"~0").replace(/\//g,"~1"),i=!1;if(void 0!==t.properties&&void 0!==t.properties[s]&&(i=!0,o=this.validateAll(e[s],t.properties[s],[s],["properties",s],n)))return o;if(void 0!==t.patternProperties)for(var a in t.patternProperties)if(new RegExp(a).test(s)&&(i=!0,o=this.validateAll(e[s],t.patternProperties[a],[s],["patternProperties",a],n)))return o;if(i)this.trackUnknownProperties&&(this.knownPropertyPaths[n]=!0,delete this.unknownPropertyPaths[n]);else if(void 0!==t.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[n]=!0,delete this.unknownPropertyPaths[n]),"boolean"==typeof t.additionalProperties){if(!t.additionalProperties&&(o=this.createError(v.OBJECT_ADDITIONAL_PROPERTIES,{key:s},"","/additionalProperties",null,e,t).prefixWith(s,null),this.handleError(o)))return o}else if(o=this.validateAll(e[s],t.additionalProperties,[s],["additionalProperties"],n))return o}else this.trackUnknownProperties&&!this.knownPropertyPaths[n]&&(this.unknownPropertyPaths[n]=!0)}return null},l.prototype.validateObjectDependencies=function(e,t,r){var o;if(void 0!==t.dependencies)for(var s in t.dependencies)if(void 0!==e[s]){var n=t.dependencies[s];if("string"==typeof n){if(void 0===e[n]&&(o=this.createError(v.OBJECT_DEPENDENCY_KEY,{key:s,missing:n},"","",null,e,t).prefixWith(null,s).prefixWith(null,"dependencies"),this.handleError(o)))return o}else if(Array.isArray(n))for(var i=0;i<n.length;i++){var a=n[i];if(void 0===e[a]&&(o=this.createError(v.OBJECT_DEPENDENCY_KEY,{key:s,missing:a},"","/"+i,null,e,t).prefixWith(null,s).prefixWith(null,"dependencies"),this.handleError(o)))return o}else if(o=this.validateAll(e,n,[],["dependencies",s],r))return o}return null},l.prototype.validateCombinations=function(e,t,r){return this.validateAllOf(e,t,r)||this.validateAnyOf(e,t,r)||this.validateOneOf(e,t,r)||this.validateNot(e,t,r)||null},l.prototype.validateAllOf=function(e,t,r){if(void 0===t.allOf)return null;for(var o,s=0;s<t.allOf.length;s++){var n=t.allOf[s];if(o=this.validateAll(e,n,[],["allOf",s],r))return o}return null},l.prototype.validateAnyOf=function(e,t,r){if(void 0===t.anyOf)return null;var o,s,n=[],i=this.errors.length;this.trackUnknownProperties&&(o=this.unknownPropertyPaths,s=this.knownPropertyPaths);for(var a=!0,c=0;c<t.anyOf.length;c++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var l=t.anyOf[c],u=this.errors.length,h=this.validateAll(e,l,[],["anyOf",c],r);if(null===h&&u===this.errors.length){if(this.errors=this.errors.slice(0,i),this.trackUnknownProperties){for(var d in this.knownPropertyPaths)s[d]=!0,delete o[d];for(var f in this.unknownPropertyPaths)s[f]||(o[f]=!0);a=!1;continue}return null}h&&n.push(h.prefixWith(null,""+c).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=o,this.knownPropertyPaths=s),a?(n=n.concat(this.errors.slice(i)),this.errors=this.errors.slice(0,i),this.createError(v.ANY_OF_MISSING,{},"","/anyOf",n,e,t)):void 0},l.prototype.validateOneOf=function(e,t,r){if(void 0===t.oneOf)return null;var o,s,n=null,i=[],a=this.errors.length;this.trackUnknownProperties&&(o=this.unknownPropertyPaths,s=this.knownPropertyPaths);for(var c=0;c<t.oneOf.length;c++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var l=t.oneOf[c],u=this.errors.length,h=this.validateAll(e,l,[],["oneOf",c],r);if(null===h&&u===this.errors.length){if(null!==n)return this.errors=this.errors.slice(0,a),this.createError(v.ONE_OF_MULTIPLE,{index1:n,index2:c},"","/oneOf",null,e,t);if(n=c,this.trackUnknownProperties){for(var d in this.knownPropertyPaths)s[d]=!0,delete o[d];for(var f in this.unknownPropertyPaths)s[f]||(o[f]=!0)}}else h&&i.push(h)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=o,this.knownPropertyPaths=s),null===n?(i=i.concat(this.errors.slice(a)),this.errors=this.errors.slice(0,a),this.createError(v.ONE_OF_MISSING,{},"","/oneOf",i,e,t)):(this.errors=this.errors.slice(0,a),null)},l.prototype.validateNot=function(e,t,r){if(void 0===t.not)return null;var o,s,n=this.errors.length;this.trackUnknownProperties&&(o=this.unknownPropertyPaths,s=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var i=this.validateAll(e,t.not,null,null,r),a=this.errors.slice(n);return this.errors=this.errors.slice(0,n),this.trackUnknownProperties&&(this.unknownPropertyPaths=o,this.knownPropertyPaths=s),null===i&&0===a.length?this.createError(v.NOT_PASSED,{},"","/not",null,e,t):null},l.prototype.validateHypermedia=function(e,t,r){if(!t.links)return null;for(var o,s=0;s<t.links.length;s++){var n=t.links[s];if("describedby"===n.rel){for(var i=new c(n.href),a=!0,l=0;l<i.varNames.length;l++)if(!(i.varNames[l]in e)){a=!1;break}if(a){var u={$ref:i.fillFromObject(e)};if(o=this.validateAll(e,u,[],["links",s],r))return o}}}};var v={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},_={};for(var b in v)_[v[b]]=b;var w={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};function P(e,t,r,o,s){if(Error.call(this),void 0===e)throw new Error("No error code supplied: "+o);this.message="",this.params=t,this.code=e,this.dataPath=r||"",this.schemaPath=o||"",this.subErrors=s||null;var n=new Error(this.message);if(this.stack=n.stack||n.stacktrace,!this.stack)try{throw n}catch(n){this.stack=n.stack||n.stacktrace}}P.prototype=Object.create(Error.prototype),P.prototype.constructor=P,P.prototype.name="ValidationError",P.prototype.prefixWith=function(e,t){if(null!==e&&(e=e.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+e+this.dataPath),null!==t&&(t=t.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+t+this.schemaPath),null!==this.subErrors)for(var r=0;r<this.subErrors.length;r++)this.subErrors[r].prefixWith(e,t);return this};var T={};var E=function e(t){var r,o,s=new l,n={setErrorReporter:function(e){return"string"==typeof e?this.language(e):(o=e,!0)},addFormat:function(){s.addFormat.apply(s,arguments)},language:function(e){return e?(T[e]||(e=e.split("-")[0]),!!T[e]&&(r=e,e)):r},addLanguage:function(e,t){var r;for(r in v)t[r]&&!t[v[r]]&&(t[v[r]]=t[r]);var o=e.split("-")[0];if(T[o])for(r in T[e]=Object.create(T[o]),t)void 0===T[o][r]&&(T[o][r]=t[r]),T[e][r]=t[r];else T[e]=t,T[o]=t;return this},freshApi:function(t){var r=e();return t&&r.language(t),r},validate:function(e,t,n,i){var a=y(r),c=o?function(e,t,r){return o(e,t,r)||a(e,t,r)}:a,u=new l(s,!1,c,n,i);"string"==typeof t&&(t={$ref:t}),u.addSchema("",t);var h=u.validateAll(e,t,null,null,"");return!h&&i&&(h=u.banUnknownProperties(e,t)),this.error=h,this.missing=u.missing,this.valid=null===h,this.valid},validateResult:function(){var e={toString:function(){return this.valid?"valid":this.error.message}};return this.validate.apply(e,arguments),e},validateMultiple:function(e,t,n,i){var a=y(r),c=o?function(e,t,r){return o(e,t,r)||a(e,t,r)}:a,u=new l(s,!0,c,n,i);"string"==typeof t&&(t={$ref:t}),u.addSchema("",t),u.validateAll(e,t,null,null,""),i&&u.banUnknownProperties(e,t);var h={toString:function(){return this.valid?"valid":this.error.message}};return h.errors=u.errors,h.missing=u.missing,h.valid=0===h.errors.length,h},addSchema:function(){return s.addSchema.apply(s,arguments)},getSchema:function(){return s.getSchema.apply(s,arguments)},getSchemaMap:function(){return s.getSchemaMap.apply(s,arguments)},getSchemaUris:function(){return s.getSchemaUris.apply(s,arguments)},getMissingUris:function(){return s.getMissingUris.apply(s,arguments)},dropSchemas:function(){s.dropSchemas.apply(s,arguments)},defineKeyword:function(){s.defineKeyword.apply(s,arguments)},defineError:function(e,t,r){if("string"!=typeof e||!/^[A-Z]+(_[A-Z]+)*$/.test(e))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof t||t%1!=0||t<1e4)throw new Error("Code number must be an integer > 10000");if(void 0!==v[e])throw new Error("Error already defined: "+e+" as "+v[e]);if(void 0!==_[t])throw new Error("Error code already used: "+_[t]+" as "+t);for(var o in v[e]=t,_[t]=e,w[e]=w[t]=r,T){var s=T[o];s[e]&&(s[t]=s[t]||s[e])}},reset:function(){s.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:g,resolveUrl:p,getDocumentUri:m,errorCodes:v};return n.language(t||"en"),n}();return E.addLanguage("en-gb",w),E.tv4=E,E},void 0===(o=r.apply(t,[]))||(e.exports=o)},199:function(e,t,r){var o;"function"!=typeof fetch&&"function"!=typeof XMLHttpRequest&&(XMLHttpRequest=r(317)),function(r){var s={"http://webfist.org/spec/rel":"webfist","http://webfinger.net/rel/avatar":"avatar",remotestorage:"remotestorage","http://tools.ietf.org/id/draft-dejong-remotestorage":"remotestorage",remoteStorage:"remotestorage","http://www.packetizer.com/rel/share":"share","http://webfinger.net/rel/profile-page":"profile",me:"profile",vcard:"vcard",blog:"blog","http://packetizer.com/rel/blog":"blog","http://schemas.google.com/g/2010#updates-from":"updates","https://camlistore.org/rel/server":"camilstore"},n={avatar:[],remotestorage:[],blog:[],vcard:[],updates:[],share:[],profile:[],webfist:[],camlistore:[]},i=["webfinger","host-meta","host-meta.json"];function a(e){return e.toString=function(){return this.message},e}function c(e){"object"!=typeof e&&(e={}),this.config={tls_only:void 0===e.tls_only||e.tls_only,webfist_fallback:void 0!==e.webfist_fallback&&e.webfist_fallback,uri_fallback:void 0!==e.uri_fallback&&e.uri_fallback,request_timeout:void 0!==e.request_timeout?e.request_timeout:1e4}}c.prototype.__fetchJRD=function(e,t,r){if("function"==typeof fetch)return this.__fetchJRD_fetch(e,t,r);if("function"==typeof XMLHttpRequest)return this.__fetchJRD_XHR(e,t,r);throw new Error("add a polyfill for fetch or XMLHttpRequest")},c.prototype.__fetchJRD_fetch=function(e,t,r){var o,s=this;"function"==typeof AbortController&&(o=new AbortController);var n=fetch(e,{headers:{Accept:"application/jrd+json, application/json"},signal:o?o.signal:void 0}).then((function(t){if(t.ok)return t.text();throw 404===t.status?a({message:"resource not found",url:e,status:t.status}):a({message:"error during request",url:e,status:t.status})}),(function(t){throw a({message:"error during request",url:e,status:void 0,err:t})})).then((function(t){if(s.__isValidJSON(t))return t;throw a({message:"invalid json",url:e,status:void 0})})),i=new Promise((function(t,r){setTimeout((function(){r(a({message:"request timed out",url:e,status:void 0})),o&&o.abort()}),s.config.request_timeout)}));Promise.race([n,i]).then((function(e){r(e)})).catch((function(e){t(e)}))},c.prototype.__fetchJRD_XHR=function(e,t,r){var o=this,s=!1,n=new XMLHttpRequest;function i(){if(!s)return s=!0,200===n.status?o.__isValidJSON(n.responseText)?r(n.responseText):t(a({message:"invalid json",url:e,status:n.status})):404===n.status?t(a({message:"resource not found",url:e,status:n.status})):n.status>=301&&n.status<=302?function(e){return"string"==typeof e&&"https"===e.split("://")[0]}(n.getResponseHeader("Location"))?c():t(a({message:"no redirect URL found",url:e,status:n.status})):t(a({message:"error during request",url:e,status:n.status}))}function c(){n.onreadystatechange=function(){4===n.readyState&&i()},n.onload=function(){i()},n.ontimeout=function(){return t(a({message:"request timed out",url:e,status:n.status}))},n.open("GET",e,!0),n.timeout=o.config.request_timeout,n.setRequestHeader("Accept","application/jrd+json, application/json"),n.send()}return c()},c.prototype.__isValidJSON=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},c.prototype.__isLocalhost=function(e){return/^localhost(\.localdomain)?(\:[0-9]+)?$/.test(e)},c.prototype.__processJRD=function(e,t,r,o){var i=JSON.parse(t);if("object"!=typeof i||"object"!=typeof i.links)return void 0!==i.error?r(a({message:i.error,request:e})):r(a({message:"unknown response from server",request:e}));var c=i.links;Array.isArray(c)||(c=[]);var l={object:i,json:t,idx:{}};l.idx.properties={name:void 0},l.idx.links=JSON.parse(JSON.stringify(n)),c.map((function(e,t){if(s.hasOwnProperty(e.rel)&&l.idx.links[s[e.rel]]){var r={};Object.keys(e).map((function(t,o){r[t]=e[t]})),l.idx.links[s[e.rel]].push(r)}}));var u=JSON.parse(t).properties;for(var h in u)u.hasOwnProperty(h)&&"http://packetizer.com/ns/name"===h&&(l.idx.properties.name=u[h]);return o(l)},c.prototype.lookup=function(e,t){if("string"!=typeof e)throw new Error("first parameter must be a user address");if("function"!=typeof t)throw new Error("second parameter must be a callback");var r=this,o="";o=e.indexOf("://")>-1?e.replace(/ /g,"").split("/")[2]:e.replace(/ /g,"").split("@")[1];var s=0,n="https";function a(){var t="";return e.split("://")[1]||(t="acct:"),n+"://"+o+"/.well-known/"+i[s]+"?resource="+t+e}function c(e){if(r.config.uri_fallback&&"webfist.org"!==o&&s!==i.length-1)return s+=1,l();if(!r.config.tls_only&&"https"===n)return s=0,n="http",l();if(!r.config.webfist_fallback||"webfist.org"===o)return t(e);s=0,n="http",o="webfist.org";var c=a();r.__fetchJRD(c,t,(function(e){r.__processJRD(c,e,t,(function(e){"object"==typeof e.idx.links.webfist&&"string"==typeof e.idx.links.webfist[0].href&&r.__fetchJRD(e.idx.links.webfist[0].href,t,(function(e){r.__processJRD(c,e,t,(function(e){return t(null,t)}))}))}))}))}function l(){var e=a();r.__fetchJRD(e,c,(function(o){r.__processJRD(e,o,t,(function(e){t(null,e)}))}))}return r.__isLocalhost(o)&&(n="http"),setTimeout(l,0)},c.prototype.lookupLink=function(e,t,r){if(!n.hasOwnProperty(t))return r("unsupported rel "+t);this.lookup(e,(function(e,o){var s=o.idx.links[t];return e?r(e):0===s.length?r('no links found with rel="'+t+'"'):r(null,s[0])}))},void 0===(o=function(){return c}.apply(t,[]))||(e.exports=o)}()},317:function(e){e.exports=XMLHttpRequest}},t={};function r(o){var s=t[o];if(void 0!==s)return s.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var o=r(423);return o.default}()}));
//# sourceMappingURL=remotestorage.js.map